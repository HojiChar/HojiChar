<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 12.3.1"/>
    <title>hojichar API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>

        <h2>Contents</h2>
        <ul>
  <li><a href="#hojichar-the-text-processing-pipeline">HojiChar: The Text Processing Pipeline</a>
  <ul>
    <li><a href="#features">Features</a></li>
    <li><a href="#background-and-what-is-for-hojichar">Background and what is for HojiChar</a></li>
    <li><a href="#install">Install</a></li>
    <li><a href="#defining-a-compose-object">Defining a Compose Object</a></li>
    <li><a href="#user-defined-filters">User-defined Filters</a></li>
    <li><a href="#batch-and-stream-processing-with-apply_batch-and-apply_stream">Batch and Stream Processing with <code>apply_batch</code> and <code>apply_stream</code></a></li>
    <li><a href="#additional-notes-on-compose">Additional Notes on Compose</a></li>
    <li><a href="#hojichar-running-asynchronously">HojiChar running asynchronously</a></li>
    <li><a href="#get-metrics-of-processing">Get Metrics of processing</a></li>
    <li><a href="#parallel-application-of-compose">Parallel application of <code>Compose</code></a></li>
    <li><a href="#cli-tool-and-preprocessing-profile">CLI tool and preprocessing profile</a></li>
    <li><a href="#definition-of-profile">Definition of Profile</a></li>
    <li><a href="#for-developers">For Developers</a></li>
  </ul></li>
</ul>


        <h2>Submodules</h2>
        <ul>
                <li><a href="hojichar/core.html">core</a></li>
                <li><a href="hojichar/filters.html">filters</a></li>
                <li><a href="hojichar/utils.html">utils</a></li>
        </ul>

        <h2>API Documentation</h2>
            <ul class="memberlist">
            <li>
                    <a class="class" href="#Compose">Compose</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Compose.__init__">Compose</a>
                        </li>
                        <li>
                                <a class="function" href="#Compose.set_filters">set_filters</a>
                        </li>
                        <li>
                                <a class="function" href="#Compose.apply">apply</a>
                        </li>
                        <li>
                                <a class="function" href="#Compose.apply_batch">apply_batch</a>
                        </li>
                        <li>
                                <a class="function" href="#Compose.apply_stream">apply_stream</a>
                        </li>
                        <li>
                                <a class="function" href="#Compose.get_total_statistics">get_total_statistics</a>
                        </li>
                        <li>
                                <a class="function" href="#Compose.get_total_statistics_map">get_total_statistics_map</a>
                        </li>
                        <li>
                                <a class="function" href="#Compose.shutdown">shutdown</a>
                        </li>
                        <li>
                                <a class="variable" href="#Compose.statistics">statistics</a>
                        </li>
                        <li>
                                <a class="variable" href="#Compose.statistics_obj">statistics_obj</a>
                        </li>
                        <li>
                                <a class="function" href="#Compose.summary">summary</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Filter">Filter</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Filter.__init__">Filter</a>
                        </li>
                        <li>
                                <a class="function" href="#Filter.apply">apply</a>
                        </li>
                        <li>
                                <a class="function" href="#Filter.apply_filter">apply_filter</a>
                        </li>
                        <li>
                                <a class="function" href="#Filter.apply_batch">apply_batch</a>
                        </li>
                        <li>
                                <a class="function" href="#Filter.apply_stream">apply_stream</a>
                        </li>
                        <li>
                                <a class="function" href="#Filter.get_statistics">get_statistics</a>
                        </li>
                        <li>
                                <a class="function" href="#Filter.get_statistics_map">get_statistics_map</a>
                        </li>
                        <li>
                                <a class="function" href="#Filter.shutdown">shutdown</a>
                        </li>
                        <li>
                                <a class="function" href="#Filter.get_jsonable_vars">get_jsonable_vars</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#TokenFilter">TokenFilter</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#TokenFilter.__init__">TokenFilter</a>
                        </li>
                        <li>
                                <a class="function" href="#TokenFilter.apply">apply</a>
                        </li>
                        <li>
                                <a class="function" href="#TokenFilter.apply_filter">apply_filter</a>
                        </li>
                        <li>
                                <a class="function" href="#TokenFilter.get_jsonable_vars">get_jsonable_vars</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Document">Document</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Document.__init__">Document</a>
                        </li>
                        <li>
                                <a class="function" href="#Document.set_tokens">set_tokens</a>
                        </li>
                        <li>
                                <a class="function" href="#Document.get_tokens">get_tokens</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Token">Token</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Token.__init__">Token</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Parallel">Parallel</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Parallel.__init__">Parallel</a>
                        </li>
                        <li>
                                <a class="function" href="#Parallel.imap_apply">imap_apply</a>
                        </li>
                        <li>
                                <a class="function" href="#Parallel.get_total_statistics">get_total_statistics</a>
                        </li>
                        <li>
                                <a class="function" href="#Parallel.get_total_statistics_map">get_total_statistics_map</a>
                        </li>
                        <li>
                                <a class="variable" href="#Parallel.statistics_obj">statistics_obj</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#StatsContainer">StatsContainer</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#StatsContainer.__init__">StatsContainer</a>
                        </li>
                        <li>
                                <a class="function" href="#StatsContainer.get_human_readable_values">get_human_readable_values</a>
                        </li>
                        <li>
                                <a class="function" href="#StatsContainer.reset">reset</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#AsyncCompose">AsyncCompose</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#AsyncCompose.__init__">AsyncCompose</a>
                        </li>
                        <li>
                                <a class="function" href="#AsyncCompose.set_filters">set_filters</a>
                        </li>
                        <li>
                                <a class="function" href="#AsyncCompose.apply">apply</a>
                        </li>
                        <li>
                                <a class="function" href="#AsyncCompose.apply_batch">apply_batch</a>
                        </li>
                        <li>
                                <a class="function" href="#AsyncCompose.apply_stream">apply_stream</a>
                        </li>
                        <li>
                                <a class="function" href="#AsyncCompose.get_total_statistics">get_total_statistics</a>
                        </li>
                        <li>
                                <a class="function" href="#AsyncCompose.get_total_statistics_map">get_total_statistics_map</a>
                        </li>
                        <li>
                                <a class="variable" href="#AsyncCompose.statistics">statistics</a>
                        </li>
                        <li>
                                <a class="variable" href="#AsyncCompose.statistics_obj">statistics_obj</a>
                        </li>
                        <li>
                                <a class="function" href="#AsyncCompose.shutdown">shutdown</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#AsyncFilterAdapter">AsyncFilterAdapter</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#AsyncFilterAdapter.__init__">AsyncFilterAdapter</a>
                        </li>
                        <li>
                                <a class="function" href="#AsyncFilterAdapter.apply">apply</a>
                        </li>
                        <li>
                                <a class="function" href="#AsyncFilterAdapter.apply_batch">apply_batch</a>
                        </li>
                        <li>
                                <a class="function" href="#AsyncFilterAdapter.shutdown">shutdown</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#AsyncFilter">AsyncFilter</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#AsyncFilter.__init__">AsyncFilter</a>
                        </li>
                        <li>
                                <a class="function" href="#AsyncFilter.apply">apply</a>
                        </li>
                        <li>
                                <a class="function" href="#AsyncFilter.apply_batch">apply_batch</a>
                        </li>
                        <li>
                                <a class="function" href="#AsyncFilter.apply_stream">apply_stream</a>
                        </li>
                        <li>
                                <a class="function" href="#AsyncFilter.get_statistics">get_statistics</a>
                        </li>
                        <li>
                                <a class="function" href="#AsyncFilter.get_statistics_map">get_statistics_map</a>
                        </li>
                        <li>
                                <a class="function" href="#AsyncFilter.shutdown">shutdown</a>
                        </li>
                        <li>
                                <a class="function" href="#AsyncFilter.get_jsonable_vars">get_jsonable_vars</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
hojichar    </h1>

                        <div class="docstring"><h1 id="hojichar-the-text-processing-pipeline">HojiChar: The Text Processing Pipeline</h1>

<p><a href="https://badge.fury.io/py/hojichar"><img src="https://badge.fury.io/py/hojichar.svg" alt="PyPI version" /></a>
<a href="https://pypi.org/project/hojichar/"><img src="https://img.shields.io/pypi/pyversions/hojichar.svg" alt="Python Versions" /></a>
<a href="https://github.com/HojiChar/HojiChar/actions/workflows/ci.yaml"><img src="https://github.com/HojiChar/HojiChar/actions/workflows/ci.yaml/badge.svg" alt="CI wowkflow" /></a>
<a href="https://codecov.io/gh/HojiChar/HojiChar"><img src="https://codecov.io/gh/HojiChar/HojiChar/branch/main/graph/badge.svg?token=16928I9U9Y" alt="codecov" /></a>
<img src="https://img.shields.io/pypi/dm/hojichar" alt="PyPI - Downloads" /></p>

<p>Official docs: <a href="https://hojichar.github.io/HojiChar/hojichar.html">https://hojichar.github.io/HojiChar/hojichar.html</a></p>

<h2 id="features">Features</h2>

<ul>
<li>HojiChar provides a way to combine multiple arbitrary text processing tasks into a streamlined pipeline.</li>
<li>The sequence of operations can be described declaratively, ensuring portability.</li>
<li>HojiChar allows users to gather detailed statistical information from large amounts of text during processing.</li>
<li>It enables management of any Python text processing tasks, providing a Command Line Interface (CLI) capable of parallel processing.</li>
</ul>

<h2 id="background-and-what-is-for-hojichar">Background and what is for HojiChar</h2>

<p>Text preprocessing is far from a one-size-fits-all process. Depending on the data source and the specific task at hand, various steps including normalization, noise removal, and filtering may be necessary. Not all texts require the same level of preprocessing. For instance, relatively clean texts may only need minimal filtering, while "dirtier" sources like Common Crawl data often require more thorough processing. As a result, the preprocessing profile has to be tailored to each specific domain.</p>

<p>Many preprocessing operations can be viewed as filters, taking string as input, applying a transformation, and outputting the processed string. Even though these operations might seem straightforward individually, managing them in a multi-layered, efficient manner can be challenging.</p>

<p>Inspired by <a href="https://pytorch.org/vision/stable/transforms.html"><code>torchvision.transforms</code></a> and <a href="https://github.com/iver56/audiomentations">iver56/audiomentations</a>, HojiChar addresses these challenges. It enables users to define each text processing step as a class inheriting from <code><a href="#Filter">hojichar.Filter</a></code> and use <code><a href="#Compose">hojichar.Compose</a></code> to chain them together into a single filter. By writing out the <code><a href="#Compose">Compose</a></code> recipe as a profile, the preprocessing process for a specific domain's text can be made portable. Moreover, <code><a href="#Compose">Compose</a></code> automatically logs various metrics for each filter, such as byte changes, processing time, and number of rejected texts. This allows users to assess the validity of each operation and consider trade-offs between computation time and performance.</p>

<p>While there are other text normalization tools available, most are designed to perform a specific set of operations. Text preprocessing, despite its importance in the LLM era, is often considered a mundane task compared to machine learning or artificial intelligence tasks. As a result, many existing solutions can be ad hoc, poorly maintained, or inadequately tested. Recognizing these issues, we developed HojiChar as a robust tool for configuring text preprocessing.</p>

<h2 id="install">Install</h2>

<pre><code>pip install hojichar
</code></pre>

<p>If you want to use the additional filters, install the package with the following command:</p>

<pre><code>pip install 'hojichar[all]'
</code></pre>

<p>If you want to use <code>AsyncChatAPI</code> filter, install the package with the following command:</p>

<pre><code>pip install 'hojichar[openai]'
</code></pre>

<p>If you want to use the near-deduplication (using MinHash LSH algorithm) filter, install the package with the following command:</p>

<pre><code>pip install 'hojichar[dedup]'
</code></pre>

<h2 id="defining-a-compose-object">Defining a Compose Object</h2>

<p>The <a href="https://hojichar.github.io/HojiChar/hojichar.html#Compose"><code>Compose</code></a> class in HojiChar allows you to create a sequence of text processing filters.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">hojichar</span><span class="w"> </span><span class="kn">import</span> <span class="n">Compose</span><span class="p">,</span> <span class="n">document_filters</span>

<span class="n">cleaner</span> <span class="o">=</span> <span class="n">Compose</span><span class="p">([</span>
    <span class="n">document_filters</span><span class="o">.</span><span class="n">JSONLoader</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">),</span>
    <span class="n">document_filters</span><span class="o">.</span><span class="n">AcceptJapanese</span><span class="p">(),</span>
    <span class="n">document_filters</span><span class="o">.</span><span class="n">DocumentLengthFilter</span><span class="p">(</span><span class="n">min_doc_len</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">max_doc_len</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span>
    <span class="n">document_filters</span><span class="o">.</span><span class="n">ExampleHojiChar</span><span class="p">(),</span>
    <span class="n">document_filters</span><span class="o">.</span><span class="n">JSONDumper</span><span class="p">()</span>
<span class="p">])</span>
</code></pre>
</div>

<p>When a <a href="https://hojichar.github.io/HojiChar/hojichar.html#Compose"><code>Compose</code></a> object is called, it accepts a string and returns the processed string.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">cleaner</span><span class="p">(</span><span class="s1">&#39;{&quot;text&quot;: &quot;こんにちは、&quot;}&#39;</span><span class="p">)</span>
<span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;こんにちは、&lt;hojichar&gt;&quot;</span><span class="p">}</span>
</code></pre>
</div>

<p>The filter pipeline above accomplishes the following steps:</p>

<ol>
<li>Extracts the value from the <code>'text'</code> key in the JSON object.</li>
<li>Discards the string if it's not in Japanese.</li>
<li>Rejects any text shorter than 0 characters or longer than 1000 characters.</li>
<li>Appends <code>&lt;hojichar&gt;</code> to the string.</li>
<li>Outputs the processed string as JSON with the key "text".</li>
</ol>

<p>The filters used in the pipeline are predefined filters found in <a href="https://hojichar.github.io/HojiChar/hojichar/filters.html"><code><a href="hojichar/filters.html">hojichar.filters</a></code></a>.</p>

<p>While HojiChar provides some fundamental text processing filters and plans to add more in the future, users can also define their custom filters.</p>

<h2 id="user-defined-filters">User-defined Filters</h2>

<p>A filter composing a <a href="https://hojichar.github.io/HojiChar/hojichar.html#Compose"><code>Compose</code></a> object is a class that inherits the <a href="https://hojichar.github.io/HojiChar/hojichar.html#Filter"><code>Filter</code></a> class and implements the text processing within the <code>apply</code> function.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn"><a href="hojichar/core/filter_interface.html">hojichar.core.filter_interface</a></span><span class="w"> </span><span class="kn">import</span> <span class="n">Filter</span>

<span class="k">class</span><span class="w"> </span><span class="nc">YourFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">text</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write your text transformation...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">document</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
        <span class="k">return</span> <span class="n">document</span>
</code></pre>
</div>

<p>The <code>apply</code> method accepts a <code><a href="#Document">hojichar.Document</a></code> type as an argument and returns it after the transformations. The <a href="https://hojichar.github.io/HojiChar/hojichar.html#Document"><code>Document</code></a> is a class that encapsulates a string.</p>

<p>The Document class can have additional metadata via the extras attribute. This allows you to associate values with the document that can be utilized in subsequent filters.
<strong>Reject documents</strong></p>

<ul>
<li>The <code><a href="#Document">hojichar.Document</a></code> has an <code>is_rejected</code> attribute. If a filter sets this flag to <code>True</code>, <code><a href="#Compose">Compose</a></code> will discard the document during processing.</li>
</ul>

<p><strong>Definition of <code>__init__</code> for custom filter</strong></p>

<p>When creating a user-defined class and applying a custom constructor, make sure to initialize the parent class.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">YourFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">your_param</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">your_param</span> <span class="o">=</span> <span class="n">your_param</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">text</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">your_param</span><span class="p">)</span>
        <span class="n">document</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
        <span class="k">return</span> <span class="n">document</span>
</code></pre>
</div>

<p>This is because The <code><a href="#Filter">Filter</a></code> class implicitly has several arguments, one of which is <code>p</code>.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">cleaner</span> <span class="o">=</span> <span class="n">Compose</span><span class="p">([</span>
    <span class="n">document_filters</span><span class="o">.</span><span class="n">JSONLoader</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">),</span>
    <span class="n">document_filters</span><span class="o">.</span><span class="n">AcceptJapanese</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span>
    <span class="n">document_filters</span><span class="o">.</span><span class="n">JSONDumper</span><span class="p">()</span>
<span class="p">])</span>
</code></pre>
</div>

<p>The <code>p</code> argument passed to the <code>document_filters.AcceptJapanese</code> constructor determines the probability of applying the filter; with a probability of <code>1-p</code>, it acts as an identity function. This behavior is defined in the parent class <code><a href="#Filter">hojichar.Filter</a></code>.</p>

<h2 id="batch-and-stream-processing-with-apply_batch-and-apply_stream">Batch and Stream Processing with <code>apply_batch</code> and <code>apply_stream</code></h2>

<p>The <code><a href="#Filter">Filter</a></code> and <code><a href="#Compose">Compose</a></code> classes support efficient batch and stream processing through the <code>apply_batch</code> and <code>apply_stream</code> methods.</p>

<h3 id="apply_batch"><code>apply_batch</code></h3>

<ul>
<li>The <code>apply_batch</code> method processes a list of <code><a href="#Document">Document</a></code> objects in one go. By default, it applies the <code>apply</code> method to each document individually.</li>
<li>Users can override <code>apply_batch</code> in custom filters for optimized batch operations.
<div class="pdoc-code codehilite">
<pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">YourBatchFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">apply_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documents</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Document</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Document</span><span class="p">]:</span>
        <span class="c1"># Implement your batch processing logic here</span>
        <span class="k">return</span> <span class="n">documents</span>
</code></pre>
</div></li>
</ul>

<h3 id="apply_stream"><code>apply_stream</code></h3>

<p>The <code>apply_stream</code> method processes an iterable (e.g., generator) of <code><a href="#Document">Document</a></code> objects, ideal for large datasets or stream-based processing. If the <code>use_batch</code> flag is set to <code>True</code> in a <code><a href="#Filter">Filter</a></code>'s constructor, its apply_batch implementation will be utilized during stream processing.</p>

<p><strong>Example Usage:</strong></p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">stream</span> <span class="o">=</span> <span class="p">(</span><span class="n">Document</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;text </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">))</span>
<span class="n">processed_stream</span> <span class="o">=</span> <span class="n">cleaner</span><span class="o">.</span><span class="n">apply_stream</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>

<span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">processed_stream</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</code></pre>
</div>

<p>This allows HojiChar to efficiently process massive corpora while maintaining low memory consumption.</p>

<h2 id="additional-notes-on-compose">Additional Notes on Compose</h2>

<ul>
<li>Even though the behavior of a <code><a href="#Compose">Compose</a></code> object when called is a text-in, text-out function, <code><a href="#Compose">Compose</a></code> itself also inherits from the <code><a href="#Filter">Filter</a></code> class. Therefore, applying the <code>apply</code> method to a <code><a href="#Compose">Compose</a></code> object results in <code>hojihcar.Document</code> class being used as input and output.</li>
<li><code><a href="#Compose">Compose</a></code> class behaves like a Filter. If you add a Compose object as one of the filters in the constructor of Compose, the filter will be unfolded recursively.</li>
</ul>

<h2 id="hojichar-running-asynchronously">HojiChar running asynchronously</h2>

<ul>
<li>HojiChar supports asynchronous processing of text data using the <code><a href="#AsyncCompose">AsyncCompose</a></code> class. This allows you to build pipelines that can handle out-of-CPU processing, such as making API calls.</li>
<li><p>You can define async versions of filter using the <code><a href="#AsyncFilter">AsyncFilter</a></code> class.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">hojichar</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncFilter</span>

<span class="k">class</span><span class="w"> </span><span class="nc">YourAsyncFilter</span><span class="p">(</span><span class="n">AsyncFilter</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">text</span>
        <span class="c1"># Perform asynchronous processing here</span>
        <span class="n">document</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
        <span class="k">return</span> <span class="n">document</span>
</code></pre>
</div></li>
<li><p>The <code><a href="#AsyncCompose">AsyncCompose</a></code> class accepts both <code><a href="#Filter">Filter</a></code> and <code><a href="#AsyncFilter">AsyncFilter</a></code> objects, allowing you to mix synchronous and asynchronous filters in a single pipeline.</p></li>
</ul>

<h3 id="example">Example</h3>

<p>Nowadays, text processing is enhanced by the intelligence of LLMs.</p>

<p>This example demonstrates how to use the <code>AsyncChatAPI</code> filter to process text data with OpenAI compatible APIs. This filter allows you to build high throughput of "Chain of LLMs" easily.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">hojichar</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncCompose</span>
<span class="kn">from</span><span class="w"> </span><span class="nn"><a href="hojichar/filters/document_filters.html">hojichar.filters.document_filters</a></span><span class="w"> </span><span class="kn">import</span> <span class="n">JSONLoader</span><span class="p">,</span> <span class="n">JSONDumper</span>
<span class="kn">from</span><span class="w"> </span><span class="nn"><a href="hojichar/utils/async_handlers.html">hojichar.utils.async_handlers</a></span><span class="w"> </span><span class="kn">import</span> <span class="n">write_stream_to_file</span>


<span class="n">async_pipeline</span> <span class="o">=</span> <span class="n">AsyncCompose</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">JSONLoader</span><span class="p">(</span><span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">),</span>
        <span class="n">AsyncChatAPI</span><span class="p">(</span>
            <span class="n">model_id</span><span class="o">=</span><span class="s2">&quot;gpt-4o&quot;</span><span class="p">,</span>
            <span class="n">openai_endpoint_url</span><span class="o">=</span><span class="s2">&quot;https://api.openai.com/v1&quot;</span><span class="p">,</span> 
            <span class="n">openai_api_key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;OPENAI_API_KEY&quot;</span><span class="p">),</span>
            <span class="n">max_concurrent_requests</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
            <span class="n">output_key</span><span class="o">=</span><span class="s2">&quot;llm_output&quot;</span><span class="p">,</span>
            <span class="n">message_generator</span><span class="o">=</span><span class="k">lambda</span> <span class="n">doc</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">doc</span><span class="o">.</span><span class="n">text</span><span class="p">[:</span><span class="mi">1000</span><span class="p">]}],</span>
        <span class="p">),</span>
        <span class="n">JSONDumper</span><span class="p">(</span><span class="n">export_extras</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;input.jsonl&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">async_pipeline</span><span class="p">:</span>
        <span class="n">async_output_stream</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="k">async</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">async_pipeline</span><span class="o">.</span><span class="n">apply_stream</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
        <span class="k">await</span> <span class="n">write_stream_to_file</span><span class="p">(</span><span class="n">async_output_stream</span><span class="p">,</span> <span class="s2">&quot;output.jsonl&quot;</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span> <span class="c1"># Write async-iterable to file efficiently</span>
</code></pre>
</div>

<ul>
<li>You can use this filter by installing <code>'hojichar[openai]'</code></li>
<li>The filter works with OpenAI compatible APIs, like the endpoint hosted by vLLM. It's useful for text-augumentation tasks.
<ul>
<li>The AsyncChatAPI works 1K req/sec with optimized vLLM server. (We reccomend to use <code>uvloop</code> to get better throughput.)</li>
</ul></li>
</ul>

<h2 id="get-metrics-of-processing">Get Metrics of processing</h2>

<p>HojiChar tracks detailed statistics at both the filter and pipeline levels, helping you monitor and debug your processing pipeline.</p>

<p>Each <code><a href="#Filter">Filter</a></code> (including <code><a href="#Compose">Compose</a></code>) maintains a <code>Statistics</code> object containing information such as input size, output size, discarded document count, and processing time.</p>

<p><strong>Example: Getting Statistics from a Compose Object</strong></p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">stats</span> <span class="o">=</span> <span class="n">cleaner</span><span class="o">.</span><span class="n">get_total_statistics_map</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span>
</code></pre>
</div>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="p">[{</span><span class="s1">&#39;cumulative_time_ns&#39;</span><span class="p">:</span> <span class="mi">337250</span><span class="p">,</span>
  <span class="s1">&#39;diff_bytes&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
  <span class="s1">&#39;diff_chars&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
  <span class="s1">&#39;discard_num&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s1">&#39;input_bytes&#39;</span><span class="p">:</span> <span class="mi">45</span><span class="p">,</span>
  <span class="s1">&#39;input_chars&#39;</span><span class="p">:</span> <span class="mi">23</span><span class="p">,</span>
  <span class="s1">&#39;input_num&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Total&#39;</span><span class="p">,</span>
  <span class="s1">&#39;output_bytes&#39;</span><span class="p">:</span> <span class="mi">55</span><span class="p">,</span>
  <span class="s1">&#39;output_chars&#39;</span><span class="p">:</span> <span class="mi">33</span><span class="p">,</span>
  <span class="s1">&#39;output_num&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">&#39;cumulative_time_ns&#39;</span><span class="p">:</span> <span class="mi">80209</span><span class="p">,</span>
  <span class="s1">&#39;diff_bytes&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">12</span><span class="p">,</span>
  <span class="s1">&#39;diff_chars&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">12</span><span class="p">,</span>
  <span class="s1">&#39;discard_num&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s1">&#39;input_bytes&#39;</span><span class="p">:</span> <span class="mi">45</span><span class="p">,</span>
  <span class="s1">&#39;input_chars&#39;</span><span class="p">:</span> <span class="mi">23</span><span class="p">,</span>
  <span class="s1">&#39;input_num&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;0-JSONLoader&#39;</span><span class="p">,</span>
  <span class="s1">&#39;output_bytes&#39;</span><span class="p">:</span> <span class="mi">33</span><span class="p">,</span>
  <span class="s1">&#39;output_chars&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
  <span class="s1">&#39;output_num&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">&#39;cumulative_time_ns&#39;</span><span class="p">:</span> <span class="mi">17500</span><span class="p">,</span>
  <span class="s1">&#39;diff_bytes&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s1">&#39;diff_chars&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s1">&#39;discard_num&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s1">&#39;input_bytes&#39;</span><span class="p">:</span> <span class="mi">33</span><span class="p">,</span>
  <span class="s1">&#39;input_chars&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
  <span class="s1">&#39;input_num&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;1-AcceptJapanese&#39;</span><span class="p">,</span>
  <span class="s1">&#39;output_bytes&#39;</span><span class="p">:</span> <span class="mi">33</span><span class="p">,</span>
  <span class="s1">&#39;output_chars&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
  <span class="s1">&#39;output_num&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">&#39;cumulative_time_ns&#39;</span><span class="p">:</span> <span class="mi">8125</span><span class="p">,</span>
  <span class="s1">&#39;diff_bytes&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s1">&#39;diff_chars&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s1">&#39;discard_num&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s1">&#39;input_bytes&#39;</span><span class="p">:</span> <span class="mi">33</span><span class="p">,</span>
  <span class="s1">&#39;input_chars&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
  <span class="s1">&#39;input_num&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;2-DocumentLengthFilter&#39;</span><span class="p">,</span>
  <span class="s1">&#39;output_bytes&#39;</span><span class="p">:</span> <span class="mi">33</span><span class="p">,</span>
  <span class="s1">&#39;output_chars&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
  <span class="s1">&#39;output_num&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">&#39;cumulative_time_ns&#39;</span><span class="p">:</span> <span class="mi">6042</span><span class="p">,</span>
  <span class="s1">&#39;diff_bytes&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
  <span class="s1">&#39;diff_chars&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
  <span class="s1">&#39;discard_num&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s1">&#39;input_bytes&#39;</span><span class="p">:</span> <span class="mi">33</span><span class="p">,</span>
  <span class="s1">&#39;input_chars&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
  <span class="s1">&#39;input_num&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;3-ExampleHojiChar&#39;</span><span class="p">,</span>
  <span class="s1">&#39;output_bytes&#39;</span><span class="p">:</span> <span class="mi">43</span><span class="p">,</span>
  <span class="s1">&#39;output_chars&#39;</span><span class="p">:</span> <span class="mi">21</span><span class="p">,</span>
  <span class="s1">&#39;output_num&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">&#39;cumulative_time_ns&#39;</span><span class="p">:</span> <span class="mi">81125</span><span class="p">,</span>
  <span class="s1">&#39;diff_bytes&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
  <span class="s1">&#39;diff_chars&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
  <span class="s1">&#39;discard_num&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s1">&#39;input_bytes&#39;</span><span class="p">:</span> <span class="mi">43</span><span class="p">,</span>
  <span class="s1">&#39;input_chars&#39;</span><span class="p">:</span> <span class="mi">21</span><span class="p">,</span>
  <span class="s1">&#39;input_num&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;4-JSONDumper&#39;</span><span class="p">,</span>
  <span class="s1">&#39;output_bytes&#39;</span><span class="p">:</span> <span class="mi">55</span><span class="p">,</span>
  <span class="s1">&#39;output_chars&#39;</span><span class="p">:</span> <span class="mi">33</span><span class="p">,</span>
  <span class="s1">&#39;output_num&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}]</span>
</code></pre>
</div>

<ul>
<li>Use <code>get_statistics()</code> to get the raw Statistics object for any filter.</li>
<li>Use <code>get_total_statistics()</code> to get a list of statistics for all filters in a Compose pipeline.</li>
<li>Use <code>get_total_statistics_map()</code> to retrieve the statistics as a list of dicts.</li>
</ul>

<p>These tools allow granular monitoring of how each filter contributes to data reduction, rejection, or transformation.</p>

<h2 id="parallel-application-of-compose">Parallel application of <code><a href="#Compose">Compose</a></code></h2>

<p>The <code><a href="#Parallel">hojichar.Parallel</a></code> class allows for the application of <code><a href="#Compose">Compose</a></code> to an iterable of <code><a href="#Document">Document</a></code> concurrently. This class empowers users to process vast collections of documents by harnessing the power of multiple CPU cores.</p>

<p>Example usage of <code><a href="#Parallel">Parallel</a></code> class to proces a very large JSON Lines file concurrently.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">hojichar</span>

<span class="n">input_file</span> <span class="o">=</span> <span class="s2">&quot;your_text.jsonl&quot;</span>
<span class="n">input_doc_iter</span> <span class="o">=</span> <span class="p">(</span><span class="n"><a href="#Document">hojichar.Document</a></span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_file</span><span class="p">))</span>

<span class="n">cleaner</span> <span class="o">=</span> <span class="n"><a href="#Compose">hojichar.Compose</a></span><span class="p">([</span>
    <span class="n">hojichar</span><span class="o">.</span><span class="n">document_filters</span><span class="o">.</span><span class="n">JSONLoader</span><span class="p">(),</span>
    <span class="n">hojichar</span><span class="o">.</span><span class="n">document_filters</span><span class="o">.</span><span class="n">DocumentNormalizer</span><span class="p">(),</span>
    <span class="c1"># Insert your filters</span>
    <span class="n">hojichar</span><span class="o">.</span><span class="n">document_filters</span><span class="o">.</span><span class="n">JSONDumper</span><span class="p">(),</span>
<span class="p">])</span>

<span class="k">with</span> <span class="n"><a href="#Parallel">hojichar.Parallel</a></span><span class="p">(</span><span class="n">cleaner</span><span class="p">,</span> <span class="n">num_jobs</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="k">as</span> <span class="n">pfilter</span><span class="p">:</span>
    <span class="n">out_doc_iter</span> <span class="o">=</span> <span class="n">pfilter</span><span class="o">.</span><span class="n">imap_apply</span><span class="p">(</span><span class="n">input_doc_iter</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;your_processed_text.jsonl&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">out_doc_iter</span><span class="p">:</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">text</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre>
</div>

<ul>
<li>Always use the <code><a href="#Parallel">Parallel</a></code> class within a <code>with</code> statement.</li>
<li><code><a href="#Parallel.imap_apply">Parallel.imap_apply</a>(doc_iter)</code> processes an iterator of <code><a href="#Document">Document</a></code> and returns an iterator of the processed documents.</li>
<li>For additional options and details about the <code><a href="#Parallel">Parallel</a></code> class, please refer to the official documentation.</li>
</ul>

<h2 id="cli-tool-and-preprocessing-profile">CLI tool and preprocessing profile</h2>

<ul>
<li>HojiChar provides CLI tools for text preprocess pipeline.</li>
<li><p>User defines a series of preprocessing into a python file as profile.</p></li>
<li><p>Example:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code>cat<span class="w"> </span>&lt;your_text.jsonl&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>hojichar<span class="w"> </span>-p<span class="w"> </span>your_preprocessing_profile.py<span class="w"> </span>-o<span class="w"> </span>your_text_preprocessed.jsonl
</code></pre>
</div></li>
<li><p><code>hojichar --help</code></p>

<div class="pdoc-code codehilite">
<pre><span></span><code>usage: hojichar [-h] --profile &lt;profile.py&gt; [--args ARGS [ARGS ...]] [--output OUTPUT] [--input INPUT] [--dump-stats &lt;path to stats.json&gt;] [--exit-on-error] [--all] [--jobs JOBS]

options:
-h, --help            show this help message and exit
--profile &lt;profile.py&gt;, -p &lt;profile.py&gt;
                        Path to a Python file that implements your custom filter.
--args ARGS [ARGS ...]
                        Pass additional arguments to the profile. Use it like `--args arg1 arg2` etc. The arguments should be space-separated.
--output OUTPUT, -o OUTPUT
                        Specifies the path for the output file. Defaults to standard output.
--input INPUT, -i INPUT
                        Specifies the path for the input file. Defaults to standard input. If set this path, the progress bar is enabled.
--dump-stats &lt;path to stats.json&gt;
                        Dump statistics to file. If the file exists, it will be appended.
--exit-on-error       Exit if an exception occurs during filtering. Useful for debugging custom filters.
--all                 A flag that specifies whether to include discarded samples. This is useful when inspecting discarded samples.
--jobs JOBS, -j JOBS  The number ob parallel jobs. By default, the nuber of the CPU core.
</code></pre>
</div></li>
</ul>

<h2 id="definition-of-profile">Definition of Profile</h2>

<ul>
<li>HojiChar CLI receives a series of preprocessing as a profile.</li>
<li>The preprocessing profile is provided as a Python file. Two patterns of the file are allowed.</li>
<li><a href="hojichar/utils/load_compose.html#load_compose">hojichar.utils.load_compose.load_compose()</a> loads these profile.</li>
</ul>

<h3 id="filter-profile"><code>FILTER</code> profile</h3>

<ul>
<li><code><a href="#Compose">hojichar.Compose</a></code> must be defined as <code>FILTER</code> variable.</li>
<li><p>Example.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">hojichar</span><span class="w"> </span><span class="kn">import</span> <span class="n">Compose</span><span class="p">,</span> <span class="n">Filter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn"><a href="hojichar/filters/document_filters.html">hojichar.filters.document_filters</a></span><span class="w"> </span><span class="kn">import</span> <span class="n">ExampleHojiChar</span><span class="p">,</span> <span class="n">JSONLoader</span>


<span class="k">class</span><span class="w"> </span><span class="nc">JSONDumper</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">text</span>
        <span class="n">document</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">text</span><span class="p">},</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">document</span>

<span class="c1"># FILTER must define Compose object.</span>
<span class="n">FILTER</span> <span class="o">=</span> <span class="n">Compose</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">JSONLoader</span><span class="p">(),</span>
        <span class="n">ExampleHojiChar</span><span class="p">(),</span>
        <span class="n">JSONDumper</span><span class="p">(),</span>
    <span class="p">]</span>
<span class="p">)</span>
</code></pre>
</div>

<ul>
<li>Pass the texts to the filter you have defined using a pipe as follows.
<div class="pdoc-code codehilite">
<pre><span></span><code>cat<span class="w"> </span>&lt;your_file&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>hojichar<span class="w"> </span>-p<span class="w"> </span>example_profile.py
</code></pre>
</div></li>
</ul></li>
<li><p><code><a href="hojichar/utils/load_compose.html#load_filter_from_file">hojichar.utils.load_compose.load_filter_from_file()</a></code> loads this type of profile.</p></li>
</ul>

<h3 id="factory-profile"><code>FACTORY</code> profile</h3>

<ul>
<li>A callable function that returns <code><a href="#Compose">hojichar.Compose</a></code> must be defined as <code>FACTORY</code> variable.</li>
<li>The callable can receive arguments. In this way, parameters can be passed to the profile.
<ul>
<li>Some kinds of value are not preferred to static. For example, random seeds and some flags modify the behavior of a filter, etc</li>
<li><code>FACTORY</code> provides a mechanism to pass those values as arguments to the preprocessing.</li>
</ul></li>
<li><p>Example.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">hojichar</span><span class="w"> </span><span class="kn">import</span> <span class="n">Compose</span><span class="p">,</span> <span class="n">Filter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn"><a href="hojichar/filters/document_filters.html">hojichar.filters.document_filters</a></span><span class="w"> </span><span class="kn">import</span> <span class="n">JSONLoader</span>


<span class="k">class</span><span class="w"> </span><span class="nc">AddSomething</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span> <span class="c1">#  Concat some value after every document.</span>
  <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">something</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">something</span> <span class="o">=</span> <span class="n">something</span>

  <span class="k">def</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">):</span>
      <span class="n">text</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">text</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">something</span>
      <span class="n">document</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
      <span class="k">return</span> <span class="n">document</span>

<span class="k">class</span><span class="w"> </span><span class="nc">JSONDumper</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
  <span class="k">def</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">):</span>
      <span class="n">text</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">text</span>
      <span class="n">document</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">text</span><span class="p">},</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">document</span>


<span class="k">def</span><span class="w"> </span><span class="nf">callback</span><span class="p">(</span><span class="n">something</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">Compose</span><span class="p">(</span>
      <span class="p">[</span>
          <span class="n">JSONLoader</span><span class="p">(),</span>
          <span class="n">AddSomething</span><span class="p">(</span><span class="n">something</span><span class="p">),</span>
          <span class="n">JSONDumper</span><span class="p">(),</span>
      <span class="p">]</span>
  <span class="p">)</span>

<span class="c1"># FACTORY must be callable which returns Compose object.</span>
<span class="n">FACTORY</span> <span class="o">=</span> <span class="n">callback</span>
</code></pre>
</div></li>
<li><p>Using <code>FACTORY</code> profile with arguments in CLI.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code>cat<span class="w"> </span>&lt;your_file&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>hojichar<span class="w"> </span>-p<span class="w"> </span>example_profile.py<span class="w"> </span>--args<span class="w"> </span>arg1<span class="w"> </span>arg2
</code></pre>
</div></li>
<li><p><code><a href="hojichar/utils/load_compose.html#load_parametrized_filter_from_file">hojichar.utils.load_compose.load_parametrized_filter_from_file()</a></code> or <code>load_factory_from_file</code> loads this type of profile.</p></li>
</ul>

<h2 id="for-developers">For Developers</h2>

<h3 id="installing-from-the-source-directory">Installing from the Source Directory</h3>

<p>To install the package, execute the following commands:</p>

<pre><code>git clone https://github.com/HojiChar/HojiChar.git
cd HojiChar
uv sync --all-extras
</code></pre>

<h3 id="testing">Testing</h3>

<p>Some filters incorporate doctests. You can run these tests with the command:</p>

<pre><code>pytest --doctest-modules .
</code></pre>

<p>This command should be executed from the root of the project.</p>

<h3 id="code-style">Code style</h3>

<ul>
<li>HojiChar requires type hints for all code. Type checking is performed in continuous integration (CI) in addition to the pytest tests.</li>
<li>HojiChar code is subject to inspection and formatting by the <code>ruff</code> Linter. For configuration details, please refer to <code>pyproject.toml</code>. You can perform linting and formatting from the root of the project using the following commands:</li>
</ul>

<p>Linting</p>

<div class="pdoc-code codehilite">
<pre><span></span><code>uvx<span class="w"> </span>ruff<span class="w"> </span>check<span class="w"> </span>.
</code></pre>
</div>

<p>Formatting</p>

<div class="pdoc-code codehilite">
<pre><span></span><code>uvx<span class="w"> </span>ruff<span class="w"> </span>format<span class="w"> </span>.
</code></pre>
</div>

<h3 id="building-the-documentation">Building the Documentation</h3>

<p>We use Pdoc for building the documentation. You can build the documentation using the following command:</p>

<pre><code>pdoc -o docs hojichar
</code></pre>

<p>Run this command from the project root.</p>

<p>In practice, the process of building the documentation is automated by CI. When a Pull Request is merged into the main branch, the documentation is built in the <code>docs/</code> directory of the <code>docs</code> branch. This directory is then deployed to the official documentation site by GitHub Pages.</p>

<h3 id="creating-a-source-tarball">Creating a Source Tarball</h3>

<p>To create a source tarball, for instance, for packaging or distribution, run the following command:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code>uv<span class="w"> </span>build
</code></pre>
</div>

<p>The tarball will be created in the dist directory. This command will compile the source code, and the resulting tarball can be installed with no additional dependencies other than the Python standard library.</p>

<h3 id="creating-a-release-and-uploading-it-to-pypi">Creating a Release and Uploading it to PyPI</h3>

<p>Versions uploaded to PyPI are identified by git tags. The <code>__version__</code> variable in <code>__init__.py</code> or the <code>version</code> entry in <code>pyproject.toml</code> are ignored. The <code>uv-dynamic-versioning</code> plugin is used to implement this process.</p>

<p>The steps to push to PyPI are as follows, although in actuality, the process is automated by CI when a GitHub release is created from the tag.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code>git<span class="w"> </span>checkout<span class="w"> </span>v0.1.2
uv<span class="w"> </span>build
uv<span class="w"> </span>publish<span class="w"> </span>--index<span class="w"> </span>testpypi<span class="w"> </span>--token<span class="w"> </span><span class="si">${</span><span class="nv">PYPI_TOKEN</span><span class="si">}</span>
</code></pre>
</div>

<p>The actual task for the manager is to apply the appropriate tag to the commit to be released and to create the release from GitHub:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code>git<span class="w"> </span>tag<span class="w"> </span>-a<span class="w"> </span>v0.1.2<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Version 0.1.2&quot;</span>
git<span class="w"> </span>push<span class="w"> </span>origin<span class="w"> </span>v0.1.2
</code></pre>
</div>
</div>

                        <input id="mod-hojichar-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-hojichar-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos"> 1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos"> 2</span></a><span class="sd">.. include:: ../README.md</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos"> 3</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos"> 4</span></a>
</span><span id="L-5"><a href="#L-5"><span class="linenos"> 5</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.core.async_composition</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncCompose</span><span class="p">,</span> <span class="n">AsyncFilterAdapter</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos"> 6</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.core.async_filter_interface</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncFilter</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos"> 7</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.core.composition</span><span class="w"> </span><span class="kn">import</span> <span class="n">Compose</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos"> 8</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.core.filter_interface</span><span class="w"> </span><span class="kn">import</span> <span class="n">Filter</span><span class="p">,</span> <span class="n">TokenFilter</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos"> 9</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.core.inspection</span><span class="w"> </span><span class="kn">import</span> <span class="n">StatsContainer</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">10</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.core.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">Token</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">11</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.core.parallel</span><span class="w"> </span><span class="kn">import</span> <span class="n">Parallel</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">12</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.filters</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">13</span></a>    <span class="n">deduplication</span><span class="p">,</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">14</span></a>    <span class="n">document_filters</span><span class="p">,</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">15</span></a>    <span class="n">language_identification</span><span class="p">,</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">16</span></a>    <span class="n">token_filters</span><span class="p">,</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">17</span></a>    <span class="n">tokenization</span><span class="p">,</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">18</span></a><span class="p">)</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">19</span></a>
</span><span id="L-20"><a href="#L-20"><span class="linenos">20</span></a><span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;0.0.0&quot;</span>  <span class="c1"># Replaced by uv-dynamic-versioning when deploying</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">21</span></a>
</span><span id="L-22"><a href="#L-22"><span class="linenos">22</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">23</span></a>    <span class="s2">&quot;core&quot;</span><span class="p">,</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">24</span></a>    <span class="s2">&quot;filters&quot;</span><span class="p">,</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">25</span></a>    <span class="s2">&quot;utils&quot;</span><span class="p">,</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">26</span></a>    <span class="s2">&quot;Compose&quot;</span><span class="p">,</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">27</span></a>    <span class="s2">&quot;Filter&quot;</span><span class="p">,</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">28</span></a>    <span class="s2">&quot;TokenFilter&quot;</span><span class="p">,</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">29</span></a>    <span class="s2">&quot;Document&quot;</span><span class="p">,</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">30</span></a>    <span class="s2">&quot;Token&quot;</span><span class="p">,</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">31</span></a>    <span class="s2">&quot;Parallel&quot;</span><span class="p">,</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">32</span></a>    <span class="s2">&quot;StatsContainer&quot;</span><span class="p">,</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">33</span></a>    <span class="s2">&quot;deduplication&quot;</span><span class="p">,</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">34</span></a>    <span class="s2">&quot;document_filters&quot;</span><span class="p">,</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">35</span></a>    <span class="s2">&quot;language_identification&quot;</span><span class="p">,</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">36</span></a>    <span class="s2">&quot;token_filters&quot;</span><span class="p">,</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">37</span></a>    <span class="s2">&quot;tokenization&quot;</span><span class="p">,</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">38</span></a>    <span class="s2">&quot;AsyncCompose&quot;</span><span class="p">,</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">39</span></a>    <span class="s2">&quot;AsyncFilterAdapter&quot;</span><span class="p">,</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">40</span></a>    <span class="s2">&quot;AsyncFilter&quot;</span><span class="p">,</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">41</span></a><span class="p">]</span>
</span></pre></div>


            </section>
                <section id="Compose">
                            <input id="Compose-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Compose</span><wbr>(<span class="base"><a href="#Filter">hojichar.Filter</a></span>):

                <label class="view-source-button" for="Compose-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Compose"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Compose-15"><a href="#Compose-15"><span class="linenos"> 15</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Compose</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
</span><span id="Compose-16"><a href="#Compose-16"><span class="linenos"> 16</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="Compose-17"><a href="#Compose-17"><span class="linenos"> 17</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Compose-18"><a href="#Compose-18"><span class="linenos"> 18</span></a>        <span class="n">filters</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Filter</span><span class="p">,</span> <span class="n">TokenFilter</span><span class="p">]],</span>
</span><span id="Compose-19"><a href="#Compose-19"><span class="linenos"> 19</span></a>        <span class="n">random_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">Generator</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Compose-20"><a href="#Compose-20"><span class="linenos"> 20</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="Compose-21"><a href="#Compose-21"><span class="linenos"> 21</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="Compose-22"><a href="#Compose-22"><span class="linenos"> 22</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Compose-23"><a href="#Compose-23"><span class="linenos"> 23</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Compose-24"><a href="#Compose-24"><span class="linenos"> 24</span></a><span class="sd">        Compose a filter from pre-defined filter-objects.</span>
</span><span id="Compose-25"><a href="#Compose-25"><span class="linenos"> 25</span></a><span class="sd">        Filter which has `skip_rejected` flag ignores a document which has `is_rejected` flag.</span>
</span><span id="Compose-26"><a href="#Compose-26"><span class="linenos"> 26</span></a><span class="sd">        By doing so, Compose avoid applying filters that do not affect the output.</span>
</span><span id="Compose-27"><a href="#Compose-27"><span class="linenos"> 27</span></a>
</span><span id="Compose-28"><a href="#Compose-28"><span class="linenos"> 28</span></a><span class="sd">        Parameters</span>
</span><span id="Compose-29"><a href="#Compose-29"><span class="linenos"> 29</span></a><span class="sd">        ----------</span>
</span><span id="Compose-30"><a href="#Compose-30"><span class="linenos"> 30</span></a><span class="sd">        filters : List[Union[Filter, TokenFilter]]</span>
</span><span id="Compose-31"><a href="#Compose-31"><span class="linenos"> 31</span></a><span class="sd">            Filter instances which apply to the corpus.</span>
</span><span id="Compose-32"><a href="#Compose-32"><span class="linenos"> 32</span></a>
</span><span id="Compose-33"><a href="#Compose-33"><span class="linenos"> 33</span></a><span class="sd">        random_state : Union[None, int, np.random.Generator], optional</span>
</span><span id="Compose-34"><a href="#Compose-34"><span class="linenos"> 34</span></a><span class="sd">            Default = None</span>
</span><span id="Compose-35"><a href="#Compose-35"><span class="linenos"> 35</span></a><span class="sd">            Seed for applying filters randomly.</span>
</span><span id="Compose-36"><a href="#Compose-36"><span class="linenos"> 36</span></a><span class="sd">            `random_state` must be int or np.random.Generator instance.</span>
</span><span id="Compose-37"><a href="#Compose-37"><span class="linenos"> 37</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Compose-38"><a href="#Compose-38"><span class="linenos"> 38</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Compose-39"><a href="#Compose-39"><span class="linenos"> 39</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_filters</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
</span><span id="Compose-40"><a href="#Compose-40"><span class="linenos"> 40</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__module__</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Compose-41"><a href="#Compose-41"><span class="linenos"> 41</span></a>
</span><span id="Compose-42"><a href="#Compose-42"><span class="linenos"> 42</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_statistics</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Total&quot;</span>
</span><span id="Compose-43"><a href="#Compose-43"><span class="linenos"> 43</span></a>
</span><span id="Compose-44"><a href="#Compose-44"><span class="linenos"> 44</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Filter</span><span class="p">,</span> <span class="n">TokenFilter</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Compose-45"><a href="#Compose-45"><span class="linenos"> 45</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Compose-46"><a href="#Compose-46"><span class="linenos"> 46</span></a><span class="sd">        Set the filter to a Compose object. The filter is expanded if the</span>
</span><span id="Compose-47"><a href="#Compose-47"><span class="linenos"> 47</span></a><span class="sd">        list of filters in the argument contains a filter bound by Compose.</span>
</span><span id="Compose-48"><a href="#Compose-48"><span class="linenos"> 48</span></a>
</span><span id="Compose-49"><a href="#Compose-49"><span class="linenos"> 49</span></a><span class="sd">        Args:</span>
</span><span id="Compose-50"><a href="#Compose-50"><span class="linenos"> 50</span></a><span class="sd">            filters (List[Union[Filter, TokenFilter]]): Target filters</span>
</span><span id="Compose-51"><a href="#Compose-51"><span class="linenos"> 51</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Compose-52"><a href="#Compose-52"><span class="linenos"> 52</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Filter</span><span class="p">,</span> <span class="n">TokenFilter</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Compose-53"><a href="#Compose-53"><span class="linenos"> 53</span></a>
</span><span id="Compose-54"><a href="#Compose-54"><span class="linenos"> 54</span></a>        <span class="n">filter_idx</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Compose-55"><a href="#Compose-55"><span class="linenos"> 55</span></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">:</span>
</span><span id="Compose-56"><a href="#Compose-56"><span class="linenos"> 56</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">Compose</span><span class="p">):</span>
</span><span id="Compose-57"><a href="#Compose-57"><span class="linenos"> 57</span></a>                <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">filters</span><span class="p">:</span>
</span><span id="Compose-58"><a href="#Compose-58"><span class="linenos"> 58</span></a>                    <span class="n">sub</span><span class="o">.</span><span class="n">_set_rng_if_not_initialized</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rng</span><span class="p">)</span>
</span><span id="Compose-59"><a href="#Compose-59"><span class="linenos"> 59</span></a>                    <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filter_idx</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">sub</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Compose-60"><a href="#Compose-60"><span class="linenos"> 60</span></a>                    <span class="n">sub</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="Compose-61"><a href="#Compose-61"><span class="linenos"> 61</span></a>                    <span class="n">sub</span><span class="o">.</span><span class="n">_statistics</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="Compose-62"><a href="#Compose-62"><span class="linenos"> 62</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span>
</span><span id="Compose-63"><a href="#Compose-63"><span class="linenos"> 63</span></a>                    <span class="n">filter_idx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Compose-64"><a href="#Compose-64"><span class="linenos"> 64</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Compose-65"><a href="#Compose-65"><span class="linenos"> 65</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">_set_rng_if_not_initialized</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rng</span><span class="p">)</span>
</span><span id="Compose-66"><a href="#Compose-66"><span class="linenos"> 66</span></a>                <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filter_idx</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Compose-67"><a href="#Compose-67"><span class="linenos"> 67</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="Compose-68"><a href="#Compose-68"><span class="linenos"> 68</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">_statistics</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="Compose-69"><a href="#Compose-69"><span class="linenos"> 69</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="Compose-70"><a href="#Compose-70"><span class="linenos"> 70</span></a>                <span class="n">filter_idx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Compose-71"><a href="#Compose-71"><span class="linenos"> 71</span></a>
</span><span id="Compose-72"><a href="#Compose-72"><span class="linenos"> 72</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Compose-73"><a href="#Compose-73"><span class="linenos"> 73</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Compose-74"><a href="#Compose-74"><span class="linenos"> 74</span></a><span class="sd">        Apply the composed filter to a text and return the processed text.</span>
</span><span id="Compose-75"><a href="#Compose-75"><span class="linenos"> 75</span></a><span class="sd">        If the document is rejected, return an empty string.</span>
</span><span id="Compose-76"><a href="#Compose-76"><span class="linenos"> 76</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Compose-77"><a href="#Compose-77"><span class="linenos"> 77</span></a>        <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Compose-78"><a href="#Compose-78"><span class="linenos"> 78</span></a>        <span class="n">document</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="Compose-79"><a href="#Compose-79"><span class="linenos"> 79</span></a>        <span class="k">if</span> <span class="n">document</span><span class="o">.</span><span class="n">is_rejected</span><span class="p">:</span>
</span><span id="Compose-80"><a href="#Compose-80"><span class="linenos"> 80</span></a>            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</span><span id="Compose-81"><a href="#Compose-81"><span class="linenos"> 81</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Compose-82"><a href="#Compose-82"><span class="linenos"> 82</span></a>            <span class="k">return</span> <span class="n">document</span><span class="o">.</span><span class="n">text</span>
</span><span id="Compose-83"><a href="#Compose-83"><span class="linenos"> 83</span></a>
</span><span id="Compose-84"><a href="#Compose-84"><span class="linenos"> 84</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Document</span><span class="p">:</span>
</span><span id="Compose-85"><a href="#Compose-85"><span class="linenos"> 85</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Compose-86"><a href="#Compose-86"><span class="linenos"> 86</span></a><span class="sd">        Apply the composed filter to a document and return the processed document.</span>
</span><span id="Compose-87"><a href="#Compose-87"><span class="linenos"> 87</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Compose-88"><a href="#Compose-88"><span class="linenos"> 88</span></a>        <span class="n">stat</span> <span class="o">=</span> <span class="n">get_doc_info</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="Compose-89"><a href="#Compose-89"><span class="linenos"> 89</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">filt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">):</span>
</span><span id="Compose-90"><a href="#Compose-90"><span class="linenos"> 90</span></a>            <span class="n">document</span> <span class="o">=</span> <span class="n">filt</span><span class="o">.</span><span class="n">_apply</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="Compose-91"><a href="#Compose-91"><span class="linenos"> 91</span></a>        <span class="n">new_stat</span> <span class="o">=</span> <span class="n">get_doc_info</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="Compose-92"><a href="#Compose-92"><span class="linenos"> 92</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_statistics</span><span class="o">.</span><span class="n">update_by_diff</span><span class="p">(</span><span class="n">stat</span><span class="p">,</span> <span class="n">new_stat</span><span class="p">)</span>
</span><span id="Compose-93"><a href="#Compose-93"><span class="linenos"> 93</span></a>        <span class="k">return</span> <span class="n">document</span>
</span><span id="Compose-94"><a href="#Compose-94"><span class="linenos"> 94</span></a>
</span><span id="Compose-95"><a href="#Compose-95"><span class="linenos"> 95</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Document</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Document</span><span class="p">]:</span>
</span><span id="Compose-96"><a href="#Compose-96"><span class="linenos"> 96</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Compose-97"><a href="#Compose-97"><span class="linenos"> 97</span></a><span class="sd">        Apply the composed filter to a batch of documents and return the processed documents.</span>
</span><span id="Compose-98"><a href="#Compose-98"><span class="linenos"> 98</span></a><span class="sd">        The `apply_batch` method implemented in sub-filters is called in order.</span>
</span><span id="Compose-99"><a href="#Compose-99"><span class="linenos"> 99</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Compose-100"><a href="#Compose-100"><span class="linenos">100</span></a>
</span><span id="Compose-101"><a href="#Compose-101"><span class="linenos">101</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_doc_info</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">]</span>
</span><span id="Compose-102"><a href="#Compose-102"><span class="linenos">102</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">filt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">):</span>
</span><span id="Compose-103"><a href="#Compose-103"><span class="linenos">103</span></a>            <span class="n">batch</span> <span class="o">=</span> <span class="n">filt</span><span class="o">.</span><span class="n">_apply_batch</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
</span><span id="Compose-104"><a href="#Compose-104"><span class="linenos">104</span></a>        <span class="n">batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finalize_batch</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">stats</span><span class="p">)</span>
</span><span id="Compose-105"><a href="#Compose-105"><span class="linenos">105</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
</span><span id="Compose-106"><a href="#Compose-106"><span class="linenos">106</span></a>
</span><span id="Compose-107"><a href="#Compose-107"><span class="linenos">107</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Document</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Document</span><span class="p">]:</span>
</span><span id="Compose-108"><a href="#Compose-108"><span class="linenos">108</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Compose-109"><a href="#Compose-109"><span class="linenos">109</span></a><span class="sd">        Apply the composed filter to a stream of documents and return the processed documents.</span>
</span><span id="Compose-110"><a href="#Compose-110"><span class="linenos">110</span></a><span class="sd">        The `apply_stream` method implemented in sub-filters is called in order.</span>
</span><span id="Compose-111"><a href="#Compose-111"><span class="linenos">111</span></a>
</span><span id="Compose-112"><a href="#Compose-112"><span class="linenos">112</span></a>
</span><span id="Compose-113"><a href="#Compose-113"><span class="linenos">113</span></a><span class="sd">        In a sub-filter, if `apply_batch` is overridden and implemented, you need to set `use_batch`</span>
</span><span id="Compose-114"><a href="#Compose-114"><span class="linenos">114</span></a><span class="sd">        to True at that filter to utilize that implementation. Otherwise, the</span>
</span><span id="Compose-115"><a href="#Compose-115"><span class="linenos">115</span></a><span class="sd">        method implemented in `apply` will be applied to the stream.</span>
</span><span id="Compose-116"><a href="#Compose-116"><span class="linenos">116</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Compose-117"><a href="#Compose-117"><span class="linenos">117</span></a>        <span class="n">stream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_input_stats</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
</span><span id="Compose-118"><a href="#Compose-118"><span class="linenos">118</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">filt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">):</span>
</span><span id="Compose-119"><a href="#Compose-119"><span class="linenos">119</span></a>            <span class="n">stream</span> <span class="o">=</span> <span class="n">filt</span><span class="o">.</span><span class="n">apply_stream</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
</span><span id="Compose-120"><a href="#Compose-120"><span class="linenos">120</span></a>
</span><span id="Compose-121"><a href="#Compose-121"><span class="linenos">121</span></a>        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">stream</span><span class="p">:</span>
</span><span id="Compose-122"><a href="#Compose-122"><span class="linenos">122</span></a>            <span class="n">in_stat</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">extras</span><span class="p">[</span><span class="s2">&quot;__init_stats&quot;</span><span class="p">]</span>
</span><span id="Compose-123"><a href="#Compose-123"><span class="linenos">123</span></a>            <span class="n">out_stat</span> <span class="o">=</span> <span class="n">get_doc_info</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
</span><span id="Compose-124"><a href="#Compose-124"><span class="linenos">124</span></a>
</span><span id="Compose-125"><a href="#Compose-125"><span class="linenos">125</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_statistics</span><span class="o">.</span><span class="n">update_by_diff</span><span class="p">(</span><span class="n">in_stat</span><span class="p">,</span> <span class="n">out_stat</span><span class="p">)</span>
</span><span id="Compose-126"><a href="#Compose-126"><span class="linenos">126</span></a>            <span class="k">del</span> <span class="n">doc</span><span class="o">.</span><span class="n">extras</span><span class="p">[</span><span class="s2">&quot;__init_stats&quot;</span><span class="p">]</span>
</span><span id="Compose-127"><a href="#Compose-127"><span class="linenos">127</span></a>            <span class="k">yield</span> <span class="n">doc</span>
</span><span id="Compose-128"><a href="#Compose-128"><span class="linenos">128</span></a>
</span><span id="Compose-129"><a href="#Compose-129"><span class="linenos">129</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_count_input_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Document</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Document</span><span class="p">]:</span>
</span><span id="Compose-130"><a href="#Compose-130"><span class="linenos">130</span></a>        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">stream</span><span class="p">:</span>
</span><span id="Compose-131"><a href="#Compose-131"><span class="linenos">131</span></a>            <span class="n">doc</span><span class="o">.</span><span class="n">extras</span><span class="p">[</span><span class="s2">&quot;__init_stats&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_doc_info</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
</span><span id="Compose-132"><a href="#Compose-132"><span class="linenos">132</span></a>            <span class="k">yield</span> <span class="n">doc</span>
</span><span id="Compose-133"><a href="#Compose-133"><span class="linenos">133</span></a>
</span><span id="Compose-134"><a href="#Compose-134"><span class="linenos">134</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_total_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Statistics</span><span class="p">]:</span>
</span><span id="Compose-135"><a href="#Compose-135"><span class="linenos">135</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Compose-136"><a href="#Compose-136"><span class="linenos">136</span></a><span class="sd">        Get the statistics of the Compose object and sub filters.</span>
</span><span id="Compose-137"><a href="#Compose-137"><span class="linenos">137</span></a>
</span><span id="Compose-138"><a href="#Compose-138"><span class="linenos">138</span></a><span class="sd">        The statistics of the Compose class are stored in an object with the name &quot;Total&quot;,</span>
</span><span id="Compose-139"><a href="#Compose-139"><span class="linenos">139</span></a><span class="sd">        and sub-filters&#39;s are stored with names in the format {filter_index}-{filter class name}.</span>
</span><span id="Compose-140"><a href="#Compose-140"><span class="linenos">140</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Compose-141"><a href="#Compose-141"><span class="linenos">141</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Compose-142"><a href="#Compose-142"><span class="linenos">142</span></a>        <span class="n">stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_statistics</span><span class="p">())</span>
</span><span id="Compose-143"><a href="#Compose-143"><span class="linenos">143</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">filt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">):</span>
</span><span id="Compose-144"><a href="#Compose-144"><span class="linenos">144</span></a>            <span class="n">stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filt</span><span class="o">.</span><span class="n">get_statistics</span><span class="p">())</span>
</span><span id="Compose-145"><a href="#Compose-145"><span class="linenos">145</span></a>        <span class="k">return</span> <span class="n">stats</span>
</span><span id="Compose-146"><a href="#Compose-146"><span class="linenos">146</span></a>
</span><span id="Compose-147"><a href="#Compose-147"><span class="linenos">147</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_total_statistics_map</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="Compose-148"><a href="#Compose-148"><span class="linenos">148</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Compose-149"><a href="#Compose-149"><span class="linenos">149</span></a><span class="sd">        Get the statistics of the Compose object and sub filters as a list of dictionaries.</span>
</span><span id="Compose-150"><a href="#Compose-150"><span class="linenos">150</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Compose-151"><a href="#Compose-151"><span class="linenos">151</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_total_statistics</span><span class="p">()</span>
</span><span id="Compose-152"><a href="#Compose-152"><span class="linenos">152</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">stat</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">]</span>
</span><span id="Compose-153"><a href="#Compose-153"><span class="linenos">153</span></a>
</span><span id="Compose-154"><a href="#Compose-154"><span class="linenos">154</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Compose-155"><a href="#Compose-155"><span class="linenos">155</span></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">:</span>
</span><span id="Compose-156"><a href="#Compose-156"><span class="linenos">156</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</span><span id="Compose-157"><a href="#Compose-157"><span class="linenos">157</span></a>
</span><span id="Compose-158"><a href="#Compose-158"><span class="linenos">158</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</span><span id="Compose-159"><a href="#Compose-159"><span class="linenos">159</span></a>
</span><span id="Compose-160"><a href="#Compose-160"><span class="linenos">160</span></a>    <span class="nd">@property</span>
</span><span id="Compose-161"><a href="#Compose-161"><span class="linenos">161</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="Compose-162"><a href="#Compose-162"><span class="linenos">162</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Compose-163"><a href="#Compose-163"><span class="linenos">163</span></a><span class="sd">        Deprecated</span>
</span><span id="Compose-164"><a href="#Compose-164"><span class="linenos">164</span></a>
</span><span id="Compose-165"><a href="#Compose-165"><span class="linenos">165</span></a><span class="sd">        Get the statistics of the Compose object and sub filters.</span>
</span><span id="Compose-166"><a href="#Compose-166"><span class="linenos">166</span></a>
</span><span id="Compose-167"><a href="#Compose-167"><span class="linenos">167</span></a><span class="sd">        This property is retained for compatibility with previous versions.</span>
</span><span id="Compose-168"><a href="#Compose-168"><span class="linenos">168</span></a><span class="sd">        Please use `get_total_statistics` or `get_total_statistics_map` instead.</span>
</span><span id="Compose-169"><a href="#Compose-169"><span class="linenos">169</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Compose-170"><a href="#Compose-170"><span class="linenos">170</span></a>        <span class="k">return</span> <span class="n">inspection</span><span class="o">.</span><span class="n">statistics_obj_adapter</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="Compose-171"><a href="#Compose-171"><span class="linenos">171</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_total_statistics</span><span class="p">()</span>
</span><span id="Compose-172"><a href="#Compose-172"><span class="linenos">172</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">get_human_readable_values</span><span class="p">()</span>
</span><span id="Compose-173"><a href="#Compose-173"><span class="linenos">173</span></a>
</span><span id="Compose-174"><a href="#Compose-174"><span class="linenos">174</span></a>    <span class="nd">@property</span>
</span><span id="Compose-175"><a href="#Compose-175"><span class="linenos">175</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">statistics_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">inspection</span><span class="o">.</span><span class="n">StatsContainer</span><span class="p">:</span>
</span><span id="Compose-176"><a href="#Compose-176"><span class="linenos">176</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Compose-177"><a href="#Compose-177"><span class="linenos">177</span></a><span class="sd">        Deprecated</span>
</span><span id="Compose-178"><a href="#Compose-178"><span class="linenos">178</span></a>
</span><span id="Compose-179"><a href="#Compose-179"><span class="linenos">179</span></a><span class="sd">        Get the statistics of the Compose object and sub filters.</span>
</span><span id="Compose-180"><a href="#Compose-180"><span class="linenos">180</span></a><span class="sd">        This method returns a StatsContainer object which contains the statistics</span>
</span><span id="Compose-181"><a href="#Compose-181"><span class="linenos">181</span></a><span class="sd">        of the Compose object and sub filters.</span>
</span><span id="Compose-182"><a href="#Compose-182"><span class="linenos">182</span></a>
</span><span id="Compose-183"><a href="#Compose-183"><span class="linenos">183</span></a><span class="sd">        This property is retained for compatibility with previous versions.</span>
</span><span id="Compose-184"><a href="#Compose-184"><span class="linenos">184</span></a><span class="sd">        Please use `get_total_statistics` or `get_total_statistics_map` instead.</span>
</span><span id="Compose-185"><a href="#Compose-185"><span class="linenos">185</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Compose-186"><a href="#Compose-186"><span class="linenos">186</span></a>        <span class="k">return</span> <span class="n">inspection</span><span class="o">.</span><span class="n">statistics_obj_adapter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_total_statistics</span><span class="p">())</span>  <span class="c1"># type: ignore</span>
</span><span id="Compose-187"><a href="#Compose-187"><span class="linenos">187</span></a>
</span><span id="Compose-188"><a href="#Compose-188"><span class="linenos">188</span></a>    <span class="nd">@deprecated_since</span><span class="p">(</span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span> <span class="s2">&quot;get_total_statistics&quot;</span><span class="p">)</span>
</span><span id="Compose-189"><a href="#Compose-189"><span class="linenos">189</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;print&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Compose-190"><a href="#Compose-190"><span class="linenos">190</span></a>        <span class="n">info</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Compose-191"><a href="#Compose-191"><span class="linenos">191</span></a>            <span class="p">{</span>
</span><span id="Compose-192"><a href="#Compose-192"><span class="linenos">192</span></a>                <span class="s2">&quot;layer&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span>
</span><span id="Compose-193"><a href="#Compose-193"><span class="linenos">193</span></a>                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">filt</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="Compose-194"><a href="#Compose-194"><span class="linenos">194</span></a>                <span class="s2">&quot;doc&quot;</span><span class="p">:</span> <span class="n">filt</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">,</span>
</span><span id="Compose-195"><a href="#Compose-195"><span class="linenos">195</span></a>            <span class="p">}</span>
</span><span id="Compose-196"><a href="#Compose-196"><span class="linenos">196</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">filt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">)</span>
</span><span id="Compose-197"><a href="#Compose-197"><span class="linenos">197</span></a>        <span class="p">]</span>
</span><span id="Compose-198"><a href="#Compose-198"><span class="linenos">198</span></a>
</span><span id="Compose-199"><a href="#Compose-199"><span class="linenos">199</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">to_json</span><span class="p">(</span><span class="n">filter_info</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="Compose-200"><a href="#Compose-200"><span class="linenos">200</span></a>            <span class="n">filter_info</span><span class="p">[</span><span class="s2">&quot;doc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">filter_info</span><span class="p">[</span><span class="s2">&quot;doc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
</span><span id="Compose-201"><a href="#Compose-201"><span class="linenos">201</span></a>            <span class="k">return</span> <span class="n">filter_info</span>
</span><span id="Compose-202"><a href="#Compose-202"><span class="linenos">202</span></a>
</span><span id="Compose-203"><a href="#Compose-203"><span class="linenos">203</span></a>        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">:</span>
</span><span id="Compose-204"><a href="#Compose-204"><span class="linenos">204</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">to_json</span><span class="p">,</span> <span class="n">info</span><span class="p">)),</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">))</span>
</span><span id="Compose-205"><a href="#Compose-205"><span class="linenos">205</span></a>        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;print&quot;</span><span class="p">:</span>
</span><span id="Compose-206"><a href="#Compose-206"><span class="linenos">206</span></a>            <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">info</span><span class="p">:</span>
</span><span id="Compose-207"><a href="#Compose-207"><span class="linenos">207</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">layer</span><span class="p">[</span><span class="s1">&#39;layer&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">layer</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Compose-208"><a href="#Compose-208"><span class="linenos">208</span></a>                <span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">layer</span><span class="p">[</span><span class="s2">&quot;doc&quot;</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Base class for all filters.
Document-level filters must inherit from this class.</p>

<p>The definition of text processing is in <code><a href="#Compose.apply">apply</a></code> method.
If you define a new filter, override the method.</p>

<p>When this class is called, apply the filter from string to string.</p>

<p>With context manager, you can use the filter as follows:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="k">with</span> <span class="n">YourFilter</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span> <span class="k">as</span> <span class="n">filt</span><span class="p">:</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">filt</span><span class="p">(</span><span class="s2">&quot;This is a sample text.&quot;</span><span class="p">)</span>
</code></pre>
</div>
</div>


                            <div id="Compose.__init__" class="classattr">
                                        <input id="Compose.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Compose</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">filters</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Filter">hojichar.Filter</a></span><span class="p">,</span> <span class="n"><a href="#TokenFilter">hojichar.TokenFilter</a></span><span class="p">]]</span>,</span><span class="param">	<span class="n">random_state</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">_generator</span><span class="o">.</span><span class="n">Generator</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span></span>)</span>

                <label class="view-source-button" for="Compose.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Compose.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Compose.__init__-16"><a href="#Compose.__init__-16"><span class="linenos">16</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="Compose.__init__-17"><a href="#Compose.__init__-17"><span class="linenos">17</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Compose.__init__-18"><a href="#Compose.__init__-18"><span class="linenos">18</span></a>        <span class="n">filters</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Filter</span><span class="p">,</span> <span class="n">TokenFilter</span><span class="p">]],</span>
</span><span id="Compose.__init__-19"><a href="#Compose.__init__-19"><span class="linenos">19</span></a>        <span class="n">random_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">Generator</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Compose.__init__-20"><a href="#Compose.__init__-20"><span class="linenos">20</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="Compose.__init__-21"><a href="#Compose.__init__-21"><span class="linenos">21</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="Compose.__init__-22"><a href="#Compose.__init__-22"><span class="linenos">22</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Compose.__init__-23"><a href="#Compose.__init__-23"><span class="linenos">23</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Compose.__init__-24"><a href="#Compose.__init__-24"><span class="linenos">24</span></a><span class="sd">        Compose a filter from pre-defined filter-objects.</span>
</span><span id="Compose.__init__-25"><a href="#Compose.__init__-25"><span class="linenos">25</span></a><span class="sd">        Filter which has `skip_rejected` flag ignores a document which has `is_rejected` flag.</span>
</span><span id="Compose.__init__-26"><a href="#Compose.__init__-26"><span class="linenos">26</span></a><span class="sd">        By doing so, Compose avoid applying filters that do not affect the output.</span>
</span><span id="Compose.__init__-27"><a href="#Compose.__init__-27"><span class="linenos">27</span></a>
</span><span id="Compose.__init__-28"><a href="#Compose.__init__-28"><span class="linenos">28</span></a><span class="sd">        Parameters</span>
</span><span id="Compose.__init__-29"><a href="#Compose.__init__-29"><span class="linenos">29</span></a><span class="sd">        ----------</span>
</span><span id="Compose.__init__-30"><a href="#Compose.__init__-30"><span class="linenos">30</span></a><span class="sd">        filters : List[Union[Filter, TokenFilter]]</span>
</span><span id="Compose.__init__-31"><a href="#Compose.__init__-31"><span class="linenos">31</span></a><span class="sd">            Filter instances which apply to the corpus.</span>
</span><span id="Compose.__init__-32"><a href="#Compose.__init__-32"><span class="linenos">32</span></a>
</span><span id="Compose.__init__-33"><a href="#Compose.__init__-33"><span class="linenos">33</span></a><span class="sd">        random_state : Union[None, int, np.random.Generator], optional</span>
</span><span id="Compose.__init__-34"><a href="#Compose.__init__-34"><span class="linenos">34</span></a><span class="sd">            Default = None</span>
</span><span id="Compose.__init__-35"><a href="#Compose.__init__-35"><span class="linenos">35</span></a><span class="sd">            Seed for applying filters randomly.</span>
</span><span id="Compose.__init__-36"><a href="#Compose.__init__-36"><span class="linenos">36</span></a><span class="sd">            `random_state` must be int or np.random.Generator instance.</span>
</span><span id="Compose.__init__-37"><a href="#Compose.__init__-37"><span class="linenos">37</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Compose.__init__-38"><a href="#Compose.__init__-38"><span class="linenos">38</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Compose.__init__-39"><a href="#Compose.__init__-39"><span class="linenos">39</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_filters</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
</span><span id="Compose.__init__-40"><a href="#Compose.__init__-40"><span class="linenos">40</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__module__</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Compose.__init__-41"><a href="#Compose.__init__-41"><span class="linenos">41</span></a>
</span><span id="Compose.__init__-42"><a href="#Compose.__init__-42"><span class="linenos">42</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_statistics</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Total&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Compose a filter from pre-defined filter-objects.
Filter which has <code>skip_rejected</code> flag ignores a document which has <code>is_rejected</code> flag.
By doing so, Compose avoid applying filters that do not affect the output.</p>

<h2 id="parameters">Parameters</h2>

<p>filters : List[Union[Filter, TokenFilter]]
    Filter instances which apply to the corpus.</p>

<p>random_state : Union[None, int, np.random.Generator], optional
    Default = None
    Seed for applying filters randomly.
    <code>random_state</code> must be int or np.random.Generator instance.</p>
</div>


                            </div>
                            <div id="Compose.set_filters" class="classattr">
                                        <input id="Compose.set_filters-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_filters</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">filters</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Filter">hojichar.Filter</a></span><span class="p">,</span> <span class="n"><a href="#TokenFilter">hojichar.TokenFilter</a></span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Compose.set_filters-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Compose.set_filters"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Compose.set_filters-44"><a href="#Compose.set_filters-44"><span class="linenos">44</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Filter</span><span class="p">,</span> <span class="n">TokenFilter</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Compose.set_filters-45"><a href="#Compose.set_filters-45"><span class="linenos">45</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Compose.set_filters-46"><a href="#Compose.set_filters-46"><span class="linenos">46</span></a><span class="sd">        Set the filter to a Compose object. The filter is expanded if the</span>
</span><span id="Compose.set_filters-47"><a href="#Compose.set_filters-47"><span class="linenos">47</span></a><span class="sd">        list of filters in the argument contains a filter bound by Compose.</span>
</span><span id="Compose.set_filters-48"><a href="#Compose.set_filters-48"><span class="linenos">48</span></a>
</span><span id="Compose.set_filters-49"><a href="#Compose.set_filters-49"><span class="linenos">49</span></a><span class="sd">        Args:</span>
</span><span id="Compose.set_filters-50"><a href="#Compose.set_filters-50"><span class="linenos">50</span></a><span class="sd">            filters (List[Union[Filter, TokenFilter]]): Target filters</span>
</span><span id="Compose.set_filters-51"><a href="#Compose.set_filters-51"><span class="linenos">51</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Compose.set_filters-52"><a href="#Compose.set_filters-52"><span class="linenos">52</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Filter</span><span class="p">,</span> <span class="n">TokenFilter</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Compose.set_filters-53"><a href="#Compose.set_filters-53"><span class="linenos">53</span></a>
</span><span id="Compose.set_filters-54"><a href="#Compose.set_filters-54"><span class="linenos">54</span></a>        <span class="n">filter_idx</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Compose.set_filters-55"><a href="#Compose.set_filters-55"><span class="linenos">55</span></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">:</span>
</span><span id="Compose.set_filters-56"><a href="#Compose.set_filters-56"><span class="linenos">56</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">Compose</span><span class="p">):</span>
</span><span id="Compose.set_filters-57"><a href="#Compose.set_filters-57"><span class="linenos">57</span></a>                <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">filters</span><span class="p">:</span>
</span><span id="Compose.set_filters-58"><a href="#Compose.set_filters-58"><span class="linenos">58</span></a>                    <span class="n">sub</span><span class="o">.</span><span class="n">_set_rng_if_not_initialized</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rng</span><span class="p">)</span>
</span><span id="Compose.set_filters-59"><a href="#Compose.set_filters-59"><span class="linenos">59</span></a>                    <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filter_idx</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">sub</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Compose.set_filters-60"><a href="#Compose.set_filters-60"><span class="linenos">60</span></a>                    <span class="n">sub</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="Compose.set_filters-61"><a href="#Compose.set_filters-61"><span class="linenos">61</span></a>                    <span class="n">sub</span><span class="o">.</span><span class="n">_statistics</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="Compose.set_filters-62"><a href="#Compose.set_filters-62"><span class="linenos">62</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span>
</span><span id="Compose.set_filters-63"><a href="#Compose.set_filters-63"><span class="linenos">63</span></a>                    <span class="n">filter_idx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Compose.set_filters-64"><a href="#Compose.set_filters-64"><span class="linenos">64</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Compose.set_filters-65"><a href="#Compose.set_filters-65"><span class="linenos">65</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">_set_rng_if_not_initialized</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rng</span><span class="p">)</span>
</span><span id="Compose.set_filters-66"><a href="#Compose.set_filters-66"><span class="linenos">66</span></a>                <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filter_idx</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Compose.set_filters-67"><a href="#Compose.set_filters-67"><span class="linenos">67</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="Compose.set_filters-68"><a href="#Compose.set_filters-68"><span class="linenos">68</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">_statistics</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="Compose.set_filters-69"><a href="#Compose.set_filters-69"><span class="linenos">69</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="Compose.set_filters-70"><a href="#Compose.set_filters-70"><span class="linenos">70</span></a>                <span class="n">filter_idx</span> <span class="o">+=</span> <span class="mi">1</span>
</span></pre></div>


            <div class="docstring"><p>Set the filter to a Compose object. The filter is expanded if the
list of filters in the argument contains a filter bound by Compose.</p>

<p>Args:
    filters (List[Union[Filter, TokenFilter]]): Target filters</p>
</div>


                            </div>
                            <div id="Compose.apply" class="classattr">
                                        <input id="Compose.apply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">apply</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">document</span><span class="p">:</span> <span class="n"><a href="#Document">hojichar.Document</a></span></span><span class="return-annotation">) -> <span class="n"><a href="#Document">hojichar.Document</a></span>:</span></span>

                <label class="view-source-button" for="Compose.apply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Compose.apply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Compose.apply-84"><a href="#Compose.apply-84"><span class="linenos">84</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Document</span><span class="p">:</span>
</span><span id="Compose.apply-85"><a href="#Compose.apply-85"><span class="linenos">85</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Compose.apply-86"><a href="#Compose.apply-86"><span class="linenos">86</span></a><span class="sd">        Apply the composed filter to a document and return the processed document.</span>
</span><span id="Compose.apply-87"><a href="#Compose.apply-87"><span class="linenos">87</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Compose.apply-88"><a href="#Compose.apply-88"><span class="linenos">88</span></a>        <span class="n">stat</span> <span class="o">=</span> <span class="n">get_doc_info</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="Compose.apply-89"><a href="#Compose.apply-89"><span class="linenos">89</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">filt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">):</span>
</span><span id="Compose.apply-90"><a href="#Compose.apply-90"><span class="linenos">90</span></a>            <span class="n">document</span> <span class="o">=</span> <span class="n">filt</span><span class="o">.</span><span class="n">_apply</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="Compose.apply-91"><a href="#Compose.apply-91"><span class="linenos">91</span></a>        <span class="n">new_stat</span> <span class="o">=</span> <span class="n">get_doc_info</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="Compose.apply-92"><a href="#Compose.apply-92"><span class="linenos">92</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_statistics</span><span class="o">.</span><span class="n">update_by_diff</span><span class="p">(</span><span class="n">stat</span><span class="p">,</span> <span class="n">new_stat</span><span class="p">)</span>
</span><span id="Compose.apply-93"><a href="#Compose.apply-93"><span class="linenos">93</span></a>        <span class="k">return</span> <span class="n">document</span>
</span></pre></div>


            <div class="docstring"><p>Apply the composed filter to a document and return the processed document.</p>
</div>


                            </div>
                            <div id="Compose.apply_batch" class="classattr">
                                        <input id="Compose.apply_batch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">apply_batch</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">batch</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n"><a href="#Document">hojichar.Document</a></span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="n"><a href="#Document">hojichar.Document</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Compose.apply_batch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Compose.apply_batch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Compose.apply_batch-95"><a href="#Compose.apply_batch-95"><span class="linenos"> 95</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Document</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Document</span><span class="p">]:</span>
</span><span id="Compose.apply_batch-96"><a href="#Compose.apply_batch-96"><span class="linenos"> 96</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Compose.apply_batch-97"><a href="#Compose.apply_batch-97"><span class="linenos"> 97</span></a><span class="sd">        Apply the composed filter to a batch of documents and return the processed documents.</span>
</span><span id="Compose.apply_batch-98"><a href="#Compose.apply_batch-98"><span class="linenos"> 98</span></a><span class="sd">        The `apply_batch` method implemented in sub-filters is called in order.</span>
</span><span id="Compose.apply_batch-99"><a href="#Compose.apply_batch-99"><span class="linenos"> 99</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Compose.apply_batch-100"><a href="#Compose.apply_batch-100"><span class="linenos">100</span></a>
</span><span id="Compose.apply_batch-101"><a href="#Compose.apply_batch-101"><span class="linenos">101</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_doc_info</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">]</span>
</span><span id="Compose.apply_batch-102"><a href="#Compose.apply_batch-102"><span class="linenos">102</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">filt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">):</span>
</span><span id="Compose.apply_batch-103"><a href="#Compose.apply_batch-103"><span class="linenos">103</span></a>            <span class="n">batch</span> <span class="o">=</span> <span class="n">filt</span><span class="o">.</span><span class="n">_apply_batch</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
</span><span id="Compose.apply_batch-104"><a href="#Compose.apply_batch-104"><span class="linenos">104</span></a>        <span class="n">batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finalize_batch</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">stats</span><span class="p">)</span>
</span><span id="Compose.apply_batch-105"><a href="#Compose.apply_batch-105"><span class="linenos">105</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Apply the composed filter to a batch of documents and return the processed documents.
The <code><a href="#Compose.apply_batch">apply_batch</a></code> method implemented in sub-filters is called in order.</p>
</div>


                            </div>
                            <div id="Compose.apply_stream" class="classattr">
                                        <input id="Compose.apply_stream-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">apply_stream</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">stream</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n"><a href="#Document">hojichar.Document</a></span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">Iterable</span><span class="p">[</span><span class="n"><a href="#Document">hojichar.Document</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Compose.apply_stream-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Compose.apply_stream"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Compose.apply_stream-107"><a href="#Compose.apply_stream-107"><span class="linenos">107</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Document</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Document</span><span class="p">]:</span>
</span><span id="Compose.apply_stream-108"><a href="#Compose.apply_stream-108"><span class="linenos">108</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Compose.apply_stream-109"><a href="#Compose.apply_stream-109"><span class="linenos">109</span></a><span class="sd">        Apply the composed filter to a stream of documents and return the processed documents.</span>
</span><span id="Compose.apply_stream-110"><a href="#Compose.apply_stream-110"><span class="linenos">110</span></a><span class="sd">        The `apply_stream` method implemented in sub-filters is called in order.</span>
</span><span id="Compose.apply_stream-111"><a href="#Compose.apply_stream-111"><span class="linenos">111</span></a>
</span><span id="Compose.apply_stream-112"><a href="#Compose.apply_stream-112"><span class="linenos">112</span></a>
</span><span id="Compose.apply_stream-113"><a href="#Compose.apply_stream-113"><span class="linenos">113</span></a><span class="sd">        In a sub-filter, if `apply_batch` is overridden and implemented, you need to set `use_batch`</span>
</span><span id="Compose.apply_stream-114"><a href="#Compose.apply_stream-114"><span class="linenos">114</span></a><span class="sd">        to True at that filter to utilize that implementation. Otherwise, the</span>
</span><span id="Compose.apply_stream-115"><a href="#Compose.apply_stream-115"><span class="linenos">115</span></a><span class="sd">        method implemented in `apply` will be applied to the stream.</span>
</span><span id="Compose.apply_stream-116"><a href="#Compose.apply_stream-116"><span class="linenos">116</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Compose.apply_stream-117"><a href="#Compose.apply_stream-117"><span class="linenos">117</span></a>        <span class="n">stream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_input_stats</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
</span><span id="Compose.apply_stream-118"><a href="#Compose.apply_stream-118"><span class="linenos">118</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">filt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">):</span>
</span><span id="Compose.apply_stream-119"><a href="#Compose.apply_stream-119"><span class="linenos">119</span></a>            <span class="n">stream</span> <span class="o">=</span> <span class="n">filt</span><span class="o">.</span><span class="n">apply_stream</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
</span><span id="Compose.apply_stream-120"><a href="#Compose.apply_stream-120"><span class="linenos">120</span></a>
</span><span id="Compose.apply_stream-121"><a href="#Compose.apply_stream-121"><span class="linenos">121</span></a>        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">stream</span><span class="p">:</span>
</span><span id="Compose.apply_stream-122"><a href="#Compose.apply_stream-122"><span class="linenos">122</span></a>            <span class="n">in_stat</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">extras</span><span class="p">[</span><span class="s2">&quot;__init_stats&quot;</span><span class="p">]</span>
</span><span id="Compose.apply_stream-123"><a href="#Compose.apply_stream-123"><span class="linenos">123</span></a>            <span class="n">out_stat</span> <span class="o">=</span> <span class="n">get_doc_info</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
</span><span id="Compose.apply_stream-124"><a href="#Compose.apply_stream-124"><span class="linenos">124</span></a>
</span><span id="Compose.apply_stream-125"><a href="#Compose.apply_stream-125"><span class="linenos">125</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_statistics</span><span class="o">.</span><span class="n">update_by_diff</span><span class="p">(</span><span class="n">in_stat</span><span class="p">,</span> <span class="n">out_stat</span><span class="p">)</span>
</span><span id="Compose.apply_stream-126"><a href="#Compose.apply_stream-126"><span class="linenos">126</span></a>            <span class="k">del</span> <span class="n">doc</span><span class="o">.</span><span class="n">extras</span><span class="p">[</span><span class="s2">&quot;__init_stats&quot;</span><span class="p">]</span>
</span><span id="Compose.apply_stream-127"><a href="#Compose.apply_stream-127"><span class="linenos">127</span></a>            <span class="k">yield</span> <span class="n">doc</span>
</span></pre></div>


            <div class="docstring"><p>Apply the composed filter to a stream of documents and return the processed documents.
The <code><a href="#Compose.apply_stream">apply_stream</a></code> method implemented in sub-filters is called in order.</p>

<p>In a sub-filter, if <code><a href="#Compose.apply_batch">apply_batch</a></code> is overridden and implemented, you need to set <code>use_batch</code>
to True at that filter to utilize that implementation. Otherwise, the
method implemented in <code><a href="#Compose.apply">apply</a></code> will be applied to the stream.</p>
</div>


                            </div>
                            <div id="Compose.get_total_statistics" class="classattr">
                                        <input id="Compose.get_total_statistics-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_total_statistics</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="n"><a href="hojichar/core/models.html#Statistics">hojichar.core.models.Statistics</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Compose.get_total_statistics-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Compose.get_total_statistics"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Compose.get_total_statistics-134"><a href="#Compose.get_total_statistics-134"><span class="linenos">134</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_total_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Statistics</span><span class="p">]:</span>
</span><span id="Compose.get_total_statistics-135"><a href="#Compose.get_total_statistics-135"><span class="linenos">135</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Compose.get_total_statistics-136"><a href="#Compose.get_total_statistics-136"><span class="linenos">136</span></a><span class="sd">        Get the statistics of the Compose object and sub filters.</span>
</span><span id="Compose.get_total_statistics-137"><a href="#Compose.get_total_statistics-137"><span class="linenos">137</span></a>
</span><span id="Compose.get_total_statistics-138"><a href="#Compose.get_total_statistics-138"><span class="linenos">138</span></a><span class="sd">        The statistics of the Compose class are stored in an object with the name &quot;Total&quot;,</span>
</span><span id="Compose.get_total_statistics-139"><a href="#Compose.get_total_statistics-139"><span class="linenos">139</span></a><span class="sd">        and sub-filters&#39;s are stored with names in the format {filter_index}-{filter class name}.</span>
</span><span id="Compose.get_total_statistics-140"><a href="#Compose.get_total_statistics-140"><span class="linenos">140</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Compose.get_total_statistics-141"><a href="#Compose.get_total_statistics-141"><span class="linenos">141</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Compose.get_total_statistics-142"><a href="#Compose.get_total_statistics-142"><span class="linenos">142</span></a>        <span class="n">stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_statistics</span><span class="p">())</span>
</span><span id="Compose.get_total_statistics-143"><a href="#Compose.get_total_statistics-143"><span class="linenos">143</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">filt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">):</span>
</span><span id="Compose.get_total_statistics-144"><a href="#Compose.get_total_statistics-144"><span class="linenos">144</span></a>            <span class="n">stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filt</span><span class="o">.</span><span class="n">get_statistics</span><span class="p">())</span>
</span><span id="Compose.get_total_statistics-145"><a href="#Compose.get_total_statistics-145"><span class="linenos">145</span></a>        <span class="k">return</span> <span class="n">stats</span>
</span></pre></div>


            <div class="docstring"><p>Get the statistics of the Compose object and sub filters.</p>

<p>The statistics of the Compose class are stored in an object with the name "Total",
and sub-filters's are stored with names in the format {filter_index}-{filter class name}.</p>
</div>


                            </div>
                            <div id="Compose.get_total_statistics_map" class="classattr">
                                        <input id="Compose.get_total_statistics_map-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_total_statistics_map</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="Compose.get_total_statistics_map-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Compose.get_total_statistics_map"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Compose.get_total_statistics_map-147"><a href="#Compose.get_total_statistics_map-147"><span class="linenos">147</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_total_statistics_map</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="Compose.get_total_statistics_map-148"><a href="#Compose.get_total_statistics_map-148"><span class="linenos">148</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Compose.get_total_statistics_map-149"><a href="#Compose.get_total_statistics_map-149"><span class="linenos">149</span></a><span class="sd">        Get the statistics of the Compose object and sub filters as a list of dictionaries.</span>
</span><span id="Compose.get_total_statistics_map-150"><a href="#Compose.get_total_statistics_map-150"><span class="linenos">150</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Compose.get_total_statistics_map-151"><a href="#Compose.get_total_statistics_map-151"><span class="linenos">151</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_total_statistics</span><span class="p">()</span>
</span><span id="Compose.get_total_statistics_map-152"><a href="#Compose.get_total_statistics_map-152"><span class="linenos">152</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">stat</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Get the statistics of the Compose object and sub filters as a list of dictionaries.</p>
</div>


                            </div>
                            <div id="Compose.shutdown" class="classattr">
                                        <input id="Compose.shutdown-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">shutdown</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Compose.shutdown-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Compose.shutdown"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Compose.shutdown-154"><a href="#Compose.shutdown-154"><span class="linenos">154</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Compose.shutdown-155"><a href="#Compose.shutdown-155"><span class="linenos">155</span></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">:</span>
</span><span id="Compose.shutdown-156"><a href="#Compose.shutdown-156"><span class="linenos">156</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</span><span id="Compose.shutdown-157"><a href="#Compose.shutdown-157"><span class="linenos">157</span></a>
</span><span id="Compose.shutdown-158"><a href="#Compose.shutdown-158"><span class="linenos">158</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>This method is called when the filter is no longer needed.
You can override this method to release resources or perform cleanup tasks.</p>
</div>


                            </div>
                            <div id="Compose.statistics" class="classattr">
                                <div class="attr variable">
            <span class="name">statistics</span><span class="annotation">: dict</span>

        
    </div>
    <a class="headerlink" href="#Compose.statistics"></a>
    
            <div class="docstring"><p>Deprecated</p>

<p>Get the statistics of the Compose object and sub filters.</p>

<p>This property is retained for compatibility with previous versions.
Please use <code><a href="#Compose.get_total_statistics">get_total_statistics</a></code> or <code><a href="#Compose.get_total_statistics_map">get_total_statistics_map</a></code> instead.</p>
</div>


                            </div>
                            <div id="Compose.statistics_obj" class="classattr">
                                <div class="attr variable">
            <span class="name">statistics_obj</span><span class="annotation">: <a href="#StatsContainer">hojichar.StatsContainer</a></span>

        
    </div>
    <a class="headerlink" href="#Compose.statistics_obj"></a>
    
            <div class="docstring"><p>Deprecated</p>

<p>Get the statistics of the Compose object and sub filters.
This method returns a StatsContainer object which contains the statistics
of the Compose object and sub filters.</p>

<p>This property is retained for compatibility with previous versions.
Please use <code><a href="#Compose.get_total_statistics">get_total_statistics</a></code> or <code><a href="#Compose.get_total_statistics_map">get_total_statistics_map</a></code> instead.</p>
</div>


                            </div>
                            <div id="Compose.summary" class="classattr">
                                        <input id="Compose.summary-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@deprecated_since(&#39;1.0.0&#39;, &#39;get_total_statistics&#39;)</div>

        <span class="def">def</span>
        <span class="name">summary</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;print&#39;</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Compose.summary-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Compose.summary"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Compose.summary-188"><a href="#Compose.summary-188"><span class="linenos">188</span></a>    <span class="nd">@deprecated_since</span><span class="p">(</span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span> <span class="s2">&quot;get_total_statistics&quot;</span><span class="p">)</span>
</span><span id="Compose.summary-189"><a href="#Compose.summary-189"><span class="linenos">189</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;print&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Compose.summary-190"><a href="#Compose.summary-190"><span class="linenos">190</span></a>        <span class="n">info</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Compose.summary-191"><a href="#Compose.summary-191"><span class="linenos">191</span></a>            <span class="p">{</span>
</span><span id="Compose.summary-192"><a href="#Compose.summary-192"><span class="linenos">192</span></a>                <span class="s2">&quot;layer&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span>
</span><span id="Compose.summary-193"><a href="#Compose.summary-193"><span class="linenos">193</span></a>                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">filt</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="Compose.summary-194"><a href="#Compose.summary-194"><span class="linenos">194</span></a>                <span class="s2">&quot;doc&quot;</span><span class="p">:</span> <span class="n">filt</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">,</span>
</span><span id="Compose.summary-195"><a href="#Compose.summary-195"><span class="linenos">195</span></a>            <span class="p">}</span>
</span><span id="Compose.summary-196"><a href="#Compose.summary-196"><span class="linenos">196</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">filt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">)</span>
</span><span id="Compose.summary-197"><a href="#Compose.summary-197"><span class="linenos">197</span></a>        <span class="p">]</span>
</span><span id="Compose.summary-198"><a href="#Compose.summary-198"><span class="linenos">198</span></a>
</span><span id="Compose.summary-199"><a href="#Compose.summary-199"><span class="linenos">199</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">to_json</span><span class="p">(</span><span class="n">filter_info</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="Compose.summary-200"><a href="#Compose.summary-200"><span class="linenos">200</span></a>            <span class="n">filter_info</span><span class="p">[</span><span class="s2">&quot;doc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">filter_info</span><span class="p">[</span><span class="s2">&quot;doc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
</span><span id="Compose.summary-201"><a href="#Compose.summary-201"><span class="linenos">201</span></a>            <span class="k">return</span> <span class="n">filter_info</span>
</span><span id="Compose.summary-202"><a href="#Compose.summary-202"><span class="linenos">202</span></a>
</span><span id="Compose.summary-203"><a href="#Compose.summary-203"><span class="linenos">203</span></a>        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">:</span>
</span><span id="Compose.summary-204"><a href="#Compose.summary-204"><span class="linenos">204</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">to_json</span><span class="p">,</span> <span class="n">info</span><span class="p">)),</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">))</span>
</span><span id="Compose.summary-205"><a href="#Compose.summary-205"><span class="linenos">205</span></a>        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;print&quot;</span><span class="p">:</span>
</span><span id="Compose.summary-206"><a href="#Compose.summary-206"><span class="linenos">206</span></a>            <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">info</span><span class="p">:</span>
</span><span id="Compose.summary-207"><a href="#Compose.summary-207"><span class="linenos">207</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">layer</span><span class="p">[</span><span class="s1">&#39;layer&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">layer</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Compose.summary-208"><a href="#Compose.summary-208"><span class="linenos">208</span></a>                <span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">layer</span><span class="p">[</span><span class="s2">&quot;doc&quot;</span><span class="p">])</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#Filter">Filter</a></dt>
                                <dd id="Compose.apply_filter" class="function"><a href="#Filter.apply_filter">apply_filter</a></dd>
                <dd id="Compose.get_statistics" class="function"><a href="#Filter.get_statistics">get_statistics</a></dd>
                <dd id="Compose.get_statistics_map" class="function"><a href="#Filter.get_statistics_map">get_statistics_map</a></dd>
                <dd id="Compose.get_jsonable_vars" class="function"><a href="#Filter.get_jsonable_vars">get_jsonable_vars</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Filter">
                            <input id="Filter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Filter</span><wbr>(<span class="base">abc.ABC</span>):

                <label class="view-source-button" for="Filter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Filter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Filter-22"><a href="#Filter-22"><span class="linenos"> 22</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Filter</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
</span><span id="Filter-23"><a href="#Filter-23"><span class="linenos"> 23</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Filter-24"><a href="#Filter-24"><span class="linenos"> 24</span></a><span class="sd">    Base class for all filters.</span>
</span><span id="Filter-25"><a href="#Filter-25"><span class="linenos"> 25</span></a><span class="sd">    Document-level filters must inherit from this class.</span>
</span><span id="Filter-26"><a href="#Filter-26"><span class="linenos"> 26</span></a>
</span><span id="Filter-27"><a href="#Filter-27"><span class="linenos"> 27</span></a><span class="sd">    The definition of text processing is in `apply` method.</span>
</span><span id="Filter-28"><a href="#Filter-28"><span class="linenos"> 28</span></a><span class="sd">    If you define a new filter, override the method.</span>
</span><span id="Filter-29"><a href="#Filter-29"><span class="linenos"> 29</span></a>
</span><span id="Filter-30"><a href="#Filter-30"><span class="linenos"> 30</span></a><span class="sd">    When this class is called, apply the filter from string to string.</span>
</span><span id="Filter-31"><a href="#Filter-31"><span class="linenos"> 31</span></a>
</span><span id="Filter-32"><a href="#Filter-32"><span class="linenos"> 32</span></a><span class="sd">    With context manager, you can use the filter as follows:</span>
</span><span id="Filter-33"><a href="#Filter-33"><span class="linenos"> 33</span></a><span class="sd">    ```python</span>
</span><span id="Filter-34"><a href="#Filter-34"><span class="linenos"> 34</span></a><span class="sd">    with YourFilter(p=0.5) as filt:</span>
</span><span id="Filter-35"><a href="#Filter-35"><span class="linenos"> 35</span></a><span class="sd">        text = filt(&quot;This is a sample text.&quot;)</span>
</span><span id="Filter-36"><a href="#Filter-36"><span class="linenos"> 36</span></a><span class="sd">    ```</span>
</span><span id="Filter-37"><a href="#Filter-37"><span class="linenos"> 37</span></a>
</span><span id="Filter-38"><a href="#Filter-38"><span class="linenos"> 38</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Filter-39"><a href="#Filter-39"><span class="linenos"> 39</span></a>
</span><span id="Filter-40"><a href="#Filter-40"><span class="linenos"> 40</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="Filter-41"><a href="#Filter-41"><span class="linenos"> 41</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Filter-42"><a href="#Filter-42"><span class="linenos"> 42</span></a>        <span class="n">p</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="Filter-43"><a href="#Filter-43"><span class="linenos"> 43</span></a>        <span class="n">skip_rejected</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Filter-44"><a href="#Filter-44"><span class="linenos"> 44</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="Filter-45"><a href="#Filter-45"><span class="linenos"> 45</span></a>        <span class="n">random_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">Generator</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Filter-46"><a href="#Filter-46"><span class="linenos"> 46</span></a>        <span class="n">use_batch</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Filter-47"><a href="#Filter-47"><span class="linenos"> 47</span></a>        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
</span><span id="Filter-48"><a href="#Filter-48"><span class="linenos"> 48</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="Filter-49"><a href="#Filter-49"><span class="linenos"> 49</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Filter-50"><a href="#Filter-50"><span class="linenos"> 50</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Filter-51"><a href="#Filter-51"><span class="linenos"> 51</span></a><span class="sd">        Initialize the filter.</span>
</span><span id="Filter-52"><a href="#Filter-52"><span class="linenos"> 52</span></a><span class="sd">        Parameters</span>
</span><span id="Filter-53"><a href="#Filter-53"><span class="linenos"> 53</span></a><span class="sd">        ----------</span>
</span><span id="Filter-54"><a href="#Filter-54"><span class="linenos"> 54</span></a><span class="sd">        p : float</span>
</span><span id="Filter-55"><a href="#Filter-55"><span class="linenos"> 55</span></a><span class="sd">            The probability of applying the filter.</span>
</span><span id="Filter-56"><a href="#Filter-56"><span class="linenos"> 56</span></a><span class="sd">            If `p` is 1, the filter will always be applied.</span>
</span><span id="Filter-57"><a href="#Filter-57"><span class="linenos"> 57</span></a><span class="sd">        skip_rejected : bool</span>
</span><span id="Filter-58"><a href="#Filter-58"><span class="linenos"> 58</span></a><span class="sd">            If `True`, the filter will skip documents that are already rejected.</span>
</span><span id="Filter-59"><a href="#Filter-59"><span class="linenos"> 59</span></a><span class="sd">            If you want to apply the filter to all documents (e.g., postprocess), set this to `False`.</span>
</span><span id="Filter-60"><a href="#Filter-60"><span class="linenos"> 60</span></a><span class="sd">        random_state : Optional[Union[int, np.random.Generator]]</span>
</span><span id="Filter-61"><a href="#Filter-61"><span class="linenos"> 61</span></a><span class="sd">            Seed for the random number generator.</span>
</span><span id="Filter-62"><a href="#Filter-62"><span class="linenos"> 62</span></a><span class="sd">            If `None`, a new random number generator will be created.</span>
</span><span id="Filter-63"><a href="#Filter-63"><span class="linenos"> 63</span></a><span class="sd">            If `None`, and use in the `Compose` class, the random state is shared with the `Compose` object.</span>
</span><span id="Filter-64"><a href="#Filter-64"><span class="linenos"> 64</span></a><span class="sd">        use_batch : bool</span>
</span><span id="Filter-65"><a href="#Filter-65"><span class="linenos"> 65</span></a><span class="sd">            If `True`, the filter will process documents in batches in the `apply_stream` method.</span>
</span><span id="Filter-66"><a href="#Filter-66"><span class="linenos"> 66</span></a><span class="sd">        batch_size : int</span>
</span><span id="Filter-67"><a href="#Filter-67"><span class="linenos"> 67</span></a><span class="sd">            The size of the batch to process documents in the `apply_stream` method.</span>
</span><span id="Filter-68"><a href="#Filter-68"><span class="linenos"> 68</span></a><span class="sd">        kwargs : Any</span>
</span><span id="Filter-69"><a href="#Filter-69"><span class="linenos"> 69</span></a><span class="sd">            Additional keyword arguments to pass to the filter.</span>
</span><span id="Filter-70"><a href="#Filter-70"><span class="linenos"> 70</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Filter-71"><a href="#Filter-71"><span class="linenos"> 71</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="Filter-72"><a href="#Filter-72"><span class="linenos"> 72</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__module__</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Filter-73"><a href="#Filter-73"><span class="linenos"> 73</span></a>        <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">p</span> <span class="o">&lt;=</span> <span class="mi">1</span>
</span><span id="Filter-74"><a href="#Filter-74"><span class="linenos"> 74</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
</span><span id="Filter-75"><a href="#Filter-75"><span class="linenos"> 75</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__init_rng</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span>
</span><span id="Filter-76"><a href="#Filter-76"><span class="linenos"> 76</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">skip_rejected</span> <span class="o">=</span> <span class="n">skip_rejected</span>
</span><span id="Filter-77"><a href="#Filter-77"><span class="linenos"> 77</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">use_batch</span> <span class="o">=</span> <span class="n">use_batch</span>
</span><span id="Filter-78"><a href="#Filter-78"><span class="linenos"> 78</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">batch_size</span>
</span><span id="Filter-79"><a href="#Filter-79"><span class="linenos"> 79</span></a>
</span><span id="Filter-80"><a href="#Filter-80"><span class="linenos"> 80</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_statistics</span><span class="p">:</span> <span class="n">Statistics</span> <span class="o">=</span> <span class="n">Statistics</span><span class="p">()</span>
</span><span id="Filter-81"><a href="#Filter-81"><span class="linenos"> 81</span></a>
</span><span id="Filter-82"><a href="#Filter-82"><span class="linenos"> 82</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="Filter-83"><a href="#Filter-83"><span class="linenos"> 83</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Document</span><span class="p">:</span>
</span><span id="Filter-84"><a href="#Filter-84"><span class="linenos"> 84</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Filter-85"><a href="#Filter-85"><span class="linenos"> 85</span></a><span class="sd">        Definition of filter behavior.</span>
</span><span id="Filter-86"><a href="#Filter-86"><span class="linenos"> 86</span></a>
</span><span id="Filter-87"><a href="#Filter-87"><span class="linenos"> 87</span></a><span class="sd">        The document must have a protocol `TextContent`,</span>
</span><span id="Filter-88"><a href="#Filter-88"><span class="linenos"> 88</span></a><span class="sd">        and mostly used hojichar.Document class.</span>
</span><span id="Filter-89"><a href="#Filter-89"><span class="linenos"> 89</span></a>
</span><span id="Filter-90"><a href="#Filter-90"><span class="linenos"> 90</span></a><span class="sd">        In this method, the filter will modify `document.text` or</span>
</span><span id="Filter-91"><a href="#Filter-91"><span class="linenos"> 91</span></a><span class="sd">        `document.extras` and set `document.is_rejected = True` to discard the document.</span>
</span><span id="Filter-92"><a href="#Filter-92"><span class="linenos"> 92</span></a>
</span><span id="Filter-93"><a href="#Filter-93"><span class="linenos"> 93</span></a><span class="sd">        Parameters</span>
</span><span id="Filter-94"><a href="#Filter-94"><span class="linenos"> 94</span></a><span class="sd">        ----------</span>
</span><span id="Filter-95"><a href="#Filter-95"><span class="linenos"> 95</span></a><span class="sd">        document : Document</span>
</span><span id="Filter-96"><a href="#Filter-96"><span class="linenos"> 96</span></a><span class="sd">            Input document</span>
</span><span id="Filter-97"><a href="#Filter-97"><span class="linenos"> 97</span></a>
</span><span id="Filter-98"><a href="#Filter-98"><span class="linenos"> 98</span></a><span class="sd">        Returns</span>
</span><span id="Filter-99"><a href="#Filter-99"><span class="linenos"> 99</span></a><span class="sd">        -------</span>
</span><span id="Filter-100"><a href="#Filter-100"><span class="linenos">100</span></a><span class="sd">        Document</span>
</span><span id="Filter-101"><a href="#Filter-101"><span class="linenos">101</span></a><span class="sd">            Processed Document</span>
</span><span id="Filter-102"><a href="#Filter-102"><span class="linenos">102</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Filter-103"><a href="#Filter-103"><span class="linenos">103</span></a>
</span><span id="Filter-104"><a href="#Filter-104"><span class="linenos">104</span></a>    <span class="nd">@deprecated_since</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;apply&quot;</span><span class="p">)</span>
</span><span id="Filter-105"><a href="#Filter-105"><span class="linenos">105</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Document</span><span class="p">:</span>
</span><span id="Filter-106"><a href="#Filter-106"><span class="linenos">106</span></a>        <span class="n">document</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="Filter-107"><a href="#Filter-107"><span class="linenos">107</span></a>        <span class="k">return</span> <span class="n">document</span>
</span><span id="Filter-108"><a href="#Filter-108"><span class="linenos">108</span></a>
</span><span id="Filter-109"><a href="#Filter-109"><span class="linenos">109</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_skip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Filter-110"><a href="#Filter-110"><span class="linenos">110</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Filter-111"><a href="#Filter-111"><span class="linenos">111</span></a><span class="sd">        Check if the document should be skipped by this filter.</span>
</span><span id="Filter-112"><a href="#Filter-112"><span class="linenos">112</span></a><span class="sd">        If `skip_rejected` is set to `True`, this method will return `True`</span>
</span><span id="Filter-113"><a href="#Filter-113"><span class="linenos">113</span></a><span class="sd">        if the document is already rejected.</span>
</span><span id="Filter-114"><a href="#Filter-114"><span class="linenos">114</span></a><span class="sd">        If `p` is less than 1, this method will return `True` with a probability of `1 - p`.</span>
</span><span id="Filter-115"><a href="#Filter-115"><span class="linenos">115</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Filter-116"><a href="#Filter-116"><span class="linenos">116</span></a>        <span class="n">skip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_rejected</span> <span class="ow">and</span> <span class="n">document</span><span class="o">.</span><span class="n">is_rejected</span>
</span><span id="Filter-117"><a href="#Filter-117"><span class="linenos">117</span></a>        <span class="k">if</span> <span class="n">skip</span><span class="p">:</span>
</span><span id="Filter-118"><a href="#Filter-118"><span class="linenos">118</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="Filter-119"><a href="#Filter-119"><span class="linenos">119</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Filter-120"><a href="#Filter-120"><span class="linenos">120</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">:</span>
</span><span id="Filter-121"><a href="#Filter-121"><span class="linenos">121</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="Filter-122"><a href="#Filter-122"><span class="linenos">122</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="Filter-123"><a href="#Filter-123"><span class="linenos">123</span></a>
</span><span id="Filter-124"><a href="#Filter-124"><span class="linenos">124</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Document</span><span class="p">:</span>
</span><span id="Filter-125"><a href="#Filter-125"><span class="linenos">125</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Filter-126"><a href="#Filter-126"><span class="linenos">126</span></a><span class="sd">        Apply the filter to a single document.</span>
</span><span id="Filter-127"><a href="#Filter-127"><span class="linenos">127</span></a><span class="sd">        This method</span>
</span><span id="Filter-128"><a href="#Filter-128"><span class="linenos">128</span></a><span class="sd">          - checks if the document should be skipped</span>
</span><span id="Filter-129"><a href="#Filter-129"><span class="linenos">129</span></a><span class="sd">          - counts and logging the statistics</span>
</span><span id="Filter-130"><a href="#Filter-130"><span class="linenos">130</span></a><span class="sd">          - logging the reason for rejection if the document is rejected</span>
</span><span id="Filter-131"><a href="#Filter-131"><span class="linenos">131</span></a>
</span><span id="Filter-132"><a href="#Filter-132"><span class="linenos">132</span></a><span class="sd">        This method may be used in `apply` method of `Compose` class.</span>
</span><span id="Filter-133"><a href="#Filter-133"><span class="linenos">133</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Filter-134"><a href="#Filter-134"><span class="linenos">134</span></a>
</span><span id="Filter-135"><a href="#Filter-135"><span class="linenos">135</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="n">get_doc_info</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="Filter-136"><a href="#Filter-136"><span class="linenos">136</span></a>
</span><span id="Filter-137"><a href="#Filter-137"><span class="linenos">137</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_skip</span><span class="p">(</span><span class="n">document</span><span class="p">):</span>
</span><span id="Filter-138"><a href="#Filter-138"><span class="linenos">138</span></a>            <span class="n">document</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="Filter-139"><a href="#Filter-139"><span class="linenos">139</span></a>
</span><span id="Filter-140"><a href="#Filter-140"><span class="linenos">140</span></a>        <span class="n">new_stats</span> <span class="o">=</span> <span class="n">get_doc_info</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="Filter-141"><a href="#Filter-141"><span class="linenos">141</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_statistics</span><span class="o">.</span><span class="n">update_by_diff</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="n">new_stats</span><span class="p">)</span>
</span><span id="Filter-142"><a href="#Filter-142"><span class="linenos">142</span></a>
</span><span id="Filter-143"><a href="#Filter-143"><span class="linenos">143</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;is_rejected&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">new_stats</span><span class="p">[</span><span class="s2">&quot;is_rejected&quot;</span><span class="p">]:</span>
</span><span id="Filter-144"><a href="#Filter-144"><span class="linenos">144</span></a>            <span class="n">document</span><span class="o">.</span><span class="n">reject_reason</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_jsonable_vars</span><span class="p">()</span>
</span><span id="Filter-145"><a href="#Filter-145"><span class="linenos">145</span></a>
</span><span id="Filter-146"><a href="#Filter-146"><span class="linenos">146</span></a>        <span class="k">return</span> <span class="n">document</span>
</span><span id="Filter-147"><a href="#Filter-147"><span class="linenos">147</span></a>
</span><span id="Filter-148"><a href="#Filter-148"><span class="linenos">148</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Document</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Document</span><span class="p">]:</span>
</span><span id="Filter-149"><a href="#Filter-149"><span class="linenos">149</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Filter-150"><a href="#Filter-150"><span class="linenos">150</span></a><span class="sd">        Apply the filter to a batch of documents.</span>
</span><span id="Filter-151"><a href="#Filter-151"><span class="linenos">151</span></a><span class="sd">        You can override this method if you want to</span>
</span><span id="Filter-152"><a href="#Filter-152"><span class="linenos">152</span></a><span class="sd">        apply the filter to a batch of documents at once.</span>
</span><span id="Filter-153"><a href="#Filter-153"><span class="linenos">153</span></a>
</span><span id="Filter-154"><a href="#Filter-154"><span class="linenos">154</span></a><span class="sd">        This method may be used in `apply_batch` method of `Compose` class.</span>
</span><span id="Filter-155"><a href="#Filter-155"><span class="linenos">155</span></a>
</span><span id="Filter-156"><a href="#Filter-156"><span class="linenos">156</span></a><span class="sd">        Parameters</span>
</span><span id="Filter-157"><a href="#Filter-157"><span class="linenos">157</span></a><span class="sd">        ----------</span>
</span><span id="Filter-158"><a href="#Filter-158"><span class="linenos">158</span></a><span class="sd">        documents : Sequence[Document]</span>
</span><span id="Filter-159"><a href="#Filter-159"><span class="linenos">159</span></a><span class="sd">            List-like object of input documents</span>
</span><span id="Filter-160"><a href="#Filter-160"><span class="linenos">160</span></a>
</span><span id="Filter-161"><a href="#Filter-161"><span class="linenos">161</span></a><span class="sd">        Returns</span>
</span><span id="Filter-162"><a href="#Filter-162"><span class="linenos">162</span></a><span class="sd">        -------</span>
</span><span id="Filter-163"><a href="#Filter-163"><span class="linenos">163</span></a><span class="sd">        list[Document]</span>
</span><span id="Filter-164"><a href="#Filter-164"><span class="linenos">164</span></a><span class="sd">            List of processed documents</span>
</span><span id="Filter-165"><a href="#Filter-165"><span class="linenos">165</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Filter-166"><a href="#Filter-166"><span class="linenos">166</span></a>        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">document</span><span class="p">)</span> <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">]</span>
</span><span id="Filter-167"><a href="#Filter-167"><span class="linenos">167</span></a>
</span><span id="Filter-168"><a href="#Filter-168"><span class="linenos">168</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Document</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Document</span><span class="p">]:</span>
</span><span id="Filter-169"><a href="#Filter-169"><span class="linenos">169</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Filter-170"><a href="#Filter-170"><span class="linenos">170</span></a><span class="sd">        Apply the filter to a batch of documents.</span>
</span><span id="Filter-171"><a href="#Filter-171"><span class="linenos">171</span></a><span class="sd">        This method</span>
</span><span id="Filter-172"><a href="#Filter-172"><span class="linenos">172</span></a><span class="sd">        - checks if the documents should be skipped</span>
</span><span id="Filter-173"><a href="#Filter-173"><span class="linenos">173</span></a><span class="sd">        - counts and logs the statistics</span>
</span><span id="Filter-174"><a href="#Filter-174"><span class="linenos">174</span></a><span class="sd">        - logs the reason for rejection if any document is rejected</span>
</span><span id="Filter-175"><a href="#Filter-175"><span class="linenos">175</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Filter-176"><a href="#Filter-176"><span class="linenos">176</span></a>        <span class="n">skip</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Filter-177"><a href="#Filter-177"><span class="linenos">177</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Filter-178"><a href="#Filter-178"><span class="linenos">178</span></a>            <span class="n">skip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>
</span><span id="Filter-179"><a href="#Filter-179"><span class="linenos">179</span></a>
</span><span id="Filter-180"><a href="#Filter-180"><span class="linenos">180</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_doc_info</span><span class="p">(</span><span class="n">document</span><span class="o">=</span><span class="n">doc</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">]</span>
</span><span id="Filter-181"><a href="#Filter-181"><span class="linenos">181</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">skip</span><span class="p">:</span>
</span><span id="Filter-182"><a href="#Filter-182"><span class="linenos">182</span></a>            <span class="n">batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_batch</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
</span><span id="Filter-183"><a href="#Filter-183"><span class="linenos">183</span></a>        <span class="n">batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finalize_batch</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">stats</span><span class="p">)</span>
</span><span id="Filter-184"><a href="#Filter-184"><span class="linenos">184</span></a>        <span class="k">return</span> <span class="n">batch</span>
</span><span id="Filter-185"><a href="#Filter-185"><span class="linenos">185</span></a>
</span><span id="Filter-186"><a href="#Filter-186"><span class="linenos">186</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Document</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Document</span><span class="p">]:</span>
</span><span id="Filter-187"><a href="#Filter-187"><span class="linenos">187</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Filter-188"><a href="#Filter-188"><span class="linenos">188</span></a><span class="sd">        Apply the filter to a stream of documents.</span>
</span><span id="Filter-189"><a href="#Filter-189"><span class="linenos">189</span></a><span class="sd">        This method is used when you want to process documents one by one.</span>
</span><span id="Filter-190"><a href="#Filter-190"><span class="linenos">190</span></a><span class="sd">        If `use_batch` is set to `True` in the constructor,</span>
</span><span id="Filter-191"><a href="#Filter-191"><span class="linenos">191</span></a><span class="sd">        this method will process documents in batches using the `apply_batch` method.</span>
</span><span id="Filter-192"><a href="#Filter-192"><span class="linenos">192</span></a>
</span><span id="Filter-193"><a href="#Filter-193"><span class="linenos">193</span></a><span class="sd">        Even if an exception occurs during processing, the process will continue, and the following actions will be taken:</span>
</span><span id="Filter-194"><a href="#Filter-194"><span class="linenos">194</span></a><span class="sd">        - Set the `is_rejected` flag of the document to `True`</span>
</span><span id="Filter-195"><a href="#Filter-195"><span class="linenos">195</span></a><span class="sd">        - Set the error details in `reject_reason`</span>
</span><span id="Filter-196"><a href="#Filter-196"><span class="linenos">196</span></a><span class="sd">        - Increment the `errors` count in the statistics retrievable via `get_statistics`</span>
</span><span id="Filter-197"><a href="#Filter-197"><span class="linenos">197</span></a>
</span><span id="Filter-198"><a href="#Filter-198"><span class="linenos">198</span></a><span class="sd">        Parameters</span>
</span><span id="Filter-199"><a href="#Filter-199"><span class="linenos">199</span></a><span class="sd">        ----------</span>
</span><span id="Filter-200"><a href="#Filter-200"><span class="linenos">200</span></a><span class="sd">        stream : Iterable[Document]</span>
</span><span id="Filter-201"><a href="#Filter-201"><span class="linenos">201</span></a><span class="sd">            Stream of input documents</span>
</span><span id="Filter-202"><a href="#Filter-202"><span class="linenos">202</span></a>
</span><span id="Filter-203"><a href="#Filter-203"><span class="linenos">203</span></a><span class="sd">        Returns</span>
</span><span id="Filter-204"><a href="#Filter-204"><span class="linenos">204</span></a><span class="sd">        -------</span>
</span><span id="Filter-205"><a href="#Filter-205"><span class="linenos">205</span></a><span class="sd">        Iterable[Document]</span>
</span><span id="Filter-206"><a href="#Filter-206"><span class="linenos">206</span></a><span class="sd">            Stream of processed documents</span>
</span><span id="Filter-207"><a href="#Filter-207"><span class="linenos">207</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Filter-208"><a href="#Filter-208"><span class="linenos">208</span></a>
</span><span id="Filter-209"><a href="#Filter-209"><span class="linenos">209</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_batch</span><span class="p">:</span>
</span><span id="Filter-210"><a href="#Filter-210"><span class="linenos">210</span></a>            <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">stream</span><span class="p">:</span>
</span><span id="Filter-211"><a href="#Filter-211"><span class="linenos">211</span></a>                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_try_process</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply</span><span class="p">)</span>
</span><span id="Filter-212"><a href="#Filter-212"><span class="linenos">212</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Filter-213"><a href="#Filter-213"><span class="linenos">213</span></a>            <span class="n">batch</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Document</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Filter-214"><a href="#Filter-214"><span class="linenos">214</span></a>            <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">stream</span><span class="p">:</span>
</span><span id="Filter-215"><a href="#Filter-215"><span class="linenos">215</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_skip</span><span class="p">(</span><span class="n">document</span><span class="p">):</span>
</span><span id="Filter-216"><a href="#Filter-216"><span class="linenos">216</span></a>                    <span class="k">yield</span> <span class="n">document</span>
</span><span id="Filter-217"><a href="#Filter-217"><span class="linenos">217</span></a>                    <span class="k">continue</span>
</span><span id="Filter-218"><a href="#Filter-218"><span class="linenos">218</span></a>
</span><span id="Filter-219"><a href="#Filter-219"><span class="linenos">219</span></a>                <span class="n">batch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="Filter-220"><a href="#Filter-220"><span class="linenos">220</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">:</span>
</span><span id="Filter-221"><a href="#Filter-221"><span class="linenos">221</span></a>                    <span class="n">stats</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_doc_info</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">]</span>
</span><span id="Filter-222"><a href="#Filter-222"><span class="linenos">222</span></a>                    <span class="n">batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_try_process</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_batch</span><span class="p">)</span>
</span><span id="Filter-223"><a href="#Filter-223"><span class="linenos">223</span></a>                    <span class="n">batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finalize_batch</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">stats</span><span class="p">)</span>
</span><span id="Filter-224"><a href="#Filter-224"><span class="linenos">224</span></a>                    <span class="k">yield from</span> <span class="n">batch</span>
</span><span id="Filter-225"><a href="#Filter-225"><span class="linenos">225</span></a>                    <span class="n">batch</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="Filter-226"><a href="#Filter-226"><span class="linenos">226</span></a>            <span class="k">if</span> <span class="n">batch</span><span class="p">:</span>
</span><span id="Filter-227"><a href="#Filter-227"><span class="linenos">227</span></a>                <span class="n">stats</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_doc_info</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">]</span>
</span><span id="Filter-228"><a href="#Filter-228"><span class="linenos">228</span></a>                <span class="n">batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_try_process</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_batch</span><span class="p">)</span>
</span><span id="Filter-229"><a href="#Filter-229"><span class="linenos">229</span></a>                <span class="n">batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finalize_batch</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">stats</span><span class="p">)</span>
</span><span id="Filter-230"><a href="#Filter-230"><span class="linenos">230</span></a>                <span class="k">yield from</span> <span class="n">batch</span>
</span><span id="Filter-231"><a href="#Filter-231"><span class="linenos">231</span></a>
</span><span id="Filter-232"><a href="#Filter-232"><span class="linenos">232</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_try_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">T</span><span class="p">],</span> <span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
</span><span id="Filter-233"><a href="#Filter-233"><span class="linenos">233</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Filter-234"><a href="#Filter-234"><span class="linenos">234</span></a>            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</span><span id="Filter-235"><a href="#Filter-235"><span class="linenos">235</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Filter-236"><a href="#Filter-236"><span class="linenos">236</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">Document</span><span class="p">):</span>
</span><span id="Filter-237"><a href="#Filter-237"><span class="linenos">237</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="si">!r}</span><span class="s2"> occurs while processing </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="n">target</span><span class="si">!r}</span><span class="s2">&quot;</span>
</span><span id="Filter-238"><a href="#Filter-238"><span class="linenos">238</span></a>                <span class="n">target</span><span class="o">.</span><span class="n">is_rejected</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Filter-239"><a href="#Filter-239"><span class="linenos">239</span></a>                <span class="n">target</span><span class="o">.</span><span class="n">reject_reason</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="p">}</span>
</span><span id="Filter-240"><a href="#Filter-240"><span class="linenos">240</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_statistics</span><span class="o">.</span><span class="n">errors</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Filter-241"><a href="#Filter-241"><span class="linenos">241</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Filter-242"><a href="#Filter-242"><span class="linenos">242</span></a>                <span class="k">return</span> <span class="n">target</span>  <span class="c1"># type: ignore[return-value]</span>
</span><span id="Filter-243"><a href="#Filter-243"><span class="linenos">243</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="Filter-244"><a href="#Filter-244"><span class="linenos">244</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="si">!r}</span><span class="s2"> occurs while batch processing </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Filter-245"><a href="#Filter-245"><span class="linenos">245</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Filter-246"><a href="#Filter-246"><span class="linenos">246</span></a>                <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">target</span><span class="p">:</span>
</span><span id="Filter-247"><a href="#Filter-247"><span class="linenos">247</span></a>                    <span class="n">doc</span><span class="o">.</span><span class="n">is_rejected</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Filter-248"><a href="#Filter-248"><span class="linenos">248</span></a>                    <span class="n">doc</span><span class="o">.</span><span class="n">reject_reason</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="p">}</span>
</span><span id="Filter-249"><a href="#Filter-249"><span class="linenos">249</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_statistics</span><span class="o">.</span><span class="n">errors</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</span><span id="Filter-250"><a href="#Filter-250"><span class="linenos">250</span></a>                <span class="k">return</span> <span class="n">target</span>  <span class="c1"># type: ignore[return-value]</span>
</span><span id="Filter-251"><a href="#Filter-251"><span class="linenos">251</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Filter-252"><a href="#Filter-252"><span class="linenos">252</span></a>                <span class="k">raise</span> <span class="n">e</span>
</span><span id="Filter-253"><a href="#Filter-253"><span class="linenos">253</span></a>
</span><span id="Filter-254"><a href="#Filter-254"><span class="linenos">254</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Filter-255"><a href="#Filter-255"><span class="linenos">255</span></a>        <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Filter-256"><a href="#Filter-256"><span class="linenos">256</span></a>        <span class="n">document</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="Filter-257"><a href="#Filter-257"><span class="linenos">257</span></a>        <span class="k">return</span> <span class="n">document</span><span class="o">.</span><span class="n">text</span>
</span><span id="Filter-258"><a href="#Filter-258"><span class="linenos">258</span></a>
</span><span id="Filter-259"><a href="#Filter-259"><span class="linenos">259</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Statistics</span><span class="p">:</span>
</span><span id="Filter-260"><a href="#Filter-260"><span class="linenos">260</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Filter-261"><a href="#Filter-261"><span class="linenos">261</span></a><span class="sd">        Get the statistics of this filter.</span>
</span><span id="Filter-262"><a href="#Filter-262"><span class="linenos">262</span></a><span class="sd">        This method returns the statistics of the filter,</span>
</span><span id="Filter-263"><a href="#Filter-263"><span class="linenos">263</span></a><span class="sd">        which includes the number of processed documents, discarded documents, and other statistics.</span>
</span><span id="Filter-264"><a href="#Filter-264"><span class="linenos">264</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Filter-265"><a href="#Filter-265"><span class="linenos">265</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_statistics</span>
</span><span id="Filter-266"><a href="#Filter-266"><span class="linenos">266</span></a>
</span><span id="Filter-267"><a href="#Filter-267"><span class="linenos">267</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_statistics_map</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="Filter-268"><a href="#Filter-268"><span class="linenos">268</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Filter-269"><a href="#Filter-269"><span class="linenos">269</span></a><span class="sd">        Get the statistics of this filter as a dictionary.</span>
</span><span id="Filter-270"><a href="#Filter-270"><span class="linenos">270</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Filter-271"><a href="#Filter-271"><span class="linenos">271</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_statistics</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="Filter-272"><a href="#Filter-272"><span class="linenos">272</span></a>
</span><span id="Filter-273"><a href="#Filter-273"><span class="linenos">273</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Filter-274"><a href="#Filter-274"><span class="linenos">274</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Filter-275"><a href="#Filter-275"><span class="linenos">275</span></a><span class="sd">        This method is called when the filter is no longer needed.</span>
</span><span id="Filter-276"><a href="#Filter-276"><span class="linenos">276</span></a><span class="sd">        You can override this method to release resources or perform cleanup tasks.</span>
</span><span id="Filter-277"><a href="#Filter-277"><span class="linenos">277</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Filter-278"><a href="#Filter-278"><span class="linenos">278</span></a>        <span class="k">pass</span>
</span><span id="Filter-279"><a href="#Filter-279"><span class="linenos">279</span></a>
</span><span id="Filter-280"><a href="#Filter-280"><span class="linenos">280</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Filter&quot;</span><span class="p">:</span>
</span><span id="Filter-281"><a href="#Filter-281"><span class="linenos">281</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="Filter-282"><a href="#Filter-282"><span class="linenos">282</span></a>
</span><span id="Filter-283"><a href="#Filter-283"><span class="linenos">283</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">traceback</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Filter-284"><a href="#Filter-284"><span class="linenos">284</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Filter-285"><a href="#Filter-285"><span class="linenos">285</span></a><span class="sd">        This method is called when the filter is used in a context manager.</span>
</span><span id="Filter-286"><a href="#Filter-286"><span class="linenos">286</span></a><span class="sd">        It calls the `shutdown` method to release resources or perform cleanup tasks.</span>
</span><span id="Filter-287"><a href="#Filter-287"><span class="linenos">287</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Filter-288"><a href="#Filter-288"><span class="linenos">288</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</span><span id="Filter-289"><a href="#Filter-289"><span class="linenos">289</span></a>
</span><span id="Filter-290"><a href="#Filter-290"><span class="linenos">290</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_jsonable_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exclude_keys</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="Filter-291"><a href="#Filter-291"><span class="linenos">291</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Filter-292"><a href="#Filter-292"><span class="linenos">292</span></a><span class="sd">        Get the member variable of this filter.</span>
</span><span id="Filter-293"><a href="#Filter-293"><span class="linenos">293</span></a><span class="sd">        Eligible variables are primitive types; [bool, int, float, str, None],</span>
</span><span id="Filter-294"><a href="#Filter-294"><span class="linenos">294</span></a><span class="sd">        and the name of the variable not starts with the underscore; `_`.</span>
</span><span id="Filter-295"><a href="#Filter-295"><span class="linenos">295</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Filter-296"><a href="#Filter-296"><span class="linenos">296</span></a>        <span class="k">if</span> <span class="n">exclude_keys</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Filter-297"><a href="#Filter-297"><span class="linenos">297</span></a>            <span class="n">exclude_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="Filter-298"><a href="#Filter-298"><span class="linenos">298</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="Filter-299"><a href="#Filter-299"><span class="linenos">299</span></a>            <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
</span><span id="Filter-300"><a href="#Filter-300"><span class="linenos">300</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Filter-301"><a href="#Filter-301"><span class="linenos">301</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">_is_jsonable</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude_keys</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)))</span>
</span><span id="Filter-302"><a href="#Filter-302"><span class="linenos">302</span></a>        <span class="p">}</span>
</span><span id="Filter-303"><a href="#Filter-303"><span class="linenos">303</span></a>
</span><span id="Filter-304"><a href="#Filter-304"><span class="linenos">304</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_finalize_batch</span><span class="p">(</span>
</span><span id="Filter-305"><a href="#Filter-305"><span class="linenos">305</span></a>        <span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;Filter&quot;</span><span class="p">,</span>
</span><span id="Filter-306"><a href="#Filter-306"><span class="linenos">306</span></a>        <span class="n">batch</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Document</span><span class="p">],</span>
</span><span id="Filter-307"><a href="#Filter-307"><span class="linenos">307</span></a>        <span class="n">old_stats</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="Filter-308"><a href="#Filter-308"><span class="linenos">308</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Document</span><span class="p">]:</span>
</span><span id="Filter-309"><a href="#Filter-309"><span class="linenos">309</span></a>        <span class="n">new_stats</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_doc_info</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">]</span>
</span><span id="Filter-310"><a href="#Filter-310"><span class="linenos">310</span></a>        <span class="k">for</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">old_stats</span><span class="p">,</span> <span class="n">new_stats</span><span class="p">,</span> <span class="n">batch</span><span class="p">):</span>
</span><span id="Filter-311"><a href="#Filter-311"><span class="linenos">311</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_statistics</span><span class="o">.</span><span class="n">update_by_diff</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
</span><span id="Filter-312"><a href="#Filter-312"><span class="linenos">312</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">old</span><span class="p">[</span><span class="s2">&quot;is_rejected&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">new</span><span class="p">[</span><span class="s2">&quot;is_rejected&quot;</span><span class="p">]:</span>
</span><span id="Filter-313"><a href="#Filter-313"><span class="linenos">313</span></a>                <span class="n">doc</span><span class="o">.</span><span class="n">reject_reason</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_jsonable_vars</span><span class="p">()</span>
</span><span id="Filter-314"><a href="#Filter-314"><span class="linenos">314</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
</span><span id="Filter-315"><a href="#Filter-315"><span class="linenos">315</span></a>
</span><span id="Filter-316"><a href="#Filter-316"><span class="linenos">316</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">__init_rng</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">random_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">Generator</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Filter-317"><a href="#Filter-317"><span class="linenos">317</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_owns_rng</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Filter-318"><a href="#Filter-318"><span class="linenos">318</span></a>        <span class="k">if</span> <span class="n">random_state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Filter-319"><a href="#Filter-319"><span class="linenos">319</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">()</span>
</span><span id="Filter-320"><a href="#Filter-320"><span class="linenos">320</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_owns_rng</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Filter-321"><a href="#Filter-321"><span class="linenos">321</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">random_state</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Filter-322"><a href="#Filter-322"><span class="linenos">322</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span>
</span><span id="Filter-323"><a href="#Filter-323"><span class="linenos">323</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">random_state</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">Generator</span><span class="p">):</span>
</span><span id="Filter-324"><a href="#Filter-324"><span class="linenos">324</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span> <span class="o">=</span> <span class="n">random_state</span>
</span><span id="Filter-325"><a href="#Filter-325"><span class="linenos">325</span></a>
</span><span id="Filter-326"><a href="#Filter-326"><span class="linenos">326</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_set_rng_if_not_initialized</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rng</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">Generator</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Filter-327"><a href="#Filter-327"><span class="linenos">327</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Filter-328"><a href="#Filter-328"><span class="linenos">328</span></a><span class="sd">        Set the random number generator for this filter if it is not already initialized.</span>
</span><span id="Filter-329"><a href="#Filter-329"><span class="linenos">329</span></a><span class="sd">        This method is called by Compose class.</span>
</span><span id="Filter-330"><a href="#Filter-330"><span class="linenos">330</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Filter-331"><a href="#Filter-331"><span class="linenos">331</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owns_rng</span><span class="p">:</span>
</span><span id="Filter-332"><a href="#Filter-332"><span class="linenos">332</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span> <span class="o">=</span> <span class="n">rng</span>
</span></pre></div>


            <div class="docstring"><p>Base class for all filters.
Document-level filters must inherit from this class.</p>

<p>The definition of text processing is in <code><a href="#Filter.apply">apply</a></code> method.
If you define a new filter, override the method.</p>

<p>When this class is called, apply the filter from string to string.</p>

<p>With context manager, you can use the filter as follows:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="k">with</span> <span class="n">YourFilter</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span> <span class="k">as</span> <span class="n">filt</span><span class="p">:</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">filt</span><span class="p">(</span><span class="s2">&quot;This is a sample text.&quot;</span><span class="p">)</span>
</code></pre>
</div>
</div>


                            <div id="Filter.__init__" class="classattr">
                                        <input id="Filter.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Filter</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">p</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>,</span><span class="param">	<span class="n">skip_rejected</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">random_state</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">_generator</span><span class="o">.</span><span class="n">Generator</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">use_batch</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span></span>)</span>

                <label class="view-source-button" for="Filter.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Filter.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Filter.__init__-40"><a href="#Filter.__init__-40"><span class="linenos">40</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="Filter.__init__-41"><a href="#Filter.__init__-41"><span class="linenos">41</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Filter.__init__-42"><a href="#Filter.__init__-42"><span class="linenos">42</span></a>        <span class="n">p</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="Filter.__init__-43"><a href="#Filter.__init__-43"><span class="linenos">43</span></a>        <span class="n">skip_rejected</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Filter.__init__-44"><a href="#Filter.__init__-44"><span class="linenos">44</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="Filter.__init__-45"><a href="#Filter.__init__-45"><span class="linenos">45</span></a>        <span class="n">random_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">Generator</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Filter.__init__-46"><a href="#Filter.__init__-46"><span class="linenos">46</span></a>        <span class="n">use_batch</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Filter.__init__-47"><a href="#Filter.__init__-47"><span class="linenos">47</span></a>        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
</span><span id="Filter.__init__-48"><a href="#Filter.__init__-48"><span class="linenos">48</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="Filter.__init__-49"><a href="#Filter.__init__-49"><span class="linenos">49</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Filter.__init__-50"><a href="#Filter.__init__-50"><span class="linenos">50</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Filter.__init__-51"><a href="#Filter.__init__-51"><span class="linenos">51</span></a><span class="sd">        Initialize the filter.</span>
</span><span id="Filter.__init__-52"><a href="#Filter.__init__-52"><span class="linenos">52</span></a><span class="sd">        Parameters</span>
</span><span id="Filter.__init__-53"><a href="#Filter.__init__-53"><span class="linenos">53</span></a><span class="sd">        ----------</span>
</span><span id="Filter.__init__-54"><a href="#Filter.__init__-54"><span class="linenos">54</span></a><span class="sd">        p : float</span>
</span><span id="Filter.__init__-55"><a href="#Filter.__init__-55"><span class="linenos">55</span></a><span class="sd">            The probability of applying the filter.</span>
</span><span id="Filter.__init__-56"><a href="#Filter.__init__-56"><span class="linenos">56</span></a><span class="sd">            If `p` is 1, the filter will always be applied.</span>
</span><span id="Filter.__init__-57"><a href="#Filter.__init__-57"><span class="linenos">57</span></a><span class="sd">        skip_rejected : bool</span>
</span><span id="Filter.__init__-58"><a href="#Filter.__init__-58"><span class="linenos">58</span></a><span class="sd">            If `True`, the filter will skip documents that are already rejected.</span>
</span><span id="Filter.__init__-59"><a href="#Filter.__init__-59"><span class="linenos">59</span></a><span class="sd">            If you want to apply the filter to all documents (e.g., postprocess), set this to `False`.</span>
</span><span id="Filter.__init__-60"><a href="#Filter.__init__-60"><span class="linenos">60</span></a><span class="sd">        random_state : Optional[Union[int, np.random.Generator]]</span>
</span><span id="Filter.__init__-61"><a href="#Filter.__init__-61"><span class="linenos">61</span></a><span class="sd">            Seed for the random number generator.</span>
</span><span id="Filter.__init__-62"><a href="#Filter.__init__-62"><span class="linenos">62</span></a><span class="sd">            If `None`, a new random number generator will be created.</span>
</span><span id="Filter.__init__-63"><a href="#Filter.__init__-63"><span class="linenos">63</span></a><span class="sd">            If `None`, and use in the `Compose` class, the random state is shared with the `Compose` object.</span>
</span><span id="Filter.__init__-64"><a href="#Filter.__init__-64"><span class="linenos">64</span></a><span class="sd">        use_batch : bool</span>
</span><span id="Filter.__init__-65"><a href="#Filter.__init__-65"><span class="linenos">65</span></a><span class="sd">            If `True`, the filter will process documents in batches in the `apply_stream` method.</span>
</span><span id="Filter.__init__-66"><a href="#Filter.__init__-66"><span class="linenos">66</span></a><span class="sd">        batch_size : int</span>
</span><span id="Filter.__init__-67"><a href="#Filter.__init__-67"><span class="linenos">67</span></a><span class="sd">            The size of the batch to process documents in the `apply_stream` method.</span>
</span><span id="Filter.__init__-68"><a href="#Filter.__init__-68"><span class="linenos">68</span></a><span class="sd">        kwargs : Any</span>
</span><span id="Filter.__init__-69"><a href="#Filter.__init__-69"><span class="linenos">69</span></a><span class="sd">            Additional keyword arguments to pass to the filter.</span>
</span><span id="Filter.__init__-70"><a href="#Filter.__init__-70"><span class="linenos">70</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Filter.__init__-71"><a href="#Filter.__init__-71"><span class="linenos">71</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="Filter.__init__-72"><a href="#Filter.__init__-72"><span class="linenos">72</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__module__</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Filter.__init__-73"><a href="#Filter.__init__-73"><span class="linenos">73</span></a>        <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">p</span> <span class="o">&lt;=</span> <span class="mi">1</span>
</span><span id="Filter.__init__-74"><a href="#Filter.__init__-74"><span class="linenos">74</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
</span><span id="Filter.__init__-75"><a href="#Filter.__init__-75"><span class="linenos">75</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__init_rng</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span>
</span><span id="Filter.__init__-76"><a href="#Filter.__init__-76"><span class="linenos">76</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">skip_rejected</span> <span class="o">=</span> <span class="n">skip_rejected</span>
</span><span id="Filter.__init__-77"><a href="#Filter.__init__-77"><span class="linenos">77</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">use_batch</span> <span class="o">=</span> <span class="n">use_batch</span>
</span><span id="Filter.__init__-78"><a href="#Filter.__init__-78"><span class="linenos">78</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">batch_size</span>
</span><span id="Filter.__init__-79"><a href="#Filter.__init__-79"><span class="linenos">79</span></a>
</span><span id="Filter.__init__-80"><a href="#Filter.__init__-80"><span class="linenos">80</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_statistics</span><span class="p">:</span> <span class="n">Statistics</span> <span class="o">=</span> <span class="n">Statistics</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the filter.</p>

<h2 id="parameters">Parameters</h2>

<p>p : float
    The probability of applying the filter.
    If <code>p</code> is 1, the filter will always be applied.
skip_rejected : bool
    If <code>True</code>, the filter will skip documents that are already rejected.
    If you want to apply the filter to all documents (e.g., postprocess), set this to <code>False</code>.
random_state : Optional[Union[int, np.random.Generator]]
    Seed for the random number generator.
    If <code>None</code>, a new random number generator will be created.
    If <code>None</code>, and use in the <code><a href="#Compose">Compose</a></code> class, the random state is shared with the <code><a href="#Compose">Compose</a></code> object.
use_batch : bool
    If <code>True</code>, the filter will process documents in batches in the <code><a href="#Filter.apply_stream">apply_stream</a></code> method.
batch_size : int
    The size of the batch to process documents in the <code><a href="#Filter.apply_stream">apply_stream</a></code> method.
kwargs : Any
    Additional keyword arguments to pass to the filter.</p>
</div>


                            </div>
                            <div id="Filter.apply" class="classattr">
                                        <input id="Filter.apply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">apply</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">document</span><span class="p">:</span> <span class="n"><a href="#Document">hojichar.Document</a></span></span><span class="return-annotation">) -> <span class="n"><a href="#Document">hojichar.Document</a></span>:</span></span>

                <label class="view-source-button" for="Filter.apply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Filter.apply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Filter.apply-82"><a href="#Filter.apply-82"><span class="linenos"> 82</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="Filter.apply-83"><a href="#Filter.apply-83"><span class="linenos"> 83</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Document</span><span class="p">:</span>
</span><span id="Filter.apply-84"><a href="#Filter.apply-84"><span class="linenos"> 84</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Filter.apply-85"><a href="#Filter.apply-85"><span class="linenos"> 85</span></a><span class="sd">        Definition of filter behavior.</span>
</span><span id="Filter.apply-86"><a href="#Filter.apply-86"><span class="linenos"> 86</span></a>
</span><span id="Filter.apply-87"><a href="#Filter.apply-87"><span class="linenos"> 87</span></a><span class="sd">        The document must have a protocol `TextContent`,</span>
</span><span id="Filter.apply-88"><a href="#Filter.apply-88"><span class="linenos"> 88</span></a><span class="sd">        and mostly used hojichar.Document class.</span>
</span><span id="Filter.apply-89"><a href="#Filter.apply-89"><span class="linenos"> 89</span></a>
</span><span id="Filter.apply-90"><a href="#Filter.apply-90"><span class="linenos"> 90</span></a><span class="sd">        In this method, the filter will modify `document.text` or</span>
</span><span id="Filter.apply-91"><a href="#Filter.apply-91"><span class="linenos"> 91</span></a><span class="sd">        `document.extras` and set `document.is_rejected = True` to discard the document.</span>
</span><span id="Filter.apply-92"><a href="#Filter.apply-92"><span class="linenos"> 92</span></a>
</span><span id="Filter.apply-93"><a href="#Filter.apply-93"><span class="linenos"> 93</span></a><span class="sd">        Parameters</span>
</span><span id="Filter.apply-94"><a href="#Filter.apply-94"><span class="linenos"> 94</span></a><span class="sd">        ----------</span>
</span><span id="Filter.apply-95"><a href="#Filter.apply-95"><span class="linenos"> 95</span></a><span class="sd">        document : Document</span>
</span><span id="Filter.apply-96"><a href="#Filter.apply-96"><span class="linenos"> 96</span></a><span class="sd">            Input document</span>
</span><span id="Filter.apply-97"><a href="#Filter.apply-97"><span class="linenos"> 97</span></a>
</span><span id="Filter.apply-98"><a href="#Filter.apply-98"><span class="linenos"> 98</span></a><span class="sd">        Returns</span>
</span><span id="Filter.apply-99"><a href="#Filter.apply-99"><span class="linenos"> 99</span></a><span class="sd">        -------</span>
</span><span id="Filter.apply-100"><a href="#Filter.apply-100"><span class="linenos">100</span></a><span class="sd">        Document</span>
</span><span id="Filter.apply-101"><a href="#Filter.apply-101"><span class="linenos">101</span></a><span class="sd">            Processed Document</span>
</span><span id="Filter.apply-102"><a href="#Filter.apply-102"><span class="linenos">102</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Definition of filter behavior.</p>

<p>The document must have a protocol <code>TextContent</code>,
and mostly used <a href="#Document">hojichar.Document</a> class.</p>

<p>In this method, the filter will modify <code>document.text</code> or
<code>document.extras</code> and set <code>document.is_rejected = True</code> to discard the document.</p>

<h2 id="parameters">Parameters</h2>

<p>document : Document
    Input document</p>

<h2 id="returns">Returns</h2>

<p>Document
    Processed Document</p>
</div>


                            </div>
                            <div id="Filter.apply_filter" class="classattr">
                                        <input id="Filter.apply_filter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@deprecated_since(version=&#39;1.0.0&#39;, alternative=&#39;apply&#39;)</div>

        <span class="def">def</span>
        <span class="name">apply_filter</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">document</span><span class="p">:</span> <span class="n"><a href="#Document">hojichar.Document</a></span></span><span class="return-annotation">) -> <span class="n"><a href="#Document">hojichar.Document</a></span>:</span></span>

                <label class="view-source-button" for="Filter.apply_filter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Filter.apply_filter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Filter.apply_filter-104"><a href="#Filter.apply_filter-104"><span class="linenos">104</span></a>    <span class="nd">@deprecated_since</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;apply&quot;</span><span class="p">)</span>
</span><span id="Filter.apply_filter-105"><a href="#Filter.apply_filter-105"><span class="linenos">105</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Document</span><span class="p">:</span>
</span><span id="Filter.apply_filter-106"><a href="#Filter.apply_filter-106"><span class="linenos">106</span></a>        <span class="n">document</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="Filter.apply_filter-107"><a href="#Filter.apply_filter-107"><span class="linenos">107</span></a>        <span class="k">return</span> <span class="n">document</span>
</span></pre></div>


    

                            </div>
                            <div id="Filter.apply_batch" class="classattr">
                                        <input id="Filter.apply_batch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">apply_batch</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">batch</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n"><a href="#Document">hojichar.Document</a></span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="n"><a href="#Document">hojichar.Document</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Filter.apply_batch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Filter.apply_batch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Filter.apply_batch-148"><a href="#Filter.apply_batch-148"><span class="linenos">148</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Document</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Document</span><span class="p">]:</span>
</span><span id="Filter.apply_batch-149"><a href="#Filter.apply_batch-149"><span class="linenos">149</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Filter.apply_batch-150"><a href="#Filter.apply_batch-150"><span class="linenos">150</span></a><span class="sd">        Apply the filter to a batch of documents.</span>
</span><span id="Filter.apply_batch-151"><a href="#Filter.apply_batch-151"><span class="linenos">151</span></a><span class="sd">        You can override this method if you want to</span>
</span><span id="Filter.apply_batch-152"><a href="#Filter.apply_batch-152"><span class="linenos">152</span></a><span class="sd">        apply the filter to a batch of documents at once.</span>
</span><span id="Filter.apply_batch-153"><a href="#Filter.apply_batch-153"><span class="linenos">153</span></a>
</span><span id="Filter.apply_batch-154"><a href="#Filter.apply_batch-154"><span class="linenos">154</span></a><span class="sd">        This method may be used in `apply_batch` method of `Compose` class.</span>
</span><span id="Filter.apply_batch-155"><a href="#Filter.apply_batch-155"><span class="linenos">155</span></a>
</span><span id="Filter.apply_batch-156"><a href="#Filter.apply_batch-156"><span class="linenos">156</span></a><span class="sd">        Parameters</span>
</span><span id="Filter.apply_batch-157"><a href="#Filter.apply_batch-157"><span class="linenos">157</span></a><span class="sd">        ----------</span>
</span><span id="Filter.apply_batch-158"><a href="#Filter.apply_batch-158"><span class="linenos">158</span></a><span class="sd">        documents : Sequence[Document]</span>
</span><span id="Filter.apply_batch-159"><a href="#Filter.apply_batch-159"><span class="linenos">159</span></a><span class="sd">            List-like object of input documents</span>
</span><span id="Filter.apply_batch-160"><a href="#Filter.apply_batch-160"><span class="linenos">160</span></a>
</span><span id="Filter.apply_batch-161"><a href="#Filter.apply_batch-161"><span class="linenos">161</span></a><span class="sd">        Returns</span>
</span><span id="Filter.apply_batch-162"><a href="#Filter.apply_batch-162"><span class="linenos">162</span></a><span class="sd">        -------</span>
</span><span id="Filter.apply_batch-163"><a href="#Filter.apply_batch-163"><span class="linenos">163</span></a><span class="sd">        list[Document]</span>
</span><span id="Filter.apply_batch-164"><a href="#Filter.apply_batch-164"><span class="linenos">164</span></a><span class="sd">            List of processed documents</span>
</span><span id="Filter.apply_batch-165"><a href="#Filter.apply_batch-165"><span class="linenos">165</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Filter.apply_batch-166"><a href="#Filter.apply_batch-166"><span class="linenos">166</span></a>        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">document</span><span class="p">)</span> <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Apply the filter to a batch of documents.
You can override this method if you want to
apply the filter to a batch of documents at once.</p>

<p>This method may be used in <code><a href="#Filter.apply_batch">apply_batch</a></code> method of <code><a href="#Compose">Compose</a></code> class.</p>

<h2 id="parameters">Parameters</h2>

<p>documents : Sequence[Document]
    List-like object of input documents</p>

<h2 id="returns">Returns</h2>

<p>list[Document]
    List of processed documents</p>
</div>


                            </div>
                            <div id="Filter.apply_stream" class="classattr">
                                        <input id="Filter.apply_stream-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">apply_stream</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">stream</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n"><a href="#Document">hojichar.Document</a></span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">Iterable</span><span class="p">[</span><span class="n"><a href="#Document">hojichar.Document</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Filter.apply_stream-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Filter.apply_stream"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Filter.apply_stream-186"><a href="#Filter.apply_stream-186"><span class="linenos">186</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Document</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Document</span><span class="p">]:</span>
</span><span id="Filter.apply_stream-187"><a href="#Filter.apply_stream-187"><span class="linenos">187</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Filter.apply_stream-188"><a href="#Filter.apply_stream-188"><span class="linenos">188</span></a><span class="sd">        Apply the filter to a stream of documents.</span>
</span><span id="Filter.apply_stream-189"><a href="#Filter.apply_stream-189"><span class="linenos">189</span></a><span class="sd">        This method is used when you want to process documents one by one.</span>
</span><span id="Filter.apply_stream-190"><a href="#Filter.apply_stream-190"><span class="linenos">190</span></a><span class="sd">        If `use_batch` is set to `True` in the constructor,</span>
</span><span id="Filter.apply_stream-191"><a href="#Filter.apply_stream-191"><span class="linenos">191</span></a><span class="sd">        this method will process documents in batches using the `apply_batch` method.</span>
</span><span id="Filter.apply_stream-192"><a href="#Filter.apply_stream-192"><span class="linenos">192</span></a>
</span><span id="Filter.apply_stream-193"><a href="#Filter.apply_stream-193"><span class="linenos">193</span></a><span class="sd">        Even if an exception occurs during processing, the process will continue, and the following actions will be taken:</span>
</span><span id="Filter.apply_stream-194"><a href="#Filter.apply_stream-194"><span class="linenos">194</span></a><span class="sd">        - Set the `is_rejected` flag of the document to `True`</span>
</span><span id="Filter.apply_stream-195"><a href="#Filter.apply_stream-195"><span class="linenos">195</span></a><span class="sd">        - Set the error details in `reject_reason`</span>
</span><span id="Filter.apply_stream-196"><a href="#Filter.apply_stream-196"><span class="linenos">196</span></a><span class="sd">        - Increment the `errors` count in the statistics retrievable via `get_statistics`</span>
</span><span id="Filter.apply_stream-197"><a href="#Filter.apply_stream-197"><span class="linenos">197</span></a>
</span><span id="Filter.apply_stream-198"><a href="#Filter.apply_stream-198"><span class="linenos">198</span></a><span class="sd">        Parameters</span>
</span><span id="Filter.apply_stream-199"><a href="#Filter.apply_stream-199"><span class="linenos">199</span></a><span class="sd">        ----------</span>
</span><span id="Filter.apply_stream-200"><a href="#Filter.apply_stream-200"><span class="linenos">200</span></a><span class="sd">        stream : Iterable[Document]</span>
</span><span id="Filter.apply_stream-201"><a href="#Filter.apply_stream-201"><span class="linenos">201</span></a><span class="sd">            Stream of input documents</span>
</span><span id="Filter.apply_stream-202"><a href="#Filter.apply_stream-202"><span class="linenos">202</span></a>
</span><span id="Filter.apply_stream-203"><a href="#Filter.apply_stream-203"><span class="linenos">203</span></a><span class="sd">        Returns</span>
</span><span id="Filter.apply_stream-204"><a href="#Filter.apply_stream-204"><span class="linenos">204</span></a><span class="sd">        -------</span>
</span><span id="Filter.apply_stream-205"><a href="#Filter.apply_stream-205"><span class="linenos">205</span></a><span class="sd">        Iterable[Document]</span>
</span><span id="Filter.apply_stream-206"><a href="#Filter.apply_stream-206"><span class="linenos">206</span></a><span class="sd">            Stream of processed documents</span>
</span><span id="Filter.apply_stream-207"><a href="#Filter.apply_stream-207"><span class="linenos">207</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Filter.apply_stream-208"><a href="#Filter.apply_stream-208"><span class="linenos">208</span></a>
</span><span id="Filter.apply_stream-209"><a href="#Filter.apply_stream-209"><span class="linenos">209</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_batch</span><span class="p">:</span>
</span><span id="Filter.apply_stream-210"><a href="#Filter.apply_stream-210"><span class="linenos">210</span></a>            <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">stream</span><span class="p">:</span>
</span><span id="Filter.apply_stream-211"><a href="#Filter.apply_stream-211"><span class="linenos">211</span></a>                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_try_process</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply</span><span class="p">)</span>
</span><span id="Filter.apply_stream-212"><a href="#Filter.apply_stream-212"><span class="linenos">212</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Filter.apply_stream-213"><a href="#Filter.apply_stream-213"><span class="linenos">213</span></a>            <span class="n">batch</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Document</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Filter.apply_stream-214"><a href="#Filter.apply_stream-214"><span class="linenos">214</span></a>            <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">stream</span><span class="p">:</span>
</span><span id="Filter.apply_stream-215"><a href="#Filter.apply_stream-215"><span class="linenos">215</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_skip</span><span class="p">(</span><span class="n">document</span><span class="p">):</span>
</span><span id="Filter.apply_stream-216"><a href="#Filter.apply_stream-216"><span class="linenos">216</span></a>                    <span class="k">yield</span> <span class="n">document</span>
</span><span id="Filter.apply_stream-217"><a href="#Filter.apply_stream-217"><span class="linenos">217</span></a>                    <span class="k">continue</span>
</span><span id="Filter.apply_stream-218"><a href="#Filter.apply_stream-218"><span class="linenos">218</span></a>
</span><span id="Filter.apply_stream-219"><a href="#Filter.apply_stream-219"><span class="linenos">219</span></a>                <span class="n">batch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="Filter.apply_stream-220"><a href="#Filter.apply_stream-220"><span class="linenos">220</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">:</span>
</span><span id="Filter.apply_stream-221"><a href="#Filter.apply_stream-221"><span class="linenos">221</span></a>                    <span class="n">stats</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_doc_info</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">]</span>
</span><span id="Filter.apply_stream-222"><a href="#Filter.apply_stream-222"><span class="linenos">222</span></a>                    <span class="n">batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_try_process</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_batch</span><span class="p">)</span>
</span><span id="Filter.apply_stream-223"><a href="#Filter.apply_stream-223"><span class="linenos">223</span></a>                    <span class="n">batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finalize_batch</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">stats</span><span class="p">)</span>
</span><span id="Filter.apply_stream-224"><a href="#Filter.apply_stream-224"><span class="linenos">224</span></a>                    <span class="k">yield from</span> <span class="n">batch</span>
</span><span id="Filter.apply_stream-225"><a href="#Filter.apply_stream-225"><span class="linenos">225</span></a>                    <span class="n">batch</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="Filter.apply_stream-226"><a href="#Filter.apply_stream-226"><span class="linenos">226</span></a>            <span class="k">if</span> <span class="n">batch</span><span class="p">:</span>
</span><span id="Filter.apply_stream-227"><a href="#Filter.apply_stream-227"><span class="linenos">227</span></a>                <span class="n">stats</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_doc_info</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">]</span>
</span><span id="Filter.apply_stream-228"><a href="#Filter.apply_stream-228"><span class="linenos">228</span></a>                <span class="n">batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_try_process</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_batch</span><span class="p">)</span>
</span><span id="Filter.apply_stream-229"><a href="#Filter.apply_stream-229"><span class="linenos">229</span></a>                <span class="n">batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finalize_batch</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">stats</span><span class="p">)</span>
</span><span id="Filter.apply_stream-230"><a href="#Filter.apply_stream-230"><span class="linenos">230</span></a>                <span class="k">yield from</span> <span class="n">batch</span>
</span></pre></div>


            <div class="docstring"><p>Apply the filter to a stream of documents.
This method is used when you want to process documents one by one.
If <code>use_batch</code> is set to <code>True</code> in the constructor,
this method will process documents in batches using the <code><a href="#Filter.apply_batch">apply_batch</a></code> method.</p>

<p>Even if an exception occurs during processing, the process will continue, and the following actions will be taken:</p>

<ul>
<li>Set the <code>is_rejected</code> flag of the document to <code>True</code></li>
<li>Set the error details in <code>reject_reason</code></li>
<li>Increment the <code>errors</code> count in the statistics retrievable via <code><a href="#Filter.get_statistics">get_statistics</a></code></li>
</ul>

<h2 id="parameters">Parameters</h2>

<p>stream : Iterable[Document]
    Stream of input documents</p>

<h2 id="returns">Returns</h2>

<p>Iterable[Document]
    Stream of processed documents</p>
</div>


                            </div>
                            <div id="Filter.get_statistics" class="classattr">
                                        <input id="Filter.get_statistics-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_statistics</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="hojichar/core/models.html#Statistics">hojichar.core.models.Statistics</a></span>:</span></span>

                <label class="view-source-button" for="Filter.get_statistics-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Filter.get_statistics"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Filter.get_statistics-259"><a href="#Filter.get_statistics-259"><span class="linenos">259</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Statistics</span><span class="p">:</span>
</span><span id="Filter.get_statistics-260"><a href="#Filter.get_statistics-260"><span class="linenos">260</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Filter.get_statistics-261"><a href="#Filter.get_statistics-261"><span class="linenos">261</span></a><span class="sd">        Get the statistics of this filter.</span>
</span><span id="Filter.get_statistics-262"><a href="#Filter.get_statistics-262"><span class="linenos">262</span></a><span class="sd">        This method returns the statistics of the filter,</span>
</span><span id="Filter.get_statistics-263"><a href="#Filter.get_statistics-263"><span class="linenos">263</span></a><span class="sd">        which includes the number of processed documents, discarded documents, and other statistics.</span>
</span><span id="Filter.get_statistics-264"><a href="#Filter.get_statistics-264"><span class="linenos">264</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Filter.get_statistics-265"><a href="#Filter.get_statistics-265"><span class="linenos">265</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_statistics</span>
</span></pre></div>


            <div class="docstring"><p>Get the statistics of this filter.
This method returns the statistics of the filter,
which includes the number of processed documents, discarded documents, and other statistics.</p>
</div>


                            </div>
                            <div id="Filter.get_statistics_map" class="classattr">
                                        <input id="Filter.get_statistics_map-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_statistics_map</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Filter.get_statistics_map-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Filter.get_statistics_map"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Filter.get_statistics_map-267"><a href="#Filter.get_statistics_map-267"><span class="linenos">267</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_statistics_map</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="Filter.get_statistics_map-268"><a href="#Filter.get_statistics_map-268"><span class="linenos">268</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Filter.get_statistics_map-269"><a href="#Filter.get_statistics_map-269"><span class="linenos">269</span></a><span class="sd">        Get the statistics of this filter as a dictionary.</span>
</span><span id="Filter.get_statistics_map-270"><a href="#Filter.get_statistics_map-270"><span class="linenos">270</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Filter.get_statistics_map-271"><a href="#Filter.get_statistics_map-271"><span class="linenos">271</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_statistics</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Get the statistics of this filter as a dictionary.</p>
</div>


                            </div>
                            <div id="Filter.shutdown" class="classattr">
                                        <input id="Filter.shutdown-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">shutdown</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Filter.shutdown-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Filter.shutdown"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Filter.shutdown-273"><a href="#Filter.shutdown-273"><span class="linenos">273</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Filter.shutdown-274"><a href="#Filter.shutdown-274"><span class="linenos">274</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Filter.shutdown-275"><a href="#Filter.shutdown-275"><span class="linenos">275</span></a><span class="sd">        This method is called when the filter is no longer needed.</span>
</span><span id="Filter.shutdown-276"><a href="#Filter.shutdown-276"><span class="linenos">276</span></a><span class="sd">        You can override this method to release resources or perform cleanup tasks.</span>
</span><span id="Filter.shutdown-277"><a href="#Filter.shutdown-277"><span class="linenos">277</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Filter.shutdown-278"><a href="#Filter.shutdown-278"><span class="linenos">278</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>This method is called when the filter is no longer needed.
You can override this method to release resources or perform cleanup tasks.</p>
</div>


                            </div>
                            <div id="Filter.get_jsonable_vars" class="classattr">
                                        <input id="Filter.get_jsonable_vars-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_jsonable_vars</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">exclude_keys</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Filter.get_jsonable_vars-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Filter.get_jsonable_vars"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Filter.get_jsonable_vars-290"><a href="#Filter.get_jsonable_vars-290"><span class="linenos">290</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_jsonable_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exclude_keys</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="Filter.get_jsonable_vars-291"><a href="#Filter.get_jsonable_vars-291"><span class="linenos">291</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Filter.get_jsonable_vars-292"><a href="#Filter.get_jsonable_vars-292"><span class="linenos">292</span></a><span class="sd">        Get the member variable of this filter.</span>
</span><span id="Filter.get_jsonable_vars-293"><a href="#Filter.get_jsonable_vars-293"><span class="linenos">293</span></a><span class="sd">        Eligible variables are primitive types; [bool, int, float, str, None],</span>
</span><span id="Filter.get_jsonable_vars-294"><a href="#Filter.get_jsonable_vars-294"><span class="linenos">294</span></a><span class="sd">        and the name of the variable not starts with the underscore; `_`.</span>
</span><span id="Filter.get_jsonable_vars-295"><a href="#Filter.get_jsonable_vars-295"><span class="linenos">295</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Filter.get_jsonable_vars-296"><a href="#Filter.get_jsonable_vars-296"><span class="linenos">296</span></a>        <span class="k">if</span> <span class="n">exclude_keys</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Filter.get_jsonable_vars-297"><a href="#Filter.get_jsonable_vars-297"><span class="linenos">297</span></a>            <span class="n">exclude_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="Filter.get_jsonable_vars-298"><a href="#Filter.get_jsonable_vars-298"><span class="linenos">298</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="Filter.get_jsonable_vars-299"><a href="#Filter.get_jsonable_vars-299"><span class="linenos">299</span></a>            <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
</span><span id="Filter.get_jsonable_vars-300"><a href="#Filter.get_jsonable_vars-300"><span class="linenos">300</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Filter.get_jsonable_vars-301"><a href="#Filter.get_jsonable_vars-301"><span class="linenos">301</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">_is_jsonable</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude_keys</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)))</span>
</span><span id="Filter.get_jsonable_vars-302"><a href="#Filter.get_jsonable_vars-302"><span class="linenos">302</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Get the member variable of this filter.
Eligible variables are primitive types; [bool, int, float, str, None],
and the name of the variable not starts with the underscore; <code>_</code>.</p>
</div>


                            </div>
                </section>
                <section id="TokenFilter">
                            <input id="TokenFilter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@deprecated_since(version=&#39;1.0.0&#39;, alternative=&#39;Filter&#39;)</div>

    <span class="def">class</span>
    <span class="name">TokenFilter</span><wbr>(<span class="base"><a href="#Filter">hojichar.Filter</a></span>, <span class="base">abc.ABC</span>):

                <label class="view-source-button" for="TokenFilter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TokenFilter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TokenFilter-335"><a href="#TokenFilter-335"><span class="linenos">335</span></a><span class="nd">@deprecated_since</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;Filter&quot;</span><span class="p">)</span>
</span><span id="TokenFilter-336"><a href="#TokenFilter-336"><span class="linenos">336</span></a><span class="k">class</span><span class="w"> </span><span class="nc">TokenFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
</span><span id="TokenFilter-337"><a href="#TokenFilter-337"><span class="linenos">337</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TokenFilter-338"><a href="#TokenFilter-338"><span class="linenos">338</span></a><span class="sd">    Base class for token-level filters.</span>
</span><span id="TokenFilter-339"><a href="#TokenFilter-339"><span class="linenos">339</span></a>
</span><span id="TokenFilter-340"><a href="#TokenFilter-340"><span class="linenos">340</span></a><span class="sd">    Token filters, which shuld be implemented in hojichar/filters/token_filters.py,</span>
</span><span id="TokenFilter-341"><a href="#TokenFilter-341"><span class="linenos">341</span></a><span class="sd">    must inherit from this class.</span>
</span><span id="TokenFilter-342"><a href="#TokenFilter-342"><span class="linenos">342</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="TokenFilter-343"><a href="#TokenFilter-343"><span class="linenos">343</span></a>
</span><span id="TokenFilter-344"><a href="#TokenFilter-344"><span class="linenos">344</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="TokenFilter-345"><a href="#TokenFilter-345"><span class="linenos">345</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">skip_rejected</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="TokenFilter-346"><a href="#TokenFilter-346"><span class="linenos">346</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TokenFilter-347"><a href="#TokenFilter-347"><span class="linenos">347</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="TokenFilter-348"><a href="#TokenFilter-348"><span class="linenos">348</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;hojichar.token_filters.&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="TokenFilter-349"><a href="#TokenFilter-349"><span class="linenos">349</span></a>        <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">p</span> <span class="o">&lt;=</span> <span class="mi">1</span>
</span><span id="TokenFilter-350"><a href="#TokenFilter-350"><span class="linenos">350</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
</span><span id="TokenFilter-351"><a href="#TokenFilter-351"><span class="linenos">351</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">skip_rejected</span> <span class="o">=</span> <span class="n">skip_rejected</span>
</span><span id="TokenFilter-352"><a href="#TokenFilter-352"><span class="linenos">352</span></a>
</span><span id="TokenFilter-353"><a href="#TokenFilter-353"><span class="linenos">353</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="n">Token</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Token</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
</span><span id="TokenFilter-354"><a href="#TokenFilter-354"><span class="linenos">354</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.apply method is not defined&quot;</span><span class="p">)</span>
</span><span id="TokenFilter-355"><a href="#TokenFilter-355"><span class="linenos">355</span></a>        <span class="k">return</span> <span class="n">token</span>
</span><span id="TokenFilter-356"><a href="#TokenFilter-356"><span class="linenos">356</span></a>
</span><span id="TokenFilter-357"><a href="#TokenFilter-357"><span class="linenos">357</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Document</span><span class="p">:</span>
</span><span id="TokenFilter-358"><a href="#TokenFilter-358"><span class="linenos">358</span></a>        <span class="n">document</span><span class="o">.</span><span class="n">tokens</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">token</span><span class="p">)</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">document</span><span class="o">.</span><span class="n">tokens</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="o">.</span><span class="n">is_rejected</span><span class="p">]</span>
</span><span id="TokenFilter-359"><a href="#TokenFilter-359"><span class="linenos">359</span></a>        <span class="k">return</span> <span class="n">document</span>
</span><span id="TokenFilter-360"><a href="#TokenFilter-360"><span class="linenos">360</span></a>
</span><span id="TokenFilter-361"><a href="#TokenFilter-361"><span class="linenos">361</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
</span><span id="TokenFilter-362"><a href="#TokenFilter-362"><span class="linenos">362</span></a>        <span class="n">token</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span><span id="TokenFilter-363"><a href="#TokenFilter-363"><span class="linenos">363</span></a>        <span class="n">token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</span><span id="TokenFilter-364"><a href="#TokenFilter-364"><span class="linenos">364</span></a>        <span class="k">return</span> <span class="n">token</span><span class="o">.</span><span class="n">text</span>
</span><span id="TokenFilter-365"><a href="#TokenFilter-365"><span class="linenos">365</span></a>
</span><span id="TokenFilter-366"><a href="#TokenFilter-366"><span class="linenos">366</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Document</span><span class="p">:</span>
</span><span id="TokenFilter-367"><a href="#TokenFilter-367"><span class="linenos">367</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TokenFilter-368"><a href="#TokenFilter-368"><span class="linenos">368</span></a><span class="sd">        Apply the token filter to a single document.</span>
</span><span id="TokenFilter-369"><a href="#TokenFilter-369"><span class="linenos">369</span></a><span class="sd">        This method checks if the document should be skipped.</span>
</span><span id="TokenFilter-370"><a href="#TokenFilter-370"><span class="linenos">370</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TokenFilter-371"><a href="#TokenFilter-371"><span class="linenos">371</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_rejected</span> <span class="ow">and</span> <span class="n">document</span><span class="o">.</span><span class="n">is_rejected</span><span class="p">:</span>
</span><span id="TokenFilter-372"><a href="#TokenFilter-372"><span class="linenos">372</span></a>            <span class="k">return</span> <span class="n">document</span>
</span><span id="TokenFilter-373"><a href="#TokenFilter-373"><span class="linenos">373</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_filter</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="TokenFilter-374"><a href="#TokenFilter-374"><span class="linenos">374</span></a>
</span><span id="TokenFilter-375"><a href="#TokenFilter-375"><span class="linenos">375</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_jsonable_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exclude_keys</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="TokenFilter-376"><a href="#TokenFilter-376"><span class="linenos">376</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TokenFilter-377"><a href="#TokenFilter-377"><span class="linenos">377</span></a><span class="sd">        Get the member variable of this filter.</span>
</span><span id="TokenFilter-378"><a href="#TokenFilter-378"><span class="linenos">378</span></a><span class="sd">        Eligible variables are primitive types; [bool, int, float, str, None],</span>
</span><span id="TokenFilter-379"><a href="#TokenFilter-379"><span class="linenos">379</span></a><span class="sd">        and the name of the variable not starts with the underscore; `_`.</span>
</span><span id="TokenFilter-380"><a href="#TokenFilter-380"><span class="linenos">380</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TokenFilter-381"><a href="#TokenFilter-381"><span class="linenos">381</span></a>        <span class="k">if</span> <span class="n">exclude_keys</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TokenFilter-382"><a href="#TokenFilter-382"><span class="linenos">382</span></a>            <span class="n">exclude_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="TokenFilter-383"><a href="#TokenFilter-383"><span class="linenos">383</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="TokenFilter-384"><a href="#TokenFilter-384"><span class="linenos">384</span></a>            <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
</span><span id="TokenFilter-385"><a href="#TokenFilter-385"><span class="linenos">385</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="TokenFilter-386"><a href="#TokenFilter-386"><span class="linenos">386</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">_is_jsonable</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude_keys</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)))</span>
</span><span id="TokenFilter-387"><a href="#TokenFilter-387"><span class="linenos">387</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Base class for token-level filters.</p>

<p>Token filters, which shuld be implemented in hojichar/filters/token_filters.py,
must inherit from this class.</p>
</div>


                            <div id="TokenFilter.__init__" class="classattr">
                                        <input id="TokenFilter.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">TokenFilter</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">p</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span>, </span><span class="param"><span class="n">skip_rejected</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>, </span><span class="param"><span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span></span>)</span>

                <label class="view-source-button" for="TokenFilter.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TokenFilter.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TokenFilter.__init__-344"><a href="#TokenFilter.__init__-344"><span class="linenos">344</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="TokenFilter.__init__-345"><a href="#TokenFilter.__init__-345"><span class="linenos">345</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">skip_rejected</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="TokenFilter.__init__-346"><a href="#TokenFilter.__init__-346"><span class="linenos">346</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TokenFilter.__init__-347"><a href="#TokenFilter.__init__-347"><span class="linenos">347</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="TokenFilter.__init__-348"><a href="#TokenFilter.__init__-348"><span class="linenos">348</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;hojichar.token_filters.&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="TokenFilter.__init__-349"><a href="#TokenFilter.__init__-349"><span class="linenos">349</span></a>        <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">p</span> <span class="o">&lt;=</span> <span class="mi">1</span>
</span><span id="TokenFilter.__init__-350"><a href="#TokenFilter.__init__-350"><span class="linenos">350</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
</span><span id="TokenFilter.__init__-351"><a href="#TokenFilter.__init__-351"><span class="linenos">351</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">skip_rejected</span> <span class="o">=</span> <span class="n">skip_rejected</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the filter.</p>

<h2 id="parameters">Parameters</h2>

<p>p : float
    The probability of applying the filter.
    If <code>p</code> is 1, the filter will always be applied.
skip_rejected : bool
    If <code>True</code>, the filter will skip documents that are already rejected.
    If you want to apply the filter to all documents (e.g., postprocess), set this to <code>False</code>.
random_state : Optional[Union[int, np.random.Generator]]
    Seed for the random number generator.
    If <code>None</code>, a new random number generator will be created.
    If <code>None</code>, and use in the <code><a href="#Compose">Compose</a></code> class, the random state is shared with the <code><a href="#Compose">Compose</a></code> object.
use_batch : bool
    If <code>True</code>, the filter will process documents in batches in the <code><a href="#TokenFilter.apply_stream">apply_stream</a></code> method.
batch_size : int
    The size of the batch to process documents in the <code><a href="#TokenFilter.apply_stream">apply_stream</a></code> method.
kwargs : Any
    Additional keyword arguments to pass to the filter.</p>
</div>


                            </div>
                            <div id="TokenFilter.apply" class="classattr">
                                        <input id="TokenFilter.apply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">apply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">token</span><span class="p">:</span> <span class="n"><a href="#Token">hojichar.Token</a></span></span><span class="return-annotation">) -> <span class="n"><a href="#Token">hojichar.Token</a></span>:</span></span>

                <label class="view-source-button" for="TokenFilter.apply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TokenFilter.apply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TokenFilter.apply-353"><a href="#TokenFilter.apply-353"><span class="linenos">353</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="n">Token</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Token</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
</span><span id="TokenFilter.apply-354"><a href="#TokenFilter.apply-354"><span class="linenos">354</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.apply method is not defined&quot;</span><span class="p">)</span>
</span><span id="TokenFilter.apply-355"><a href="#TokenFilter.apply-355"><span class="linenos">355</span></a>        <span class="k">return</span> <span class="n">token</span>
</span></pre></div>


            <div class="docstring"><p>Definition of filter behavior.</p>

<p>The document must have a protocol <code>TextContent</code>,
and mostly used <a href="#Document">hojichar.Document</a> class.</p>

<p>In this method, the filter will modify <code>document.text</code> or
<code>document.extras</code> and set <code>document.is_rejected = True</code> to discard the document.</p>

<h2 id="parameters">Parameters</h2>

<p>document : Document
    Input document</p>

<h2 id="returns">Returns</h2>

<p>Document
    Processed Document</p>
</div>


                            </div>
                            <div id="TokenFilter.apply_filter" class="classattr">
                                        <input id="TokenFilter.apply_filter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">apply_filter</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">document</span><span class="p">:</span> <span class="n"><a href="#Document">hojichar.Document</a></span></span><span class="return-annotation">) -> <span class="n"><a href="#Document">hojichar.Document</a></span>:</span></span>

                <label class="view-source-button" for="TokenFilter.apply_filter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TokenFilter.apply_filter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TokenFilter.apply_filter-357"><a href="#TokenFilter.apply_filter-357"><span class="linenos">357</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Document</span><span class="p">:</span>
</span><span id="TokenFilter.apply_filter-358"><a href="#TokenFilter.apply_filter-358"><span class="linenos">358</span></a>        <span class="n">document</span><span class="o">.</span><span class="n">tokens</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">token</span><span class="p">)</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">document</span><span class="o">.</span><span class="n">tokens</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="o">.</span><span class="n">is_rejected</span><span class="p">]</span>
</span><span id="TokenFilter.apply_filter-359"><a href="#TokenFilter.apply_filter-359"><span class="linenos">359</span></a>        <span class="k">return</span> <span class="n">document</span>
</span></pre></div>


    

                            </div>
                            <div id="TokenFilter.get_jsonable_vars" class="classattr">
                                        <input id="TokenFilter.get_jsonable_vars-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_jsonable_vars</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">exclude_keys</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="TokenFilter.get_jsonable_vars-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TokenFilter.get_jsonable_vars"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TokenFilter.get_jsonable_vars-375"><a href="#TokenFilter.get_jsonable_vars-375"><span class="linenos">375</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_jsonable_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exclude_keys</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="TokenFilter.get_jsonable_vars-376"><a href="#TokenFilter.get_jsonable_vars-376"><span class="linenos">376</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TokenFilter.get_jsonable_vars-377"><a href="#TokenFilter.get_jsonable_vars-377"><span class="linenos">377</span></a><span class="sd">        Get the member variable of this filter.</span>
</span><span id="TokenFilter.get_jsonable_vars-378"><a href="#TokenFilter.get_jsonable_vars-378"><span class="linenos">378</span></a><span class="sd">        Eligible variables are primitive types; [bool, int, float, str, None],</span>
</span><span id="TokenFilter.get_jsonable_vars-379"><a href="#TokenFilter.get_jsonable_vars-379"><span class="linenos">379</span></a><span class="sd">        and the name of the variable not starts with the underscore; `_`.</span>
</span><span id="TokenFilter.get_jsonable_vars-380"><a href="#TokenFilter.get_jsonable_vars-380"><span class="linenos">380</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TokenFilter.get_jsonable_vars-381"><a href="#TokenFilter.get_jsonable_vars-381"><span class="linenos">381</span></a>        <span class="k">if</span> <span class="n">exclude_keys</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TokenFilter.get_jsonable_vars-382"><a href="#TokenFilter.get_jsonable_vars-382"><span class="linenos">382</span></a>            <span class="n">exclude_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="TokenFilter.get_jsonable_vars-383"><a href="#TokenFilter.get_jsonable_vars-383"><span class="linenos">383</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="TokenFilter.get_jsonable_vars-384"><a href="#TokenFilter.get_jsonable_vars-384"><span class="linenos">384</span></a>            <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
</span><span id="TokenFilter.get_jsonable_vars-385"><a href="#TokenFilter.get_jsonable_vars-385"><span class="linenos">385</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="TokenFilter.get_jsonable_vars-386"><a href="#TokenFilter.get_jsonable_vars-386"><span class="linenos">386</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">_is_jsonable</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude_keys</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)))</span>
</span><span id="TokenFilter.get_jsonable_vars-387"><a href="#TokenFilter.get_jsonable_vars-387"><span class="linenos">387</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Get the member variable of this filter.
Eligible variables are primitive types; [bool, int, float, str, None],
and the name of the variable not starts with the underscore; <code>_</code>.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#Filter">Filter</a></dt>
                                <dd id="TokenFilter.apply_batch" class="function"><a href="#Filter.apply_batch">apply_batch</a></dd>
                <dd id="TokenFilter.apply_stream" class="function"><a href="#Filter.apply_stream">apply_stream</a></dd>
                <dd id="TokenFilter.get_statistics" class="function"><a href="#Filter.get_statistics">get_statistics</a></dd>
                <dd id="TokenFilter.get_statistics_map" class="function"><a href="#Filter.get_statistics_map">get_statistics_map</a></dd>
                <dd id="TokenFilter.shutdown" class="function"><a href="#Filter.shutdown">shutdown</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Document">
                            <input id="Document-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Document</span>:

                <label class="view-source-button" for="Document-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Document"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Document-24"><a href="#Document-24"><span class="linenos">24</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Document</span><span class="p">:</span>
</span><span id="Document-25"><a href="#Document-25"><span class="linenos">25</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Document-26"><a href="#Document-26"><span class="linenos">26</span></a><span class="sd">    Document class represents a text document with metadata.</span>
</span><span id="Document-27"><a href="#Document-27"><span class="linenos">27</span></a><span class="sd">    It contains the text of the document, a flag indicating whether it is rejected,</span>
</span><span id="Document-28"><a href="#Document-28"><span class="linenos">28</span></a><span class="sd">     and additional metadata stored in the `extras` dictionary.</span>
</span><span id="Document-29"><a href="#Document-29"><span class="linenos">29</span></a>
</span><span id="Document-30"><a href="#Document-30"><span class="linenos">30</span></a><span class="sd">    The `tokens` attribute will be deprecated in future versions,</span>
</span><span id="Document-31"><a href="#Document-31"><span class="linenos">31</span></a><span class="sd">    and users are encouraged to use the `extras` dictionary to store token-related information.</span>
</span><span id="Document-32"><a href="#Document-32"><span class="linenos">32</span></a>
</span><span id="Document-33"><a href="#Document-33"><span class="linenos">33</span></a><span class="sd">    Attributes:</span>
</span><span id="Document-34"><a href="#Document-34"><span class="linenos">34</span></a><span class="sd">        text (str): The text content of the document.</span>
</span><span id="Document-35"><a href="#Document-35"><span class="linenos">35</span></a><span class="sd">        is_rejected (bool): A flag indicating whether the document is rejected.</span>
</span><span id="Document-36"><a href="#Document-36"><span class="linenos">36</span></a><span class="sd">        extras (Dict[str, Any]): A dictionary to store additional metadata about the document.</span>
</span><span id="Document-37"><a href="#Document-37"><span class="linenos">37</span></a><span class="sd">        reject_reason (Dict[str, Any]): A dictionary to store the reason for rejection. The</span>
</span><span id="Document-38"><a href="#Document-38"><span class="linenos">38</span></a><span class="sd">          filter class and the member name and value will logged at the filter is logged here.</span>
</span><span id="Document-39"><a href="#Document-39"><span class="linenos">39</span></a>
</span><span id="Document-40"><a href="#Document-40"><span class="linenos">40</span></a><span class="sd">    Next attributes will be deprecated in future versions:</span>
</span><span id="Document-41"><a href="#Document-41"><span class="linenos">41</span></a><span class="sd">        tokens (List[Token]): A list of tokens extracted from the document.</span>
</span><span id="Document-42"><a href="#Document-42"><span class="linenos">42</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Document-43"><a href="#Document-43"><span class="linenos">43</span></a>
</span><span id="Document-44"><a href="#Document-44"><span class="linenos">44</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="Document-45"><a href="#Document-45"><span class="linenos">45</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Document-46"><a href="#Document-46"><span class="linenos">46</span></a>        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Document-47"><a href="#Document-47"><span class="linenos">47</span></a>        <span class="n">is_rejected</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Document-48"><a href="#Document-48"><span class="linenos">48</span></a>        <span class="n">tokens</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Token</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Document-49"><a href="#Document-49"><span class="linenos">49</span></a>        <span class="n">extras</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Document-50"><a href="#Document-50"><span class="linenos">50</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Document-51"><a href="#Document-51"><span class="linenos">51</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
</span><span id="Document-52"><a href="#Document-52"><span class="linenos">52</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__original</span> <span class="o">=</span> <span class="n">text</span>
</span><span id="Document-53"><a href="#Document-53"><span class="linenos">53</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">is_rejected</span> <span class="o">=</span> <span class="n">is_rejected</span>
</span><span id="Document-54"><a href="#Document-54"><span class="linenos">54</span></a>        <span class="k">if</span> <span class="n">tokens</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Document-55"><a href="#Document-55"><span class="linenos">55</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Token</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Document-56"><a href="#Document-56"><span class="linenos">56</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Document-57"><a href="#Document-57"><span class="linenos">57</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span> <span class="o">=</span> <span class="n">tokens</span>
</span><span id="Document-58"><a href="#Document-58"><span class="linenos">58</span></a>
</span><span id="Document-59"><a href="#Document-59"><span class="linenos">59</span></a>        <span class="k">if</span> <span class="n">extras</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Document-60"><a href="#Document-60"><span class="linenos">60</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">extras</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Document-61"><a href="#Document-61"><span class="linenos">61</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Document-62"><a href="#Document-62"><span class="linenos">62</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">extras</span> <span class="o">=</span> <span class="n">extras</span>
</span><span id="Document-63"><a href="#Document-63"><span class="linenos">63</span></a>
</span><span id="Document-64"><a href="#Document-64"><span class="linenos">64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reject_reason</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Document-65"><a href="#Document-65"><span class="linenos">65</span></a>
</span><span id="Document-66"><a href="#Document-66"><span class="linenos">66</span></a>    <span class="nd">@property</span>
</span><span id="Document-67"><a href="#Document-67"><span class="linenos">67</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">original</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Document-68"><a href="#Document-68"><span class="linenos">68</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__original</span>
</span><span id="Document-69"><a href="#Document-69"><span class="linenos">69</span></a>
</span><span id="Document-70"><a href="#Document-70"><span class="linenos">70</span></a>    <span class="nd">@deprecated_since</span><span class="p">(</span><span class="s2">&quot;1.0.0&quot;</span><span class="p">)</span>
</span><span id="Document-71"><a href="#Document-71"><span class="linenos">71</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokens</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Document-72"><a href="#Document-72"><span class="linenos">72</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span> <span class="o">=</span> <span class="p">[</span><span class="n">Token</span><span class="p">(</span><span class="n">token</span><span class="p">)</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">]</span>
</span><span id="Document-73"><a href="#Document-73"><span class="linenos">73</span></a>
</span><span id="Document-74"><a href="#Document-74"><span class="linenos">74</span></a>    <span class="nd">@deprecated_since</span><span class="p">(</span><span class="s2">&quot;1.0.0&quot;</span><span class="p">)</span>
</span><span id="Document-75"><a href="#Document-75"><span class="linenos">75</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="Document-76"><a href="#Document-76"><span class="linenos">76</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">token</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="p">]</span>
</span><span id="Document-77"><a href="#Document-77"><span class="linenos">77</span></a>
</span><span id="Document-78"><a href="#Document-78"><span class="linenos">78</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Document-79"><a href="#Document-79"><span class="linenos">79</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span>
</span><span id="Document-80"><a href="#Document-80"><span class="linenos">80</span></a>
</span><span id="Document-81"><a href="#Document-81"><span class="linenos">81</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Document-82"><a href="#Document-82"><span class="linenos">82</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="Document-83"><a href="#Document-83"><span class="linenos">83</span></a>            <span class="sa">f</span><span class="s2">&quot;Document(text=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="si">!r}</span><span class="s2">, is_rejected=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">is_rejected</span><span class="si">}</span><span class="s2">, extras=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">extras</span><span class="si">}</span><span class="s2">)&quot;</span>  <span class="c1"># noqa</span>
</span><span id="Document-84"><a href="#Document-84"><span class="linenos">84</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Document class represents a text document with metadata.
It contains the text of the document, a flag indicating whether it is rejected,
 and additional metadata stored in the <code>extras</code> dictionary.</p>

<p>The <code>tokens</code> attribute will be deprecated in future versions,
and users are encouraged to use the <code>extras</code> dictionary to store token-related information.</p>

<p>Attributes:
    text (str): The text content of the document.
    is_rejected (bool): A flag indicating whether the document is rejected.
    extras (Dict[str, Any]): A dictionary to store additional metadata about the document.
    reject_reason (Dict[str, Any]): A dictionary to store the reason for rejection. The
      filter class and the member name and value will logged at the filter is logged here.</p>

<p>Next attributes will be deprecated in future versions:
    tokens (List[Token]): A list of tokens extracted from the document.</p>
</div>


                            <div id="Document.__init__" class="classattr">
                                        <input id="Document.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Document</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">text</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">is_rejected</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">tokens</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n"><a href="#Token">hojichar.Token</a></span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">extras</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="Document.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Document.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Document.__init__-44"><a href="#Document.__init__-44"><span class="linenos">44</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="Document.__init__-45"><a href="#Document.__init__-45"><span class="linenos">45</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Document.__init__-46"><a href="#Document.__init__-46"><span class="linenos">46</span></a>        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Document.__init__-47"><a href="#Document.__init__-47"><span class="linenos">47</span></a>        <span class="n">is_rejected</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Document.__init__-48"><a href="#Document.__init__-48"><span class="linenos">48</span></a>        <span class="n">tokens</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Token</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Document.__init__-49"><a href="#Document.__init__-49"><span class="linenos">49</span></a>        <span class="n">extras</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Document.__init__-50"><a href="#Document.__init__-50"><span class="linenos">50</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Document.__init__-51"><a href="#Document.__init__-51"><span class="linenos">51</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
</span><span id="Document.__init__-52"><a href="#Document.__init__-52"><span class="linenos">52</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__original</span> <span class="o">=</span> <span class="n">text</span>
</span><span id="Document.__init__-53"><a href="#Document.__init__-53"><span class="linenos">53</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">is_rejected</span> <span class="o">=</span> <span class="n">is_rejected</span>
</span><span id="Document.__init__-54"><a href="#Document.__init__-54"><span class="linenos">54</span></a>        <span class="k">if</span> <span class="n">tokens</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Document.__init__-55"><a href="#Document.__init__-55"><span class="linenos">55</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Token</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Document.__init__-56"><a href="#Document.__init__-56"><span class="linenos">56</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Document.__init__-57"><a href="#Document.__init__-57"><span class="linenos">57</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span> <span class="o">=</span> <span class="n">tokens</span>
</span><span id="Document.__init__-58"><a href="#Document.__init__-58"><span class="linenos">58</span></a>
</span><span id="Document.__init__-59"><a href="#Document.__init__-59"><span class="linenos">59</span></a>        <span class="k">if</span> <span class="n">extras</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Document.__init__-60"><a href="#Document.__init__-60"><span class="linenos">60</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">extras</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Document.__init__-61"><a href="#Document.__init__-61"><span class="linenos">61</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Document.__init__-62"><a href="#Document.__init__-62"><span class="linenos">62</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">extras</span> <span class="o">=</span> <span class="n">extras</span>
</span><span id="Document.__init__-63"><a href="#Document.__init__-63"><span class="linenos">63</span></a>
</span><span id="Document.__init__-64"><a href="#Document.__init__-64"><span class="linenos">64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reject_reason</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span></pre></div>


    

                            </div>
                            <div id="Document.set_tokens" class="classattr">
                                        <input id="Document.set_tokens-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@deprecated_since(&#39;1.0.0&#39;)</div>

        <span class="def">def</span>
        <span class="name">set_tokens</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">tokens</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Document.set_tokens-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Document.set_tokens"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Document.set_tokens-70"><a href="#Document.set_tokens-70"><span class="linenos">70</span></a>    <span class="nd">@deprecated_since</span><span class="p">(</span><span class="s2">&quot;1.0.0&quot;</span><span class="p">)</span>
</span><span id="Document.set_tokens-71"><a href="#Document.set_tokens-71"><span class="linenos">71</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokens</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Document.set_tokens-72"><a href="#Document.set_tokens-72"><span class="linenos">72</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span> <span class="o">=</span> <span class="p">[</span><span class="n">Token</span><span class="p">(</span><span class="n">token</span><span class="p">)</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">]</span>
</span></pre></div>


    

                            </div>
                            <div id="Document.get_tokens" class="classattr">
                                        <input id="Document.get_tokens-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@deprecated_since(&#39;1.0.0&#39;)</div>

        <span class="def">def</span>
        <span class="name">get_tokens</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Document.get_tokens-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Document.get_tokens"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Document.get_tokens-74"><a href="#Document.get_tokens-74"><span class="linenos">74</span></a>    <span class="nd">@deprecated_since</span><span class="p">(</span><span class="s2">&quot;1.0.0&quot;</span><span class="p">)</span>
</span><span id="Document.get_tokens-75"><a href="#Document.get_tokens-75"><span class="linenos">75</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="Document.get_tokens-76"><a href="#Document.get_tokens-76"><span class="linenos">76</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">token</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="p">]</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="Token">
                            <input id="Token-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@deprecated_since(&#39;0.1.0&#39;, &#39;Document&#39;)</div>

    <span class="def">class</span>
    <span class="name">Token</span>:

                <label class="view-source-button" for="Token-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Token"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Token-9"><a href="#Token-9"><span class="linenos"> 9</span></a><span class="nd">@deprecated_since</span><span class="p">(</span><span class="s2">&quot;0.1.0&quot;</span><span class="p">,</span> <span class="s2">&quot;Document&quot;</span><span class="p">)</span>
</span><span id="Token-10"><a href="#Token-10"><span class="linenos">10</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Token</span><span class="p">:</span>
</span><span id="Token-11"><a href="#Token-11"><span class="linenos">11</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">is_rejected</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Token-12"><a href="#Token-12"><span class="linenos">12</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
</span><span id="Token-13"><a href="#Token-13"><span class="linenos">13</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__original</span> <span class="o">=</span> <span class="n">text</span>
</span><span id="Token-14"><a href="#Token-14"><span class="linenos">14</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">is_rejected</span> <span class="o">=</span> <span class="n">is_rejected</span>
</span><span id="Token-15"><a href="#Token-15"><span class="linenos">15</span></a>
</span><span id="Token-16"><a href="#Token-16"><span class="linenos">16</span></a>    <span class="nd">@property</span>
</span><span id="Token-17"><a href="#Token-17"><span class="linenos">17</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">original</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Token-18"><a href="#Token-18"><span class="linenos">18</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__original</span>
</span><span id="Token-19"><a href="#Token-19"><span class="linenos">19</span></a>
</span><span id="Token-20"><a href="#Token-20"><span class="linenos">20</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Token-21"><a href="#Token-21"><span class="linenos">21</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span>
</span></pre></div>


    

                            <div id="Token.__init__" class="classattr">
                                        <input id="Token.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Token</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">text</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">is_rejected</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="Token.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Token.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Token.__init__-11"><a href="#Token.__init__-11"><span class="linenos">11</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">is_rejected</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Token.__init__-12"><a href="#Token.__init__-12"><span class="linenos">12</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
</span><span id="Token.__init__-13"><a href="#Token.__init__-13"><span class="linenos">13</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__original</span> <span class="o">=</span> <span class="n">text</span>
</span><span id="Token.__init__-14"><a href="#Token.__init__-14"><span class="linenos">14</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">is_rejected</span> <span class="o">=</span> <span class="n">is_rejected</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="Parallel">
                            <input id="Parallel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Parallel</span>:

                <label class="view-source-button" for="Parallel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Parallel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Parallel-48"><a href="#Parallel-48"><span class="linenos"> 48</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Parallel</span><span class="p">:</span>
</span><span id="Parallel-49"><a href="#Parallel-49"><span class="linenos"> 49</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Parallel-50"><a href="#Parallel-50"><span class="linenos"> 50</span></a><span class="sd">    The Parallel class provides a way to apply a hojichar.Compose filter</span>
</span><span id="Parallel-51"><a href="#Parallel-51"><span class="linenos"> 51</span></a><span class="sd">    to an iterator of documents in a parallel manner using a specified</span>
</span><span id="Parallel-52"><a href="#Parallel-52"><span class="linenos"> 52</span></a><span class="sd">    number of worker processes. This class should be used as a context</span>
</span><span id="Parallel-53"><a href="#Parallel-53"><span class="linenos"> 53</span></a><span class="sd">    manager with a &#39;with&#39; statement.</span>
</span><span id="Parallel-54"><a href="#Parallel-54"><span class="linenos"> 54</span></a>
</span><span id="Parallel-55"><a href="#Parallel-55"><span class="linenos"> 55</span></a><span class="sd">    Example:</span>
</span><span id="Parallel-56"><a href="#Parallel-56"><span class="linenos"> 56</span></a>
</span><span id="Parallel-57"><a href="#Parallel-57"><span class="linenos"> 57</span></a><span class="sd">    doc_iter = (hojichar.Document(d) for d in open(&quot;my_text.txt&quot;))</span>
</span><span id="Parallel-58"><a href="#Parallel-58"><span class="linenos"> 58</span></a><span class="sd">    with Parallel(my_filter, num_jobs=8) as pfilter:</span>
</span><span id="Parallel-59"><a href="#Parallel-59"><span class="linenos"> 59</span></a><span class="sd">        for doc in pfilter.imap_apply(doc_iter):</span>
</span><span id="Parallel-60"><a href="#Parallel-60"><span class="linenos"> 60</span></a><span class="sd">            pass  # Process the filtered document as needed.</span>
</span><span id="Parallel-61"><a href="#Parallel-61"><span class="linenos"> 61</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Parallel-62"><a href="#Parallel-62"><span class="linenos"> 62</span></a>
</span><span id="Parallel-63"><a href="#Parallel-63"><span class="linenos"> 63</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="Parallel-64"><a href="#Parallel-64"><span class="linenos"> 64</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="n">hojichar</span><span class="o">.</span><span class="n">Compose</span><span class="p">,</span> <span class="n">num_jobs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Parallel-65"><a href="#Parallel-65"><span class="linenos"> 65</span></a>    <span class="p">):</span>
</span><span id="Parallel-66"><a href="#Parallel-66"><span class="linenos"> 66</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Parallel-67"><a href="#Parallel-67"><span class="linenos"> 67</span></a><span class="sd">        Initializes a new instance of the Parallel class.</span>
</span><span id="Parallel-68"><a href="#Parallel-68"><span class="linenos"> 68</span></a>
</span><span id="Parallel-69"><a href="#Parallel-69"><span class="linenos"> 69</span></a><span class="sd">        Args:</span>
</span><span id="Parallel-70"><a href="#Parallel-70"><span class="linenos"> 70</span></a><span class="sd">            filter (hojichar.Compose): A composed filter object that specifies the</span>
</span><span id="Parallel-71"><a href="#Parallel-71"><span class="linenos"> 71</span></a><span class="sd">                processing operations to apply to each document in parallel.</span>
</span><span id="Parallel-72"><a href="#Parallel-72"><span class="linenos"> 72</span></a><span class="sd">                A copy of the filter is made within a &#39;with&#39; statement. When the &#39;with&#39;</span>
</span><span id="Parallel-73"><a href="#Parallel-73"><span class="linenos"> 73</span></a><span class="sd">                block terminates,the statistical information obtained through `filter.statistics`</span>
</span><span id="Parallel-74"><a href="#Parallel-74"><span class="linenos"> 74</span></a><span class="sd">                or`filter.statistics_obj` is replaced with the total value of the statistical</span>
</span><span id="Parallel-75"><a href="#Parallel-75"><span class="linenos"> 75</span></a><span class="sd">                information processed within the &#39;with&#39; block.</span>
</span><span id="Parallel-76"><a href="#Parallel-76"><span class="linenos"> 76</span></a>
</span><span id="Parallel-77"><a href="#Parallel-77"><span class="linenos"> 77</span></a><span class="sd">            num_jobs (int | None, optional): The number of worker processes to use.</span>
</span><span id="Parallel-78"><a href="#Parallel-78"><span class="linenos"> 78</span></a><span class="sd">                If None, then the number returned by os.cpu_count() is used. Defaults to None.</span>
</span><span id="Parallel-79"><a href="#Parallel-79"><span class="linenos"> 79</span></a><span class="sd">            ignore_errors (bool, optional): If set to True, any exceptions thrown during</span>
</span><span id="Parallel-80"><a href="#Parallel-80"><span class="linenos"> 80</span></a><span class="sd">                the processing of a document will be caught and logged, but will not</span>
</span><span id="Parallel-81"><a href="#Parallel-81"><span class="linenos"> 81</span></a><span class="sd">                stop the processing of further documents. If set to False, the first</span>
</span><span id="Parallel-82"><a href="#Parallel-82"><span class="linenos"> 82</span></a><span class="sd">                exception thrown will terminate the entire parallel processing operation.</span>
</span><span id="Parallel-83"><a href="#Parallel-83"><span class="linenos"> 83</span></a><span class="sd">                Defaults to False.</span>
</span><span id="Parallel-84"><a href="#Parallel-84"><span class="linenos"> 84</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Parallel-85"><a href="#Parallel-85"><span class="linenos"> 85</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="nb">filter</span>
</span><span id="Parallel-86"><a href="#Parallel-86"><span class="linenos"> 86</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_jobs</span> <span class="o">=</span> <span class="n">num_jobs</span>
</span><span id="Parallel-87"><a href="#Parallel-87"><span class="linenos"> 87</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ignore_errors</span> <span class="o">=</span> <span class="n">ignore_errors</span>
</span><span id="Parallel-88"><a href="#Parallel-88"><span class="linenos"> 88</span></a>
</span><span id="Parallel-89"><a href="#Parallel-89"><span class="linenos"> 89</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pool</span><span class="p">:</span> <span class="n">Pool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Parallel-90"><a href="#Parallel-90"><span class="linenos"> 90</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pid_stats</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Statistics</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Parallel-91"><a href="#Parallel-91"><span class="linenos"> 91</span></a>
</span><span id="Parallel-92"><a href="#Parallel-92"><span class="linenos"> 92</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Parallel</span><span class="p">:</span>
</span><span id="Parallel-93"><a href="#Parallel-93"><span class="linenos"> 93</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pool</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span>
</span><span id="Parallel-94"><a href="#Parallel-94"><span class="linenos"> 94</span></a>            <span class="n">processes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_jobs</span><span class="p">,</span>
</span><span id="Parallel-95"><a href="#Parallel-95"><span class="linenos"> 95</span></a>            <span class="n">initializer</span><span class="o">=</span><span class="n">_init_worker</span><span class="p">,</span>
</span><span id="Parallel-96"><a href="#Parallel-96"><span class="linenos"> 96</span></a>            <span class="n">initargs</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore_errors</span><span class="p">),</span>
</span><span id="Parallel-97"><a href="#Parallel-97"><span class="linenos"> 97</span></a>        <span class="p">)</span>
</span><span id="Parallel-98"><a href="#Parallel-98"><span class="linenos"> 98</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pid_stats</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
</span><span id="Parallel-99"><a href="#Parallel-99"><span class="linenos"> 99</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="Parallel-100"><a href="#Parallel-100"><span class="linenos">100</span></a>
</span><span id="Parallel-101"><a href="#Parallel-101"><span class="linenos">101</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">imap_apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">:</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">hojichar</span><span class="o">.</span><span class="n">Document</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">hojichar</span><span class="o">.</span><span class="n">Document</span><span class="p">]:</span>
</span><span id="Parallel-102"><a href="#Parallel-102"><span class="linenos">102</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Parallel-103"><a href="#Parallel-103"><span class="linenos">103</span></a><span class="sd">        Takes an iterator of Documents and applies the Compose filter to</span>
</span><span id="Parallel-104"><a href="#Parallel-104"><span class="linenos">104</span></a><span class="sd">        each Document in a parallel manner. This is a generator method</span>
</span><span id="Parallel-105"><a href="#Parallel-105"><span class="linenos">105</span></a><span class="sd">        that yields processed Documents.</span>
</span><span id="Parallel-106"><a href="#Parallel-106"><span class="linenos">106</span></a>
</span><span id="Parallel-107"><a href="#Parallel-107"><span class="linenos">107</span></a><span class="sd">        Args:</span>
</span><span id="Parallel-108"><a href="#Parallel-108"><span class="linenos">108</span></a><span class="sd">            docs (Iterator[hojichar.Document]): An iterator of Documents to be processed.</span>
</span><span id="Parallel-109"><a href="#Parallel-109"><span class="linenos">109</span></a>
</span><span id="Parallel-110"><a href="#Parallel-110"><span class="linenos">110</span></a><span class="sd">        Raises:</span>
</span><span id="Parallel-111"><a href="#Parallel-111"><span class="linenos">111</span></a><span class="sd">            RuntimeError: If the Parallel instance is not properly initialized. This</span>
</span><span id="Parallel-112"><a href="#Parallel-112"><span class="linenos">112</span></a><span class="sd">                generally happens when the method is called outside of a &#39;with&#39; statement.</span>
</span><span id="Parallel-113"><a href="#Parallel-113"><span class="linenos">113</span></a><span class="sd">            Exception: If any exceptions are raised within the worker processes.</span>
</span><span id="Parallel-114"><a href="#Parallel-114"><span class="linenos">114</span></a>
</span><span id="Parallel-115"><a href="#Parallel-115"><span class="linenos">115</span></a><span class="sd">        Yields:</span>
</span><span id="Parallel-116"><a href="#Parallel-116"><span class="linenos">116</span></a><span class="sd">            Iterator[hojichar.Document]: An iterator that yields processed Documents.</span>
</span><span id="Parallel-117"><a href="#Parallel-117"><span class="linenos">117</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Parallel-118"><a href="#Parallel-118"><span class="linenos">118</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pool</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pid_stats</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Parallel-119"><a href="#Parallel-119"><span class="linenos">119</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="Parallel-120"><a href="#Parallel-120"><span class="linenos">120</span></a>                <span class="s2">&quot;Parallel instance not properly initialized. Use within a &#39;with&#39; statement.&quot;</span>
</span><span id="Parallel-121"><a href="#Parallel-121"><span class="linenos">121</span></a>            <span class="p">)</span>
</span><span id="Parallel-122"><a href="#Parallel-122"><span class="linenos">122</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Parallel-123"><a href="#Parallel-123"><span class="linenos">123</span></a>            <span class="k">for</span> <span class="n">doc</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">stat</span><span class="p">,</span> <span class="n">err_msg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pool</span><span class="o">.</span><span class="n">imap_unordered</span><span class="p">(</span><span class="n">_worker</span><span class="p">,</span> <span class="n">docs</span><span class="p">):</span>
</span><span id="Parallel-124"><a href="#Parallel-124"><span class="linenos">124</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_pid_stats</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span> <span class="o">=</span> <span class="n">stat</span>
</span><span id="Parallel-125"><a href="#Parallel-125"><span class="linenos">125</span></a>                <span class="k">if</span> <span class="n">err_msg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Parallel-126"><a href="#Parallel-126"><span class="linenos">126</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in worker </span><span class="si">{</span><span class="n">pid</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">err_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Parallel-127"><a href="#Parallel-127"><span class="linenos">127</span></a>                <span class="k">yield</span> <span class="n">doc</span>
</span><span id="Parallel-128"><a href="#Parallel-128"><span class="linenos">128</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="Parallel-129"><a href="#Parallel-129"><span class="linenos">129</span></a>            <span class="bp">self</span><span class="o">.</span><span class="fm">__exit__</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="Parallel-130"><a href="#Parallel-130"><span class="linenos">130</span></a>            <span class="k">raise</span>
</span><span id="Parallel-131"><a href="#Parallel-131"><span class="linenos">131</span></a>
</span><span id="Parallel-132"><a href="#Parallel-132"><span class="linenos">132</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
</span><span id="Parallel-133"><a href="#Parallel-133"><span class="linenos">133</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pool</span><span class="p">:</span>
</span><span id="Parallel-134"><a href="#Parallel-134"><span class="linenos">134</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_pool</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
</span><span id="Parallel-135"><a href="#Parallel-135"><span class="linenos">135</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_pool</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span><span id="Parallel-136"><a href="#Parallel-136"><span class="linenos">136</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pid_stats</span><span class="p">:</span>
</span><span id="Parallel-137"><a href="#Parallel-137"><span class="linenos">137</span></a>            <span class="n">total_stats</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span>
</span><span id="Parallel-138"><a href="#Parallel-138"><span class="linenos">138</span></a>                <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">Statistics</span><span class="o">.</span><span class="n">add_list_of_stats</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pid_stats</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span><span id="Parallel-139"><a href="#Parallel-139"><span class="linenos">139</span></a>            <span class="p">)</span>
</span><span id="Parallel-140"><a href="#Parallel-140"><span class="linenos">140</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">_statistics</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">Statistics</span><span class="o">.</span><span class="n">get_filter</span><span class="p">(</span><span class="s2">&quot;Total&quot;</span><span class="p">,</span> <span class="n">total_stats</span><span class="p">))</span>
</span><span id="Parallel-141"><a href="#Parallel-141"><span class="linenos">141</span></a>            <span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="n">total_stats</span><span class="p">:</span>
</span><span id="Parallel-142"><a href="#Parallel-142"><span class="linenos">142</span></a>                <span class="k">for</span> <span class="n">filt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">filters</span><span class="p">:</span>
</span><span id="Parallel-143"><a href="#Parallel-143"><span class="linenos">143</span></a>                    <span class="k">if</span> <span class="n">stat</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">filt</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span id="Parallel-144"><a href="#Parallel-144"><span class="linenos">144</span></a>                        <span class="n">filt</span><span class="o">.</span><span class="n">_statistics</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">stat</span><span class="p">)</span>
</span><span id="Parallel-145"><a href="#Parallel-145"><span class="linenos">145</span></a>                        <span class="k">break</span>
</span><span id="Parallel-146"><a href="#Parallel-146"><span class="linenos">146</span></a>
</span><span id="Parallel-147"><a href="#Parallel-147"><span class="linenos">147</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_total_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Statistics</span><span class="p">]:</span>
</span><span id="Parallel-148"><a href="#Parallel-148"><span class="linenos">148</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Parallel-149"><a href="#Parallel-149"><span class="linenos">149</span></a><span class="sd">        Returns a statistics object of the total statistical</span>
</span><span id="Parallel-150"><a href="#Parallel-150"><span class="linenos">150</span></a><span class="sd">        values processed within the Parallel block.</span>
</span><span id="Parallel-151"><a href="#Parallel-151"><span class="linenos">151</span></a>
</span><span id="Parallel-152"><a href="#Parallel-152"><span class="linenos">152</span></a><span class="sd">        Returns:</span>
</span><span id="Parallel-153"><a href="#Parallel-153"><span class="linenos">153</span></a><span class="sd">            StatsContainer: Statistics object</span>
</span><span id="Parallel-154"><a href="#Parallel-154"><span class="linenos">154</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Parallel-155"><a href="#Parallel-155"><span class="linenos">155</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pid_stats</span><span class="p">:</span>
</span><span id="Parallel-156"><a href="#Parallel-156"><span class="linenos">156</span></a>            <span class="n">total_stats</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span>
</span><span id="Parallel-157"><a href="#Parallel-157"><span class="linenos">157</span></a>                <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">Statistics</span><span class="o">.</span><span class="n">add_list_of_stats</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pid_stats</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span><span id="Parallel-158"><a href="#Parallel-158"><span class="linenos">158</span></a>            <span class="p">)</span>
</span><span id="Parallel-159"><a href="#Parallel-159"><span class="linenos">159</span></a>            <span class="k">return</span> <span class="n">total_stats</span>
</span><span id="Parallel-160"><a href="#Parallel-160"><span class="linenos">160</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Parallel-161"><a href="#Parallel-161"><span class="linenos">161</span></a>            <span class="k">return</span> <span class="p">[]</span>
</span><span id="Parallel-162"><a href="#Parallel-162"><span class="linenos">162</span></a>
</span><span id="Parallel-163"><a href="#Parallel-163"><span class="linenos">163</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_total_statistics_map</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="Parallel-164"><a href="#Parallel-164"><span class="linenos">164</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">stat</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_total_statistics</span><span class="p">()]</span>
</span><span id="Parallel-165"><a href="#Parallel-165"><span class="linenos">165</span></a>
</span><span id="Parallel-166"><a href="#Parallel-166"><span class="linenos">166</span></a>    <span class="nd">@property</span>
</span><span id="Parallel-167"><a href="#Parallel-167"><span class="linenos">167</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">statistics_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">inspection</span><span class="o">.</span><span class="n">StatsContainer</span><span class="p">:</span>
</span><span id="Parallel-168"><a href="#Parallel-168"><span class="linenos">168</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Parallel-169"><a href="#Parallel-169"><span class="linenos">169</span></a><span class="sd">        Returns the statistics object of the Parallel instance.</span>
</span><span id="Parallel-170"><a href="#Parallel-170"><span class="linenos">170</span></a><span class="sd">        This is a StatsContainer object which contains the statistics</span>
</span><span id="Parallel-171"><a href="#Parallel-171"><span class="linenos">171</span></a><span class="sd">        of the Parallel instance and sub filters.</span>
</span><span id="Parallel-172"><a href="#Parallel-172"><span class="linenos">172</span></a>
</span><span id="Parallel-173"><a href="#Parallel-173"><span class="linenos">173</span></a><span class="sd">        Returns:</span>
</span><span id="Parallel-174"><a href="#Parallel-174"><span class="linenos">174</span></a><span class="sd">            StatsContainer: Statistics object</span>
</span><span id="Parallel-175"><a href="#Parallel-175"><span class="linenos">175</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Parallel-176"><a href="#Parallel-176"><span class="linenos">176</span></a>        <span class="k">return</span> <span class="n">inspection</span><span class="o">.</span><span class="n">statistics_obj_adapter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_total_statistics</span><span class="p">())</span>  <span class="c1"># type: ignore</span>
</span></pre></div>


            <div class="docstring"><p>The Parallel class provides a way to apply a <a href="#Compose">hojichar.Compose</a> filter
to an iterator of documents in a parallel manner using a specified
number of worker processes. This class should be used as a context
manager with a 'with' statement.</p>

<p>Example:</p>

<p>doc_iter = (<a href="#Document">hojichar.Document</a>(d) for d in open("my_text.txt"))
with Parallel(my_filter, num_jobs=8) as pfilter:
    for doc in pfilter.imap_apply(doc_iter):
        pass  # Process the filtered document as needed.</p>
</div>


                            <div id="Parallel.__init__" class="classattr">
                                        <input id="Parallel.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Parallel</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="nb">filter</span><span class="p">:</span> <span class="n"><a href="#Compose">hojichar.Compose</a></span>,</span><span class="param">	<span class="n">num_jobs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">ignore_errors</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="Parallel.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Parallel.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Parallel.__init__-63"><a href="#Parallel.__init__-63"><span class="linenos">63</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="Parallel.__init__-64"><a href="#Parallel.__init__-64"><span class="linenos">64</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="n">hojichar</span><span class="o">.</span><span class="n">Compose</span><span class="p">,</span> <span class="n">num_jobs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Parallel.__init__-65"><a href="#Parallel.__init__-65"><span class="linenos">65</span></a>    <span class="p">):</span>
</span><span id="Parallel.__init__-66"><a href="#Parallel.__init__-66"><span class="linenos">66</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Parallel.__init__-67"><a href="#Parallel.__init__-67"><span class="linenos">67</span></a><span class="sd">        Initializes a new instance of the Parallel class.</span>
</span><span id="Parallel.__init__-68"><a href="#Parallel.__init__-68"><span class="linenos">68</span></a>
</span><span id="Parallel.__init__-69"><a href="#Parallel.__init__-69"><span class="linenos">69</span></a><span class="sd">        Args:</span>
</span><span id="Parallel.__init__-70"><a href="#Parallel.__init__-70"><span class="linenos">70</span></a><span class="sd">            filter (hojichar.Compose): A composed filter object that specifies the</span>
</span><span id="Parallel.__init__-71"><a href="#Parallel.__init__-71"><span class="linenos">71</span></a><span class="sd">                processing operations to apply to each document in parallel.</span>
</span><span id="Parallel.__init__-72"><a href="#Parallel.__init__-72"><span class="linenos">72</span></a><span class="sd">                A copy of the filter is made within a &#39;with&#39; statement. When the &#39;with&#39;</span>
</span><span id="Parallel.__init__-73"><a href="#Parallel.__init__-73"><span class="linenos">73</span></a><span class="sd">                block terminates,the statistical information obtained through `filter.statistics`</span>
</span><span id="Parallel.__init__-74"><a href="#Parallel.__init__-74"><span class="linenos">74</span></a><span class="sd">                or`filter.statistics_obj` is replaced with the total value of the statistical</span>
</span><span id="Parallel.__init__-75"><a href="#Parallel.__init__-75"><span class="linenos">75</span></a><span class="sd">                information processed within the &#39;with&#39; block.</span>
</span><span id="Parallel.__init__-76"><a href="#Parallel.__init__-76"><span class="linenos">76</span></a>
</span><span id="Parallel.__init__-77"><a href="#Parallel.__init__-77"><span class="linenos">77</span></a><span class="sd">            num_jobs (int | None, optional): The number of worker processes to use.</span>
</span><span id="Parallel.__init__-78"><a href="#Parallel.__init__-78"><span class="linenos">78</span></a><span class="sd">                If None, then the number returned by os.cpu_count() is used. Defaults to None.</span>
</span><span id="Parallel.__init__-79"><a href="#Parallel.__init__-79"><span class="linenos">79</span></a><span class="sd">            ignore_errors (bool, optional): If set to True, any exceptions thrown during</span>
</span><span id="Parallel.__init__-80"><a href="#Parallel.__init__-80"><span class="linenos">80</span></a><span class="sd">                the processing of a document will be caught and logged, but will not</span>
</span><span id="Parallel.__init__-81"><a href="#Parallel.__init__-81"><span class="linenos">81</span></a><span class="sd">                stop the processing of further documents. If set to False, the first</span>
</span><span id="Parallel.__init__-82"><a href="#Parallel.__init__-82"><span class="linenos">82</span></a><span class="sd">                exception thrown will terminate the entire parallel processing operation.</span>
</span><span id="Parallel.__init__-83"><a href="#Parallel.__init__-83"><span class="linenos">83</span></a><span class="sd">                Defaults to False.</span>
</span><span id="Parallel.__init__-84"><a href="#Parallel.__init__-84"><span class="linenos">84</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Parallel.__init__-85"><a href="#Parallel.__init__-85"><span class="linenos">85</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="nb">filter</span>
</span><span id="Parallel.__init__-86"><a href="#Parallel.__init__-86"><span class="linenos">86</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_jobs</span> <span class="o">=</span> <span class="n">num_jobs</span>
</span><span id="Parallel.__init__-87"><a href="#Parallel.__init__-87"><span class="linenos">87</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ignore_errors</span> <span class="o">=</span> <span class="n">ignore_errors</span>
</span><span id="Parallel.__init__-88"><a href="#Parallel.__init__-88"><span class="linenos">88</span></a>
</span><span id="Parallel.__init__-89"><a href="#Parallel.__init__-89"><span class="linenos">89</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pool</span><span class="p">:</span> <span class="n">Pool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Parallel.__init__-90"><a href="#Parallel.__init__-90"><span class="linenos">90</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pid_stats</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Statistics</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Initializes a new instance of the Parallel class.</p>

<p>Args:
    filter (<a href="#Compose">hojichar.Compose</a>): A composed filter object that specifies the
        processing operations to apply to each document in parallel.
        A copy of the filter is made within a 'with' statement. When the 'with'
        block terminates,the statistical information obtained through <code>filter.statistics</code>
        or<code>filter.statistics_obj</code> is replaced with the total value of the statistical
        information processed within the 'with' block.</p>

<pre><code>num_jobs (int | None, optional): The number of worker processes to use.
    If None, then the number returned by os.cpu_count() is used. Defaults to None.
ignore_errors (bool, optional): If set to True, any exceptions thrown during
    the processing of a document will be caught and logged, but will not
    stop the processing of further documents. If set to False, the first
    exception thrown will terminate the entire parallel processing operation.
    Defaults to False.
</code></pre>
</div>


                            </div>
                            <div id="Parallel.imap_apply" class="classattr">
                                        <input id="Parallel.imap_apply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">imap_apply</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">docs</span><span class="p">:</span> <span class="n">Iterator</span><span class="p">[</span><span class="n"><a href="#Document">hojichar.Document</a></span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">Iterator</span><span class="p">[</span><span class="n"><a href="#Document">hojichar.Document</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Parallel.imap_apply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Parallel.imap_apply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Parallel.imap_apply-101"><a href="#Parallel.imap_apply-101"><span class="linenos">101</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">imap_apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">:</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">hojichar</span><span class="o">.</span><span class="n">Document</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">hojichar</span><span class="o">.</span><span class="n">Document</span><span class="p">]:</span>
</span><span id="Parallel.imap_apply-102"><a href="#Parallel.imap_apply-102"><span class="linenos">102</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Parallel.imap_apply-103"><a href="#Parallel.imap_apply-103"><span class="linenos">103</span></a><span class="sd">        Takes an iterator of Documents and applies the Compose filter to</span>
</span><span id="Parallel.imap_apply-104"><a href="#Parallel.imap_apply-104"><span class="linenos">104</span></a><span class="sd">        each Document in a parallel manner. This is a generator method</span>
</span><span id="Parallel.imap_apply-105"><a href="#Parallel.imap_apply-105"><span class="linenos">105</span></a><span class="sd">        that yields processed Documents.</span>
</span><span id="Parallel.imap_apply-106"><a href="#Parallel.imap_apply-106"><span class="linenos">106</span></a>
</span><span id="Parallel.imap_apply-107"><a href="#Parallel.imap_apply-107"><span class="linenos">107</span></a><span class="sd">        Args:</span>
</span><span id="Parallel.imap_apply-108"><a href="#Parallel.imap_apply-108"><span class="linenos">108</span></a><span class="sd">            docs (Iterator[hojichar.Document]): An iterator of Documents to be processed.</span>
</span><span id="Parallel.imap_apply-109"><a href="#Parallel.imap_apply-109"><span class="linenos">109</span></a>
</span><span id="Parallel.imap_apply-110"><a href="#Parallel.imap_apply-110"><span class="linenos">110</span></a><span class="sd">        Raises:</span>
</span><span id="Parallel.imap_apply-111"><a href="#Parallel.imap_apply-111"><span class="linenos">111</span></a><span class="sd">            RuntimeError: If the Parallel instance is not properly initialized. This</span>
</span><span id="Parallel.imap_apply-112"><a href="#Parallel.imap_apply-112"><span class="linenos">112</span></a><span class="sd">                generally happens when the method is called outside of a &#39;with&#39; statement.</span>
</span><span id="Parallel.imap_apply-113"><a href="#Parallel.imap_apply-113"><span class="linenos">113</span></a><span class="sd">            Exception: If any exceptions are raised within the worker processes.</span>
</span><span id="Parallel.imap_apply-114"><a href="#Parallel.imap_apply-114"><span class="linenos">114</span></a>
</span><span id="Parallel.imap_apply-115"><a href="#Parallel.imap_apply-115"><span class="linenos">115</span></a><span class="sd">        Yields:</span>
</span><span id="Parallel.imap_apply-116"><a href="#Parallel.imap_apply-116"><span class="linenos">116</span></a><span class="sd">            Iterator[hojichar.Document]: An iterator that yields processed Documents.</span>
</span><span id="Parallel.imap_apply-117"><a href="#Parallel.imap_apply-117"><span class="linenos">117</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Parallel.imap_apply-118"><a href="#Parallel.imap_apply-118"><span class="linenos">118</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pool</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pid_stats</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Parallel.imap_apply-119"><a href="#Parallel.imap_apply-119"><span class="linenos">119</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="Parallel.imap_apply-120"><a href="#Parallel.imap_apply-120"><span class="linenos">120</span></a>                <span class="s2">&quot;Parallel instance not properly initialized. Use within a &#39;with&#39; statement.&quot;</span>
</span><span id="Parallel.imap_apply-121"><a href="#Parallel.imap_apply-121"><span class="linenos">121</span></a>            <span class="p">)</span>
</span><span id="Parallel.imap_apply-122"><a href="#Parallel.imap_apply-122"><span class="linenos">122</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Parallel.imap_apply-123"><a href="#Parallel.imap_apply-123"><span class="linenos">123</span></a>            <span class="k">for</span> <span class="n">doc</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">stat</span><span class="p">,</span> <span class="n">err_msg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pool</span><span class="o">.</span><span class="n">imap_unordered</span><span class="p">(</span><span class="n">_worker</span><span class="p">,</span> <span class="n">docs</span><span class="p">):</span>
</span><span id="Parallel.imap_apply-124"><a href="#Parallel.imap_apply-124"><span class="linenos">124</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_pid_stats</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span> <span class="o">=</span> <span class="n">stat</span>
</span><span id="Parallel.imap_apply-125"><a href="#Parallel.imap_apply-125"><span class="linenos">125</span></a>                <span class="k">if</span> <span class="n">err_msg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Parallel.imap_apply-126"><a href="#Parallel.imap_apply-126"><span class="linenos">126</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in worker </span><span class="si">{</span><span class="n">pid</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">err_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Parallel.imap_apply-127"><a href="#Parallel.imap_apply-127"><span class="linenos">127</span></a>                <span class="k">yield</span> <span class="n">doc</span>
</span><span id="Parallel.imap_apply-128"><a href="#Parallel.imap_apply-128"><span class="linenos">128</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="Parallel.imap_apply-129"><a href="#Parallel.imap_apply-129"><span class="linenos">129</span></a>            <span class="bp">self</span><span class="o">.</span><span class="fm">__exit__</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="Parallel.imap_apply-130"><a href="#Parallel.imap_apply-130"><span class="linenos">130</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>Takes an iterator of Documents and applies the Compose filter to
each Document in a parallel manner. This is a generator method
that yields processed Documents.</p>

<p>Args:
    docs (Iterator[<a href="#Document">hojichar.Document</a>]): An iterator of Documents to be processed.</p>

<p>Raises:
    RuntimeError: If the Parallel instance is not properly initialized. This
        generally happens when the method is called outside of a 'with' statement.
    Exception: If any exceptions are raised within the worker processes.</p>

<p>Yields:
    Iterator[<a href="#Document">hojichar.Document</a>]: An iterator that yields processed Documents.</p>
</div>


                            </div>
                            <div id="Parallel.get_total_statistics" class="classattr">
                                        <input id="Parallel.get_total_statistics-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_total_statistics</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="n"><a href="hojichar/core/models.html#Statistics">hojichar.core.models.Statistics</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Parallel.get_total_statistics-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Parallel.get_total_statistics"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Parallel.get_total_statistics-147"><a href="#Parallel.get_total_statistics-147"><span class="linenos">147</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_total_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Statistics</span><span class="p">]:</span>
</span><span id="Parallel.get_total_statistics-148"><a href="#Parallel.get_total_statistics-148"><span class="linenos">148</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Parallel.get_total_statistics-149"><a href="#Parallel.get_total_statistics-149"><span class="linenos">149</span></a><span class="sd">        Returns a statistics object of the total statistical</span>
</span><span id="Parallel.get_total_statistics-150"><a href="#Parallel.get_total_statistics-150"><span class="linenos">150</span></a><span class="sd">        values processed within the Parallel block.</span>
</span><span id="Parallel.get_total_statistics-151"><a href="#Parallel.get_total_statistics-151"><span class="linenos">151</span></a>
</span><span id="Parallel.get_total_statistics-152"><a href="#Parallel.get_total_statistics-152"><span class="linenos">152</span></a><span class="sd">        Returns:</span>
</span><span id="Parallel.get_total_statistics-153"><a href="#Parallel.get_total_statistics-153"><span class="linenos">153</span></a><span class="sd">            StatsContainer: Statistics object</span>
</span><span id="Parallel.get_total_statistics-154"><a href="#Parallel.get_total_statistics-154"><span class="linenos">154</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Parallel.get_total_statistics-155"><a href="#Parallel.get_total_statistics-155"><span class="linenos">155</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pid_stats</span><span class="p">:</span>
</span><span id="Parallel.get_total_statistics-156"><a href="#Parallel.get_total_statistics-156"><span class="linenos">156</span></a>            <span class="n">total_stats</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span>
</span><span id="Parallel.get_total_statistics-157"><a href="#Parallel.get_total_statistics-157"><span class="linenos">157</span></a>                <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">Statistics</span><span class="o">.</span><span class="n">add_list_of_stats</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pid_stats</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span><span id="Parallel.get_total_statistics-158"><a href="#Parallel.get_total_statistics-158"><span class="linenos">158</span></a>            <span class="p">)</span>
</span><span id="Parallel.get_total_statistics-159"><a href="#Parallel.get_total_statistics-159"><span class="linenos">159</span></a>            <span class="k">return</span> <span class="n">total_stats</span>
</span><span id="Parallel.get_total_statistics-160"><a href="#Parallel.get_total_statistics-160"><span class="linenos">160</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Parallel.get_total_statistics-161"><a href="#Parallel.get_total_statistics-161"><span class="linenos">161</span></a>            <span class="k">return</span> <span class="p">[]</span>
</span></pre></div>


            <div class="docstring"><p>Returns a statistics object of the total statistical
values processed within the Parallel block.</p>

<p>Returns:
    StatsContainer: Statistics object</p>
</div>


                            </div>
                            <div id="Parallel.get_total_statistics_map" class="classattr">
                                        <input id="Parallel.get_total_statistics_map-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_total_statistics_map</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Parallel.get_total_statistics_map-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Parallel.get_total_statistics_map"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Parallel.get_total_statistics_map-163"><a href="#Parallel.get_total_statistics_map-163"><span class="linenos">163</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_total_statistics_map</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="Parallel.get_total_statistics_map-164"><a href="#Parallel.get_total_statistics_map-164"><span class="linenos">164</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">stat</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_total_statistics</span><span class="p">()]</span>
</span></pre></div>


    

                            </div>
                            <div id="Parallel.statistics_obj" class="classattr">
                                <div class="attr variable">
            <span class="name">statistics_obj</span><span class="annotation">: <a href="#StatsContainer">hojichar.StatsContainer</a></span>

        
    </div>
    <a class="headerlink" href="#Parallel.statistics_obj"></a>
    
            <div class="docstring"><p>Returns the statistics object of the Parallel instance.
This is a StatsContainer object which contains the statistics
of the Parallel instance and sub filters.</p>

<p>Returns:
    StatsContainer: Statistics object</p>
</div>


                            </div>
                </section>
                <section id="StatsContainer">
                            <input id="StatsContainer-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclasses.dataclass</div>

    <span class="def">class</span>
    <span class="name">StatsContainer</span>:

                <label class="view-source-button" for="StatsContainer-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StatsContainer"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StatsContainer-116"><a href="#StatsContainer-116"><span class="linenos">116</span></a><span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
</span><span id="StatsContainer-117"><a href="#StatsContainer-117"><span class="linenos">117</span></a><span class="k">class</span><span class="w"> </span><span class="nc">StatsContainer</span><span class="p">:</span>
</span><span id="StatsContainer-118"><a href="#StatsContainer-118"><span class="linenos">118</span></a>    <span class="n">total_info</span><span class="p">:</span> <span class="n">DocStatistics</span>
</span><span id="StatsContainer-119"><a href="#StatsContainer-119"><span class="linenos">119</span></a>    <span class="n">layers_info</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">FilterStatistics</span><span class="p">]</span>  <span class="c1"># Key of the dict is filter name.</span>
</span><span id="StatsContainer-120"><a href="#StatsContainer-120"><span class="linenos">120</span></a>
</span><span id="StatsContainer-121"><a href="#StatsContainer-121"><span class="linenos">121</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">StatsContainer</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StatsContainer</span><span class="p">:</span>
</span><span id="StatsContainer-122"><a href="#StatsContainer-122"><span class="linenos">122</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers_info</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">layers_info</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="s2">&quot;Layer names must match&quot;</span>
</span><span id="StatsContainer-123"><a href="#StatsContainer-123"><span class="linenos">123</span></a>        <span class="k">return</span> <span class="n">StatsContainer</span><span class="p">(</span>
</span><span id="StatsContainer-124"><a href="#StatsContainer-124"><span class="linenos">124</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">total_info</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">total_info</span><span class="p">,</span>
</span><span id="StatsContainer-125"><a href="#StatsContainer-125"><span class="linenos">125</span></a>            <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">layers_info</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers_info</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
</span><span id="StatsContainer-126"><a href="#StatsContainer-126"><span class="linenos">126</span></a>        <span class="p">)</span>
</span><span id="StatsContainer-127"><a href="#StatsContainer-127"><span class="linenos">127</span></a>
</span><span id="StatsContainer-128"><a href="#StatsContainer-128"><span class="linenos">128</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_human_readable_values</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="StatsContainer-129"><a href="#StatsContainer-129"><span class="linenos">129</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="StatsContainer-130"><a href="#StatsContainer-130"><span class="linenos">130</span></a>            <span class="s2">&quot;total_info&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_info</span><span class="o">.</span><span class="n">get_human_readable_values</span><span class="p">(),</span>
</span><span id="StatsContainer-131"><a href="#StatsContainer-131"><span class="linenos">131</span></a>            <span class="s2">&quot;layers_info&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="StatsContainer-132"><a href="#StatsContainer-132"><span class="linenos">132</span></a>                <span class="n">layer</span><span class="o">.</span><span class="n">get_human_readable_values</span><span class="p">()</span> <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers_info</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span><span id="StatsContainer-133"><a href="#StatsContainer-133"><span class="linenos">133</span></a>            <span class="p">],</span>
</span><span id="StatsContainer-134"><a href="#StatsContainer-134"><span class="linenos">134</span></a>        <span class="p">}</span>
</span><span id="StatsContainer-135"><a href="#StatsContainer-135"><span class="linenos">135</span></a>
</span><span id="StatsContainer-136"><a href="#StatsContainer-136"><span class="linenos">136</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StatsContainer</span><span class="p">:</span>
</span><span id="StatsContainer-137"><a href="#StatsContainer-137"><span class="linenos">137</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">total_info</span><span class="o">.</span><span class="n">reset</span>
</span><span id="StatsContainer-138"><a href="#StatsContainer-138"><span class="linenos">138</span></a>        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers_info</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="StatsContainer-139"><a href="#StatsContainer-139"><span class="linenos">139</span></a>            <span class="n">layer</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span><span id="StatsContainer-140"><a href="#StatsContainer-140"><span class="linenos">140</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span></pre></div>


    

                            <div id="StatsContainer.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">StatsContainer</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">total_info</span><span class="p">:</span> <span class="n"><a href="hojichar/core/inspection.html#DocStatistics">hojichar.core.inspection.DocStatistics</a></span>,</span><span class="param">	<span class="n">layers_info</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><a href="hojichar/core/inspection.html#FilterStatistics">hojichar.core.inspection.FilterStatistics</a></span><span class="p">]</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#StatsContainer.__init__"></a>
    
    

                            </div>
                            <div id="StatsContainer.get_human_readable_values" class="classattr">
                                        <input id="StatsContainer.get_human_readable_values-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_human_readable_values</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="StatsContainer.get_human_readable_values-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StatsContainer.get_human_readable_values"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StatsContainer.get_human_readable_values-128"><a href="#StatsContainer.get_human_readable_values-128"><span class="linenos">128</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_human_readable_values</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="StatsContainer.get_human_readable_values-129"><a href="#StatsContainer.get_human_readable_values-129"><span class="linenos">129</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="StatsContainer.get_human_readable_values-130"><a href="#StatsContainer.get_human_readable_values-130"><span class="linenos">130</span></a>            <span class="s2">&quot;total_info&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_info</span><span class="o">.</span><span class="n">get_human_readable_values</span><span class="p">(),</span>
</span><span id="StatsContainer.get_human_readable_values-131"><a href="#StatsContainer.get_human_readable_values-131"><span class="linenos">131</span></a>            <span class="s2">&quot;layers_info&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="StatsContainer.get_human_readable_values-132"><a href="#StatsContainer.get_human_readable_values-132"><span class="linenos">132</span></a>                <span class="n">layer</span><span class="o">.</span><span class="n">get_human_readable_values</span><span class="p">()</span> <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers_info</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span><span id="StatsContainer.get_human_readable_values-133"><a href="#StatsContainer.get_human_readable_values-133"><span class="linenos">133</span></a>            <span class="p">],</span>
</span><span id="StatsContainer.get_human_readable_values-134"><a href="#StatsContainer.get_human_readable_values-134"><span class="linenos">134</span></a>        <span class="p">}</span>
</span></pre></div>


    

                            </div>
                            <div id="StatsContainer.reset" class="classattr">
                                        <input id="StatsContainer.reset-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reset</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#StatsContainer">hojichar.StatsContainer</a></span>:</span></span>

                <label class="view-source-button" for="StatsContainer.reset-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StatsContainer.reset"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StatsContainer.reset-136"><a href="#StatsContainer.reset-136"><span class="linenos">136</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StatsContainer</span><span class="p">:</span>
</span><span id="StatsContainer.reset-137"><a href="#StatsContainer.reset-137"><span class="linenos">137</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">total_info</span><span class="o">.</span><span class="n">reset</span>
</span><span id="StatsContainer.reset-138"><a href="#StatsContainer.reset-138"><span class="linenos">138</span></a>        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers_info</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="StatsContainer.reset-139"><a href="#StatsContainer.reset-139"><span class="linenos">139</span></a>            <span class="n">layer</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span><span id="StatsContainer.reset-140"><a href="#StatsContainer.reset-140"><span class="linenos">140</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="AsyncCompose">
                            <input id="AsyncCompose-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">AsyncCompose</span><wbr>(<span class="base"><a href="#AsyncFilter">hojichar.AsyncFilter</a></span>):

                <label class="view-source-button" for="AsyncCompose-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AsyncCompose"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AsyncCompose-73"><a href="#AsyncCompose-73"><span class="linenos"> 73</span></a><span class="k">class</span><span class="w"> </span><span class="nc">AsyncCompose</span><span class="p">(</span><span class="n">AsyncFilter</span><span class="p">):</span>
</span><span id="AsyncCompose-74"><a href="#AsyncCompose-74"><span class="linenos"> 74</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="AsyncCompose-75"><a href="#AsyncCompose-75"><span class="linenos"> 75</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="AsyncCompose-76"><a href="#AsyncCompose-76"><span class="linenos"> 76</span></a>        <span class="n">filters</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">AsyncFilter</span> <span class="o">|</span> <span class="n">Filter</span><span class="p">],</span>
</span><span id="AsyncCompose-77"><a href="#AsyncCompose-77"><span class="linenos"> 77</span></a>        <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">Generator</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AsyncCompose-78"><a href="#AsyncCompose-78"><span class="linenos"> 78</span></a>        <span class="n">executor</span><span class="p">:</span> <span class="n">ThreadPoolExecutor</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AsyncCompose-79"><a href="#AsyncCompose-79"><span class="linenos"> 79</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="AsyncCompose-80"><a href="#AsyncCompose-80"><span class="linenos"> 80</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="AsyncCompose-81"><a href="#AsyncCompose-81"><span class="linenos"> 81</span></a>    <span class="p">):</span>
</span><span id="AsyncCompose-82"><a href="#AsyncCompose-82"><span class="linenos"> 82</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="AsyncCompose-83"><a href="#AsyncCompose-83"><span class="linenos"> 83</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__module__</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AsyncCompose-84"><a href="#AsyncCompose-84"><span class="linenos"> 84</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_statistics</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Total&quot;</span>
</span><span id="AsyncCompose-85"><a href="#AsyncCompose-85"><span class="linenos"> 85</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_has_external_executor</span> <span class="o">=</span> <span class="n">executor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="AsyncCompose-86"><a href="#AsyncCompose-86"><span class="linenos"> 86</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span> <span class="o">=</span> <span class="n">executor</span> <span class="ow">or</span> <span class="n">ThreadPoolExecutor</span><span class="p">()</span>
</span><span id="AsyncCompose-87"><a href="#AsyncCompose-87"><span class="linenos"> 87</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_filters</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
</span><span id="AsyncCompose-88"><a href="#AsyncCompose-88"><span class="linenos"> 88</span></a>
</span><span id="AsyncCompose-89"><a href="#AsyncCompose-89"><span class="linenos"> 89</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">AsyncFilter</span> <span class="o">|</span> <span class="n">Filter</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AsyncCompose-90"><a href="#AsyncCompose-90"><span class="linenos"> 90</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">AsyncFilter</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AsyncCompose-91"><a href="#AsyncCompose-91"><span class="linenos"> 91</span></a>        <span class="n">filter_idx</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="AsyncCompose-92"><a href="#AsyncCompose-92"><span class="linenos"> 92</span></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">:</span>
</span><span id="AsyncCompose-93"><a href="#AsyncCompose-93"><span class="linenos"> 93</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">AsyncCompose</span><span class="p">,</span> <span class="n">Compose</span><span class="p">)):</span>
</span><span id="AsyncCompose-94"><a href="#AsyncCompose-94"><span class="linenos"> 94</span></a>                <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">filters</span><span class="p">:</span>
</span><span id="AsyncCompose-95"><a href="#AsyncCompose-95"><span class="linenos"> 95</span></a>                    <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filter_idx</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">sub</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AsyncCompose-96"><a href="#AsyncCompose-96"><span class="linenos"> 96</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">Filter</span><span class="p">):</span>
</span><span id="AsyncCompose-97"><a href="#AsyncCompose-97"><span class="linenos"> 97</span></a>                        <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filter_idx</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">sub</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AsyncCompose-98"><a href="#AsyncCompose-98"><span class="linenos"> 98</span></a>                        <span class="n">sub</span> <span class="o">=</span> <span class="n">AsyncFilterAdapter</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">executor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_executor</span><span class="p">)</span>
</span><span id="AsyncCompose-99"><a href="#AsyncCompose-99"><span class="linenos"> 99</span></a>
</span><span id="AsyncCompose-100"><a href="#AsyncCompose-100"><span class="linenos">100</span></a>                    <span class="n">sub</span><span class="o">.</span><span class="n">_set_rng_if_not_initialized</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rng</span><span class="p">)</span>
</span><span id="AsyncCompose-101"><a href="#AsyncCompose-101"><span class="linenos">101</span></a>                    <span class="n">sub</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="AsyncCompose-102"><a href="#AsyncCompose-102"><span class="linenos">102</span></a>                    <span class="n">sub</span><span class="o">.</span><span class="n">_statistics</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="AsyncCompose-103"><a href="#AsyncCompose-103"><span class="linenos">103</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span>
</span><span id="AsyncCompose-104"><a href="#AsyncCompose-104"><span class="linenos">104</span></a>                    <span class="n">filter_idx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="AsyncCompose-105"><a href="#AsyncCompose-105"><span class="linenos">105</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="AsyncCompose-106"><a href="#AsyncCompose-106"><span class="linenos">106</span></a>                <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filter_idx</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AsyncCompose-107"><a href="#AsyncCompose-107"><span class="linenos">107</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">Filter</span><span class="p">):</span>
</span><span id="AsyncCompose-108"><a href="#AsyncCompose-108"><span class="linenos">108</span></a>                    <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filter_idx</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AsyncCompose-109"><a href="#AsyncCompose-109"><span class="linenos">109</span></a>                    <span class="n">f</span> <span class="o">=</span> <span class="n">AsyncFilterAdapter</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">executor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_executor</span><span class="p">)</span>
</span><span id="AsyncCompose-110"><a href="#AsyncCompose-110"><span class="linenos">110</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">_set_rng_if_not_initialized</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rng</span><span class="p">)</span>
</span><span id="AsyncCompose-111"><a href="#AsyncCompose-111"><span class="linenos">111</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="AsyncCompose-112"><a href="#AsyncCompose-112"><span class="linenos">112</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">_statistics</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="AsyncCompose-113"><a href="#AsyncCompose-113"><span class="linenos">113</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="AsyncCompose-114"><a href="#AsyncCompose-114"><span class="linenos">114</span></a>                <span class="n">filter_idx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="AsyncCompose-115"><a href="#AsyncCompose-115"><span class="linenos">115</span></a>
</span><span id="AsyncCompose-116"><a href="#AsyncCompose-116"><span class="linenos">116</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Document</span><span class="p">:</span>
</span><span id="AsyncCompose-117"><a href="#AsyncCompose-117"><span class="linenos">117</span></a>        <span class="n">stat</span> <span class="o">=</span> <span class="n">get_doc_info</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="AsyncCompose-118"><a href="#AsyncCompose-118"><span class="linenos">118</span></a>        <span class="k">for</span> <span class="n">filter_idx</span><span class="p">,</span> <span class="n">filt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">):</span>
</span><span id="AsyncCompose-119"><a href="#AsyncCompose-119"><span class="linenos">119</span></a>            <span class="n">document</span> <span class="o">=</span> <span class="k">await</span> <span class="n">filt</span><span class="o">.</span><span class="n">_apply</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="AsyncCompose-120"><a href="#AsyncCompose-120"><span class="linenos">120</span></a>        <span class="n">new_stat</span> <span class="o">=</span> <span class="n">get_doc_info</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="AsyncCompose-121"><a href="#AsyncCompose-121"><span class="linenos">121</span></a>        <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stats_lock</span><span class="p">:</span>
</span><span id="AsyncCompose-122"><a href="#AsyncCompose-122"><span class="linenos">122</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_statistics</span><span class="o">.</span><span class="n">update_by_diff</span><span class="p">(</span><span class="n">stat</span><span class="p">,</span> <span class="n">new_stat</span><span class="p">)</span>
</span><span id="AsyncCompose-123"><a href="#AsyncCompose-123"><span class="linenos">123</span></a>        <span class="k">return</span> <span class="n">document</span>
</span><span id="AsyncCompose-124"><a href="#AsyncCompose-124"><span class="linenos">124</span></a>
</span><span id="AsyncCompose-125"><a href="#AsyncCompose-125"><span class="linenos">125</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">apply_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Document</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Document</span><span class="p">]:</span>
</span><span id="AsyncCompose-126"><a href="#AsyncCompose-126"><span class="linenos">126</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_doc_info</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">]</span>
</span><span id="AsyncCompose-127"><a href="#AsyncCompose-127"><span class="linenos">127</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">filt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">):</span>
</span><span id="AsyncCompose-128"><a href="#AsyncCompose-128"><span class="linenos">128</span></a>            <span class="n">batch</span> <span class="o">=</span> <span class="k">await</span> <span class="n">filt</span><span class="o">.</span><span class="n">_apply_batch</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
</span><span id="AsyncCompose-129"><a href="#AsyncCompose-129"><span class="linenos">129</span></a>        <span class="n">batch</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finalize_batch</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">stats</span><span class="p">)</span>
</span><span id="AsyncCompose-130"><a href="#AsyncCompose-130"><span class="linenos">130</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
</span><span id="AsyncCompose-131"><a href="#AsyncCompose-131"><span class="linenos">131</span></a>
</span><span id="AsyncCompose-132"><a href="#AsyncCompose-132"><span class="linenos">132</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">apply_stream</span><span class="p">(</span>
</span><span id="AsyncCompose-133"><a href="#AsyncCompose-133"><span class="linenos">133</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="AsyncCompose-134"><a href="#AsyncCompose-134"><span class="linenos">134</span></a>        <span class="n">stream</span><span class="p">:</span> <span class="n">AsyncIterable</span><span class="p">[</span><span class="n">Document</span><span class="p">]</span> <span class="o">|</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Document</span><span class="p">],</span>
</span><span id="AsyncCompose-135"><a href="#AsyncCompose-135"><span class="linenos">135</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncGenerator</span><span class="p">[</span><span class="n">Document</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
</span><span id="AsyncCompose-136"><a href="#AsyncCompose-136"><span class="linenos">136</span></a>        <span class="n">async_stream</span> <span class="o">=</span> <span class="n">handle_stream_as_async</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">executor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_executor</span><span class="p">)</span>
</span><span id="AsyncCompose-137"><a href="#AsyncCompose-137"><span class="linenos">137</span></a>        <span class="n">async_stream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_input_stats</span><span class="p">(</span><span class="n">async_stream</span><span class="p">)</span>
</span><span id="AsyncCompose-138"><a href="#AsyncCompose-138"><span class="linenos">138</span></a>
</span><span id="AsyncCompose-139"><a href="#AsyncCompose-139"><span class="linenos">139</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">filt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">):</span>
</span><span id="AsyncCompose-140"><a href="#AsyncCompose-140"><span class="linenos">140</span></a>            <span class="n">async_stream</span> <span class="o">=</span> <span class="n">filt</span><span class="o">.</span><span class="n">apply_stream</span><span class="p">(</span><span class="n">async_stream</span><span class="p">)</span>
</span><span id="AsyncCompose-141"><a href="#AsyncCompose-141"><span class="linenos">141</span></a>
</span><span id="AsyncCompose-142"><a href="#AsyncCompose-142"><span class="linenos">142</span></a>        <span class="k">async</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">async_stream</span><span class="p">:</span>
</span><span id="AsyncCompose-143"><a href="#AsyncCompose-143"><span class="linenos">143</span></a>            <span class="n">in_stat</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">extras</span><span class="p">[</span><span class="s2">&quot;__init_stats&quot;</span><span class="p">]</span>
</span><span id="AsyncCompose-144"><a href="#AsyncCompose-144"><span class="linenos">144</span></a>            <span class="n">out_stat</span> <span class="o">=</span> <span class="n">get_doc_info</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
</span><span id="AsyncCompose-145"><a href="#AsyncCompose-145"><span class="linenos">145</span></a>            <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stats_lock</span><span class="p">:</span>
</span><span id="AsyncCompose-146"><a href="#AsyncCompose-146"><span class="linenos">146</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_statistics</span><span class="o">.</span><span class="n">update_by_diff</span><span class="p">(</span><span class="n">in_stat</span><span class="p">,</span> <span class="n">out_stat</span><span class="p">)</span>
</span><span id="AsyncCompose-147"><a href="#AsyncCompose-147"><span class="linenos">147</span></a>            <span class="k">del</span> <span class="n">doc</span><span class="o">.</span><span class="n">extras</span><span class="p">[</span><span class="s2">&quot;__init_stats&quot;</span><span class="p">]</span>
</span><span id="AsyncCompose-148"><a href="#AsyncCompose-148"><span class="linenos">148</span></a>            <span class="k">yield</span> <span class="n">doc</span>
</span><span id="AsyncCompose-149"><a href="#AsyncCompose-149"><span class="linenos">149</span></a>
</span><span id="AsyncCompose-150"><a href="#AsyncCompose-150"><span class="linenos">150</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_count_input_stats</span><span class="p">(</span>
</span><span id="AsyncCompose-151"><a href="#AsyncCompose-151"><span class="linenos">151</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">async_stream</span><span class="p">:</span> <span class="n">AsyncIterable</span><span class="p">[</span><span class="n">Document</span><span class="p">]</span>
</span><span id="AsyncCompose-152"><a href="#AsyncCompose-152"><span class="linenos">152</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncGenerator</span><span class="p">[</span><span class="n">Document</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
</span><span id="AsyncCompose-153"><a href="#AsyncCompose-153"><span class="linenos">153</span></a>        <span class="k">async</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">async_stream</span><span class="p">:</span>
</span><span id="AsyncCompose-154"><a href="#AsyncCompose-154"><span class="linenos">154</span></a>            <span class="n">doc</span><span class="o">.</span><span class="n">extras</span><span class="p">[</span><span class="s2">&quot;__init_stats&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_doc_info</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
</span><span id="AsyncCompose-155"><a href="#AsyncCompose-155"><span class="linenos">155</span></a>            <span class="k">yield</span> <span class="n">doc</span>
</span><span id="AsyncCompose-156"><a href="#AsyncCompose-156"><span class="linenos">156</span></a>
</span><span id="AsyncCompose-157"><a href="#AsyncCompose-157"><span class="linenos">157</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_total_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Statistics</span><span class="p">]:</span>
</span><span id="AsyncCompose-158"><a href="#AsyncCompose-158"><span class="linenos">158</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AsyncCompose-159"><a href="#AsyncCompose-159"><span class="linenos">159</span></a><span class="sd">        Get the statistics of the Compose object and sub filters.</span>
</span><span id="AsyncCompose-160"><a href="#AsyncCompose-160"><span class="linenos">160</span></a>
</span><span id="AsyncCompose-161"><a href="#AsyncCompose-161"><span class="linenos">161</span></a><span class="sd">        The statistics of the Compose class are stored in an object with the name &quot;Total&quot;,</span>
</span><span id="AsyncCompose-162"><a href="#AsyncCompose-162"><span class="linenos">162</span></a><span class="sd">        and sub-filters&#39;s are stored with names in the format {filter_index}-{filter class name}.</span>
</span><span id="AsyncCompose-163"><a href="#AsyncCompose-163"><span class="linenos">163</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AsyncCompose-164"><a href="#AsyncCompose-164"><span class="linenos">164</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AsyncCompose-165"><a href="#AsyncCompose-165"><span class="linenos">165</span></a>        <span class="n">stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_statistics</span><span class="p">())</span>
</span><span id="AsyncCompose-166"><a href="#AsyncCompose-166"><span class="linenos">166</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">filt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">):</span>
</span><span id="AsyncCompose-167"><a href="#AsyncCompose-167"><span class="linenos">167</span></a>            <span class="n">stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filt</span><span class="o">.</span><span class="n">get_statistics</span><span class="p">())</span>
</span><span id="AsyncCompose-168"><a href="#AsyncCompose-168"><span class="linenos">168</span></a>        <span class="k">return</span> <span class="n">stats</span>
</span><span id="AsyncCompose-169"><a href="#AsyncCompose-169"><span class="linenos">169</span></a>
</span><span id="AsyncCompose-170"><a href="#AsyncCompose-170"><span class="linenos">170</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_total_statistics_map</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="AsyncCompose-171"><a href="#AsyncCompose-171"><span class="linenos">171</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AsyncCompose-172"><a href="#AsyncCompose-172"><span class="linenos">172</span></a><span class="sd">        Get the statistics of the Compose object and sub filters as a list of dictionaries.</span>
</span><span id="AsyncCompose-173"><a href="#AsyncCompose-173"><span class="linenos">173</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AsyncCompose-174"><a href="#AsyncCompose-174"><span class="linenos">174</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_total_statistics</span><span class="p">()</span>
</span><span id="AsyncCompose-175"><a href="#AsyncCompose-175"><span class="linenos">175</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">stat</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">]</span>
</span><span id="AsyncCompose-176"><a href="#AsyncCompose-176"><span class="linenos">176</span></a>
</span><span id="AsyncCompose-177"><a href="#AsyncCompose-177"><span class="linenos">177</span></a>    <span class="nd">@property</span>
</span><span id="AsyncCompose-178"><a href="#AsyncCompose-178"><span class="linenos">178</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="AsyncCompose-179"><a href="#AsyncCompose-179"><span class="linenos">179</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AsyncCompose-180"><a href="#AsyncCompose-180"><span class="linenos">180</span></a><span class="sd">        Deprecated</span>
</span><span id="AsyncCompose-181"><a href="#AsyncCompose-181"><span class="linenos">181</span></a>
</span><span id="AsyncCompose-182"><a href="#AsyncCompose-182"><span class="linenos">182</span></a><span class="sd">        Get the statistics of the Compose object and sub filters.</span>
</span><span id="AsyncCompose-183"><a href="#AsyncCompose-183"><span class="linenos">183</span></a>
</span><span id="AsyncCompose-184"><a href="#AsyncCompose-184"><span class="linenos">184</span></a><span class="sd">        This property is retained for compatibility with previous versions.</span>
</span><span id="AsyncCompose-185"><a href="#AsyncCompose-185"><span class="linenos">185</span></a><span class="sd">        Please use `get_total_statistics` or `get_total_statistics_map` instead.</span>
</span><span id="AsyncCompose-186"><a href="#AsyncCompose-186"><span class="linenos">186</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AsyncCompose-187"><a href="#AsyncCompose-187"><span class="linenos">187</span></a>        <span class="k">return</span> <span class="n">inspection</span><span class="o">.</span><span class="n">statistics_obj_adapter</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="AsyncCompose-188"><a href="#AsyncCompose-188"><span class="linenos">188</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_total_statistics</span><span class="p">()</span>
</span><span id="AsyncCompose-189"><a href="#AsyncCompose-189"><span class="linenos">189</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">get_human_readable_values</span><span class="p">()</span>
</span><span id="AsyncCompose-190"><a href="#AsyncCompose-190"><span class="linenos">190</span></a>
</span><span id="AsyncCompose-191"><a href="#AsyncCompose-191"><span class="linenos">191</span></a>    <span class="nd">@property</span>
</span><span id="AsyncCompose-192"><a href="#AsyncCompose-192"><span class="linenos">192</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">statistics_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">inspection</span><span class="o">.</span><span class="n">StatsContainer</span><span class="p">:</span>
</span><span id="AsyncCompose-193"><a href="#AsyncCompose-193"><span class="linenos">193</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AsyncCompose-194"><a href="#AsyncCompose-194"><span class="linenos">194</span></a><span class="sd">        Deprecated</span>
</span><span id="AsyncCompose-195"><a href="#AsyncCompose-195"><span class="linenos">195</span></a>
</span><span id="AsyncCompose-196"><a href="#AsyncCompose-196"><span class="linenos">196</span></a><span class="sd">        Get the statistics of the AsyncCompose object and sub filters.</span>
</span><span id="AsyncCompose-197"><a href="#AsyncCompose-197"><span class="linenos">197</span></a><span class="sd">        This method returns a StatsContainer object which contains the statistics</span>
</span><span id="AsyncCompose-198"><a href="#AsyncCompose-198"><span class="linenos">198</span></a><span class="sd">        of the AsyncCompose object and sub filters.</span>
</span><span id="AsyncCompose-199"><a href="#AsyncCompose-199"><span class="linenos">199</span></a>
</span><span id="AsyncCompose-200"><a href="#AsyncCompose-200"><span class="linenos">200</span></a><span class="sd">        This property is retained for compatibility with previous versions.</span>
</span><span id="AsyncCompose-201"><a href="#AsyncCompose-201"><span class="linenos">201</span></a><span class="sd">        Please use `get_total_statistics` or `get_total_statistics_map` instead.</span>
</span><span id="AsyncCompose-202"><a href="#AsyncCompose-202"><span class="linenos">202</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AsyncCompose-203"><a href="#AsyncCompose-203"><span class="linenos">203</span></a>        <span class="k">return</span> <span class="n">inspection</span><span class="o">.</span><span class="n">statistics_obj_adapter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_total_statistics</span><span class="p">())</span>  <span class="c1"># type: ignore</span>
</span><span id="AsyncCompose-204"><a href="#AsyncCompose-204"><span class="linenos">204</span></a>
</span><span id="AsyncCompose-205"><a href="#AsyncCompose-205"><span class="linenos">205</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AsyncCompose-206"><a href="#AsyncCompose-206"><span class="linenos">206</span></a>        <span class="k">for</span> <span class="n">filt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">:</span>
</span><span id="AsyncCompose-207"><a href="#AsyncCompose-207"><span class="linenos">207</span></a>            <span class="k">await</span> <span class="n">filt</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</span><span id="AsyncCompose-208"><a href="#AsyncCompose-208"><span class="linenos">208</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_external_executor</span><span class="p">:</span>
</span><span id="AsyncCompose-209"><a href="#AsyncCompose-209"><span class="linenos">209</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</span><span id="AsyncCompose-210"><a href="#AsyncCompose-210"><span class="linenos">210</span></a>
</span><span id="AsyncCompose-211"><a href="#AsyncCompose-211"><span class="linenos">211</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="fm">__aenter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;AsyncCompose&quot;</span><span class="p">:</span>
</span><span id="AsyncCompose-212"><a href="#AsyncCompose-212"><span class="linenos">212</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="AsyncCompose-213"><a href="#AsyncCompose-213"><span class="linenos">213</span></a>
</span><span id="AsyncCompose-214"><a href="#AsyncCompose-214"><span class="linenos">214</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="fm">__aexit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">traceback</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AsyncCompose-215"><a href="#AsyncCompose-215"><span class="linenos">215</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</span><span id="AsyncCompose-216"><a href="#AsyncCompose-216"><span class="linenos">216</span></a>        <span class="k">if</span> <span class="n">exc_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AsyncCompose-217"><a href="#AsyncCompose-217"><span class="linenos">217</span></a>            <span class="k">raise</span> <span class="n">exc_value</span>
</span></pre></div>


            <div class="docstring"><p>Helper class that provides a standard way to create an ABC using
inheritance.</p>
</div>


                            <div id="AsyncCompose.__init__" class="classattr">
                                        <input id="AsyncCompose.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">AsyncCompose</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">filters</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="#AsyncFilter">hojichar.AsyncFilter</a></span> <span class="o">|</span> <span class="n"><a href="#Filter">hojichar.Filter</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">_generator</span><span class="o">.</span><span class="n">Generator</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">executor</span><span class="p">:</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">thread</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span></span>)</span>

                <label class="view-source-button" for="AsyncCompose.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AsyncCompose.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AsyncCompose.__init__-74"><a href="#AsyncCompose.__init__-74"><span class="linenos">74</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="AsyncCompose.__init__-75"><a href="#AsyncCompose.__init__-75"><span class="linenos">75</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="AsyncCompose.__init__-76"><a href="#AsyncCompose.__init__-76"><span class="linenos">76</span></a>        <span class="n">filters</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">AsyncFilter</span> <span class="o">|</span> <span class="n">Filter</span><span class="p">],</span>
</span><span id="AsyncCompose.__init__-77"><a href="#AsyncCompose.__init__-77"><span class="linenos">77</span></a>        <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">Generator</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AsyncCompose.__init__-78"><a href="#AsyncCompose.__init__-78"><span class="linenos">78</span></a>        <span class="n">executor</span><span class="p">:</span> <span class="n">ThreadPoolExecutor</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AsyncCompose.__init__-79"><a href="#AsyncCompose.__init__-79"><span class="linenos">79</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="AsyncCompose.__init__-80"><a href="#AsyncCompose.__init__-80"><span class="linenos">80</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="AsyncCompose.__init__-81"><a href="#AsyncCompose.__init__-81"><span class="linenos">81</span></a>    <span class="p">):</span>
</span><span id="AsyncCompose.__init__-82"><a href="#AsyncCompose.__init__-82"><span class="linenos">82</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="AsyncCompose.__init__-83"><a href="#AsyncCompose.__init__-83"><span class="linenos">83</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__module__</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AsyncCompose.__init__-84"><a href="#AsyncCompose.__init__-84"><span class="linenos">84</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_statistics</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Total&quot;</span>
</span><span id="AsyncCompose.__init__-85"><a href="#AsyncCompose.__init__-85"><span class="linenos">85</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_has_external_executor</span> <span class="o">=</span> <span class="n">executor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="AsyncCompose.__init__-86"><a href="#AsyncCompose.__init__-86"><span class="linenos">86</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span> <span class="o">=</span> <span class="n">executor</span> <span class="ow">or</span> <span class="n">ThreadPoolExecutor</span><span class="p">()</span>
</span><span id="AsyncCompose.__init__-87"><a href="#AsyncCompose.__init__-87"><span class="linenos">87</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_filters</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Base class for asynchronous filters.</p>

<h2 id="parameters">Parameters</h2>

<p>p : float
    The probability of applying the filter.
    If <code>p</code> is 1, the filter will always be applied.
skip_rejected : bool
    If <code>True</code>, the filter will skip documents that are already rejected.
    If you want to apply the filter to all documents (e.g., postprocess), set this to <code>False</code>.
random_state : Optional[Union[int, np.random.Generator]]
    Seed for the random number generator.
    If <code>None</code> is specified, the random number generator managed by the Compose class will be used.
use_batch : bool
    If <code>True</code>, the filter will process documents in batches in the <code><a href="#AsyncCompose.apply_stream">apply_stream</a></code> method.
batch_size : int
    The size of the batch to process documents in the <code><a href="#AsyncCompose.apply_stream">apply_stream</a></code> method.</p>
</div>


                            </div>
                            <div id="AsyncCompose.set_filters" class="classattr">
                                        <input id="AsyncCompose.set_filters-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_filters</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">filters</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="#AsyncFilter">hojichar.AsyncFilter</a></span> <span class="o">|</span> <span class="n"><a href="#Filter">hojichar.Filter</a></span><span class="p">]</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="AsyncCompose.set_filters-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AsyncCompose.set_filters"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AsyncCompose.set_filters-89"><a href="#AsyncCompose.set_filters-89"><span class="linenos"> 89</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">AsyncFilter</span> <span class="o">|</span> <span class="n">Filter</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AsyncCompose.set_filters-90"><a href="#AsyncCompose.set_filters-90"><span class="linenos"> 90</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">AsyncFilter</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AsyncCompose.set_filters-91"><a href="#AsyncCompose.set_filters-91"><span class="linenos"> 91</span></a>        <span class="n">filter_idx</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="AsyncCompose.set_filters-92"><a href="#AsyncCompose.set_filters-92"><span class="linenos"> 92</span></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">:</span>
</span><span id="AsyncCompose.set_filters-93"><a href="#AsyncCompose.set_filters-93"><span class="linenos"> 93</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">AsyncCompose</span><span class="p">,</span> <span class="n">Compose</span><span class="p">)):</span>
</span><span id="AsyncCompose.set_filters-94"><a href="#AsyncCompose.set_filters-94"><span class="linenos"> 94</span></a>                <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">filters</span><span class="p">:</span>
</span><span id="AsyncCompose.set_filters-95"><a href="#AsyncCompose.set_filters-95"><span class="linenos"> 95</span></a>                    <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filter_idx</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">sub</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AsyncCompose.set_filters-96"><a href="#AsyncCompose.set_filters-96"><span class="linenos"> 96</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">Filter</span><span class="p">):</span>
</span><span id="AsyncCompose.set_filters-97"><a href="#AsyncCompose.set_filters-97"><span class="linenos"> 97</span></a>                        <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filter_idx</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">sub</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AsyncCompose.set_filters-98"><a href="#AsyncCompose.set_filters-98"><span class="linenos"> 98</span></a>                        <span class="n">sub</span> <span class="o">=</span> <span class="n">AsyncFilterAdapter</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">executor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_executor</span><span class="p">)</span>
</span><span id="AsyncCompose.set_filters-99"><a href="#AsyncCompose.set_filters-99"><span class="linenos"> 99</span></a>
</span><span id="AsyncCompose.set_filters-100"><a href="#AsyncCompose.set_filters-100"><span class="linenos">100</span></a>                    <span class="n">sub</span><span class="o">.</span><span class="n">_set_rng_if_not_initialized</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rng</span><span class="p">)</span>
</span><span id="AsyncCompose.set_filters-101"><a href="#AsyncCompose.set_filters-101"><span class="linenos">101</span></a>                    <span class="n">sub</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="AsyncCompose.set_filters-102"><a href="#AsyncCompose.set_filters-102"><span class="linenos">102</span></a>                    <span class="n">sub</span><span class="o">.</span><span class="n">_statistics</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="AsyncCompose.set_filters-103"><a href="#AsyncCompose.set_filters-103"><span class="linenos">103</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span>
</span><span id="AsyncCompose.set_filters-104"><a href="#AsyncCompose.set_filters-104"><span class="linenos">104</span></a>                    <span class="n">filter_idx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="AsyncCompose.set_filters-105"><a href="#AsyncCompose.set_filters-105"><span class="linenos">105</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="AsyncCompose.set_filters-106"><a href="#AsyncCompose.set_filters-106"><span class="linenos">106</span></a>                <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filter_idx</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AsyncCompose.set_filters-107"><a href="#AsyncCompose.set_filters-107"><span class="linenos">107</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">Filter</span><span class="p">):</span>
</span><span id="AsyncCompose.set_filters-108"><a href="#AsyncCompose.set_filters-108"><span class="linenos">108</span></a>                    <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filter_idx</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AsyncCompose.set_filters-109"><a href="#AsyncCompose.set_filters-109"><span class="linenos">109</span></a>                    <span class="n">f</span> <span class="o">=</span> <span class="n">AsyncFilterAdapter</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">executor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_executor</span><span class="p">)</span>
</span><span id="AsyncCompose.set_filters-110"><a href="#AsyncCompose.set_filters-110"><span class="linenos">110</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">_set_rng_if_not_initialized</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rng</span><span class="p">)</span>
</span><span id="AsyncCompose.set_filters-111"><a href="#AsyncCompose.set_filters-111"><span class="linenos">111</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="AsyncCompose.set_filters-112"><a href="#AsyncCompose.set_filters-112"><span class="linenos">112</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">_statistics</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="AsyncCompose.set_filters-113"><a href="#AsyncCompose.set_filters-113"><span class="linenos">113</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="AsyncCompose.set_filters-114"><a href="#AsyncCompose.set_filters-114"><span class="linenos">114</span></a>                <span class="n">filter_idx</span> <span class="o">+=</span> <span class="mi">1</span>
</span></pre></div>


    

                            </div>
                            <div id="AsyncCompose.apply" class="classattr">
                                        <input id="AsyncCompose.apply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">apply</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">document</span><span class="p">:</span> <span class="n"><a href="#Document">hojichar.Document</a></span></span><span class="return-annotation">) -> <span class="n"><a href="#Document">hojichar.Document</a></span>:</span></span>

                <label class="view-source-button" for="AsyncCompose.apply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AsyncCompose.apply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AsyncCompose.apply-116"><a href="#AsyncCompose.apply-116"><span class="linenos">116</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Document</span><span class="p">:</span>
</span><span id="AsyncCompose.apply-117"><a href="#AsyncCompose.apply-117"><span class="linenos">117</span></a>        <span class="n">stat</span> <span class="o">=</span> <span class="n">get_doc_info</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="AsyncCompose.apply-118"><a href="#AsyncCompose.apply-118"><span class="linenos">118</span></a>        <span class="k">for</span> <span class="n">filter_idx</span><span class="p">,</span> <span class="n">filt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">):</span>
</span><span id="AsyncCompose.apply-119"><a href="#AsyncCompose.apply-119"><span class="linenos">119</span></a>            <span class="n">document</span> <span class="o">=</span> <span class="k">await</span> <span class="n">filt</span><span class="o">.</span><span class="n">_apply</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="AsyncCompose.apply-120"><a href="#AsyncCompose.apply-120"><span class="linenos">120</span></a>        <span class="n">new_stat</span> <span class="o">=</span> <span class="n">get_doc_info</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="AsyncCompose.apply-121"><a href="#AsyncCompose.apply-121"><span class="linenos">121</span></a>        <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stats_lock</span><span class="p">:</span>
</span><span id="AsyncCompose.apply-122"><a href="#AsyncCompose.apply-122"><span class="linenos">122</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_statistics</span><span class="o">.</span><span class="n">update_by_diff</span><span class="p">(</span><span class="n">stat</span><span class="p">,</span> <span class="n">new_stat</span><span class="p">)</span>
</span><span id="AsyncCompose.apply-123"><a href="#AsyncCompose.apply-123"><span class="linenos">123</span></a>        <span class="k">return</span> <span class="n">document</span>
</span></pre></div>


            <div class="docstring"><p>Definition of async filter behavior.</p>

<p>In this method, the filter will modify <code>document.text</code> or
<code>document.extras</code> and set <code>document.is_rejected = True</code> to discard the document.</p>

<h2 id="parameters">Parameters</h2>

<p>document : Document
    Input document</p>

<h2 id="returns">Returns</h2>

<p>Document
    Processed Document</p>
</div>


                            </div>
                            <div id="AsyncCompose.apply_batch" class="classattr">
                                        <input id="AsyncCompose.apply_batch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">apply_batch</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">batch</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n"><a href="#Document">hojichar.Document</a></span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="#Document">hojichar.Document</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="AsyncCompose.apply_batch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AsyncCompose.apply_batch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AsyncCompose.apply_batch-125"><a href="#AsyncCompose.apply_batch-125"><span class="linenos">125</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">apply_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Document</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Document</span><span class="p">]:</span>
</span><span id="AsyncCompose.apply_batch-126"><a href="#AsyncCompose.apply_batch-126"><span class="linenos">126</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_doc_info</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">]</span>
</span><span id="AsyncCompose.apply_batch-127"><a href="#AsyncCompose.apply_batch-127"><span class="linenos">127</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">filt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">):</span>
</span><span id="AsyncCompose.apply_batch-128"><a href="#AsyncCompose.apply_batch-128"><span class="linenos">128</span></a>            <span class="n">batch</span> <span class="o">=</span> <span class="k">await</span> <span class="n">filt</span><span class="o">.</span><span class="n">_apply_batch</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
</span><span id="AsyncCompose.apply_batch-129"><a href="#AsyncCompose.apply_batch-129"><span class="linenos">129</span></a>        <span class="n">batch</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finalize_batch</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">stats</span><span class="p">)</span>
</span><span id="AsyncCompose.apply_batch-130"><a href="#AsyncCompose.apply_batch-130"><span class="linenos">130</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Apply the filter to a Sequence of documents.
By default, the processing implemented in <code><a href="#AsyncCompose.apply">apply</a></code> is executed asynchronously and concurrently.
If the filter processing can be optimized for batch processing, override this method.</p>
</div>


                            </div>
                            <div id="AsyncCompose.apply_stream" class="classattr">
                                        <input id="AsyncCompose.apply_stream-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">apply_stream</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">stream</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AsyncIterable</span><span class="p">[</span><span class="n"><a href="#Document">hojichar.Document</a></span><span class="p">],</span> <span class="n">Iterable</span><span class="p">[</span><span class="n"><a href="#Document">hojichar.Document</a></span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n">AsyncGenerator</span><span class="p">[</span><span class="n"><a href="#Document">hojichar.Document</a></span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="AsyncCompose.apply_stream-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AsyncCompose.apply_stream"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AsyncCompose.apply_stream-132"><a href="#AsyncCompose.apply_stream-132"><span class="linenos">132</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">apply_stream</span><span class="p">(</span>
</span><span id="AsyncCompose.apply_stream-133"><a href="#AsyncCompose.apply_stream-133"><span class="linenos">133</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="AsyncCompose.apply_stream-134"><a href="#AsyncCompose.apply_stream-134"><span class="linenos">134</span></a>        <span class="n">stream</span><span class="p">:</span> <span class="n">AsyncIterable</span><span class="p">[</span><span class="n">Document</span><span class="p">]</span> <span class="o">|</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Document</span><span class="p">],</span>
</span><span id="AsyncCompose.apply_stream-135"><a href="#AsyncCompose.apply_stream-135"><span class="linenos">135</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncGenerator</span><span class="p">[</span><span class="n">Document</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
</span><span id="AsyncCompose.apply_stream-136"><a href="#AsyncCompose.apply_stream-136"><span class="linenos">136</span></a>        <span class="n">async_stream</span> <span class="o">=</span> <span class="n">handle_stream_as_async</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">executor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_executor</span><span class="p">)</span>
</span><span id="AsyncCompose.apply_stream-137"><a href="#AsyncCompose.apply_stream-137"><span class="linenos">137</span></a>        <span class="n">async_stream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_input_stats</span><span class="p">(</span><span class="n">async_stream</span><span class="p">)</span>
</span><span id="AsyncCompose.apply_stream-138"><a href="#AsyncCompose.apply_stream-138"><span class="linenos">138</span></a>
</span><span id="AsyncCompose.apply_stream-139"><a href="#AsyncCompose.apply_stream-139"><span class="linenos">139</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">filt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">):</span>
</span><span id="AsyncCompose.apply_stream-140"><a href="#AsyncCompose.apply_stream-140"><span class="linenos">140</span></a>            <span class="n">async_stream</span> <span class="o">=</span> <span class="n">filt</span><span class="o">.</span><span class="n">apply_stream</span><span class="p">(</span><span class="n">async_stream</span><span class="p">)</span>
</span><span id="AsyncCompose.apply_stream-141"><a href="#AsyncCompose.apply_stream-141"><span class="linenos">141</span></a>
</span><span id="AsyncCompose.apply_stream-142"><a href="#AsyncCompose.apply_stream-142"><span class="linenos">142</span></a>        <span class="k">async</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">async_stream</span><span class="p">:</span>
</span><span id="AsyncCompose.apply_stream-143"><a href="#AsyncCompose.apply_stream-143"><span class="linenos">143</span></a>            <span class="n">in_stat</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">extras</span><span class="p">[</span><span class="s2">&quot;__init_stats&quot;</span><span class="p">]</span>
</span><span id="AsyncCompose.apply_stream-144"><a href="#AsyncCompose.apply_stream-144"><span class="linenos">144</span></a>            <span class="n">out_stat</span> <span class="o">=</span> <span class="n">get_doc_info</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
</span><span id="AsyncCompose.apply_stream-145"><a href="#AsyncCompose.apply_stream-145"><span class="linenos">145</span></a>            <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stats_lock</span><span class="p">:</span>
</span><span id="AsyncCompose.apply_stream-146"><a href="#AsyncCompose.apply_stream-146"><span class="linenos">146</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_statistics</span><span class="o">.</span><span class="n">update_by_diff</span><span class="p">(</span><span class="n">in_stat</span><span class="p">,</span> <span class="n">out_stat</span><span class="p">)</span>
</span><span id="AsyncCompose.apply_stream-147"><a href="#AsyncCompose.apply_stream-147"><span class="linenos">147</span></a>            <span class="k">del</span> <span class="n">doc</span><span class="o">.</span><span class="n">extras</span><span class="p">[</span><span class="s2">&quot;__init_stats&quot;</span><span class="p">]</span>
</span><span id="AsyncCompose.apply_stream-148"><a href="#AsyncCompose.apply_stream-148"><span class="linenos">148</span></a>            <span class="k">yield</span> <span class="n">doc</span>
</span></pre></div>


            <div class="docstring"><p>Apply the filter to a stream of documents (Iterable or AsyncIterable).
If use_batch is set to <code>True</code> at initialization, the filter will process documents in batches.
If the stream is not asynchronous, use handle_stream_as_async to convert it to an asynchronous stream.</p>

<p>Even if an exception occurs during processing, the process will continue, and the following actions will be taken:</p>

<ul>
<li>Set the <code>is_rejected</code> flag of the document to <code>True</code></li>
<li>Set the error details in <code>reject_reason</code></li>
<li>Increment the <code>errors</code> count in the statistics retrievable via <code><a href="#AsyncCompose.get_statistics">get_statistics</a></code></li>
</ul>
</div>


                            </div>
                            <div id="AsyncCompose.get_total_statistics" class="classattr">
                                        <input id="AsyncCompose.get_total_statistics-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_total_statistics</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="hojichar/core/models.html#Statistics">hojichar.core.models.Statistics</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="AsyncCompose.get_total_statistics-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AsyncCompose.get_total_statistics"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AsyncCompose.get_total_statistics-157"><a href="#AsyncCompose.get_total_statistics-157"><span class="linenos">157</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_total_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Statistics</span><span class="p">]:</span>
</span><span id="AsyncCompose.get_total_statistics-158"><a href="#AsyncCompose.get_total_statistics-158"><span class="linenos">158</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AsyncCompose.get_total_statistics-159"><a href="#AsyncCompose.get_total_statistics-159"><span class="linenos">159</span></a><span class="sd">        Get the statistics of the Compose object and sub filters.</span>
</span><span id="AsyncCompose.get_total_statistics-160"><a href="#AsyncCompose.get_total_statistics-160"><span class="linenos">160</span></a>
</span><span id="AsyncCompose.get_total_statistics-161"><a href="#AsyncCompose.get_total_statistics-161"><span class="linenos">161</span></a><span class="sd">        The statistics of the Compose class are stored in an object with the name &quot;Total&quot;,</span>
</span><span id="AsyncCompose.get_total_statistics-162"><a href="#AsyncCompose.get_total_statistics-162"><span class="linenos">162</span></a><span class="sd">        and sub-filters&#39;s are stored with names in the format {filter_index}-{filter class name}.</span>
</span><span id="AsyncCompose.get_total_statistics-163"><a href="#AsyncCompose.get_total_statistics-163"><span class="linenos">163</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AsyncCompose.get_total_statistics-164"><a href="#AsyncCompose.get_total_statistics-164"><span class="linenos">164</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AsyncCompose.get_total_statistics-165"><a href="#AsyncCompose.get_total_statistics-165"><span class="linenos">165</span></a>        <span class="n">stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_statistics</span><span class="p">())</span>
</span><span id="AsyncCompose.get_total_statistics-166"><a href="#AsyncCompose.get_total_statistics-166"><span class="linenos">166</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">filt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">):</span>
</span><span id="AsyncCompose.get_total_statistics-167"><a href="#AsyncCompose.get_total_statistics-167"><span class="linenos">167</span></a>            <span class="n">stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filt</span><span class="o">.</span><span class="n">get_statistics</span><span class="p">())</span>
</span><span id="AsyncCompose.get_total_statistics-168"><a href="#AsyncCompose.get_total_statistics-168"><span class="linenos">168</span></a>        <span class="k">return</span> <span class="n">stats</span>
</span></pre></div>


            <div class="docstring"><p>Get the statistics of the Compose object and sub filters.</p>

<p>The statistics of the Compose class are stored in an object with the name "Total",
and sub-filters's are stored with names in the format {filter_index}-{filter class name}.</p>
</div>


                            </div>
                            <div id="AsyncCompose.get_total_statistics_map" class="classattr">
                                        <input id="AsyncCompose.get_total_statistics_map-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_total_statistics_map</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="AsyncCompose.get_total_statistics_map-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AsyncCompose.get_total_statistics_map"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AsyncCompose.get_total_statistics_map-170"><a href="#AsyncCompose.get_total_statistics_map-170"><span class="linenos">170</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_total_statistics_map</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="AsyncCompose.get_total_statistics_map-171"><a href="#AsyncCompose.get_total_statistics_map-171"><span class="linenos">171</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AsyncCompose.get_total_statistics_map-172"><a href="#AsyncCompose.get_total_statistics_map-172"><span class="linenos">172</span></a><span class="sd">        Get the statistics of the Compose object and sub filters as a list of dictionaries.</span>
</span><span id="AsyncCompose.get_total_statistics_map-173"><a href="#AsyncCompose.get_total_statistics_map-173"><span class="linenos">173</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AsyncCompose.get_total_statistics_map-174"><a href="#AsyncCompose.get_total_statistics_map-174"><span class="linenos">174</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_total_statistics</span><span class="p">()</span>
</span><span id="AsyncCompose.get_total_statistics_map-175"><a href="#AsyncCompose.get_total_statistics_map-175"><span class="linenos">175</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">stat</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Get the statistics of the Compose object and sub filters as a list of dictionaries.</p>
</div>


                            </div>
                            <div id="AsyncCompose.statistics" class="classattr">
                                <div class="attr variable">
            <span class="name">statistics</span><span class="annotation">: dict</span>

        
    </div>
    <a class="headerlink" href="#AsyncCompose.statistics"></a>
    
            <div class="docstring"><p>Deprecated</p>

<p>Get the statistics of the Compose object and sub filters.</p>

<p>This property is retained for compatibility with previous versions.
Please use <code><a href="#AsyncCompose.get_total_statistics">get_total_statistics</a></code> or <code><a href="#AsyncCompose.get_total_statistics_map">get_total_statistics_map</a></code> instead.</p>
</div>


                            </div>
                            <div id="AsyncCompose.statistics_obj" class="classattr">
                                <div class="attr variable">
            <span class="name">statistics_obj</span><span class="annotation">: <a href="#StatsContainer">hojichar.StatsContainer</a></span>

        
    </div>
    <a class="headerlink" href="#AsyncCompose.statistics_obj"></a>
    
            <div class="docstring"><p>Deprecated</p>

<p>Get the statistics of the AsyncCompose object and sub filters.
This method returns a StatsContainer object which contains the statistics
of the AsyncCompose object and sub filters.</p>

<p>This property is retained for compatibility with previous versions.
Please use <code><a href="#AsyncCompose.get_total_statistics">get_total_statistics</a></code> or <code><a href="#AsyncCompose.get_total_statistics_map">get_total_statistics_map</a></code> instead.</p>
</div>


                            </div>
                            <div id="AsyncCompose.shutdown" class="classattr">
                                        <input id="AsyncCompose.shutdown-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">shutdown</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="AsyncCompose.shutdown-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AsyncCompose.shutdown"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AsyncCompose.shutdown-205"><a href="#AsyncCompose.shutdown-205"><span class="linenos">205</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AsyncCompose.shutdown-206"><a href="#AsyncCompose.shutdown-206"><span class="linenos">206</span></a>        <span class="k">for</span> <span class="n">filt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">:</span>
</span><span id="AsyncCompose.shutdown-207"><a href="#AsyncCompose.shutdown-207"><span class="linenos">207</span></a>            <span class="k">await</span> <span class="n">filt</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</span><span id="AsyncCompose.shutdown-208"><a href="#AsyncCompose.shutdown-208"><span class="linenos">208</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_external_executor</span><span class="p">:</span>
</span><span id="AsyncCompose.shutdown-209"><a href="#AsyncCompose.shutdown-209"><span class="linenos">209</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>You can override this method to release resources or perform cleanup tasks.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#AsyncFilter">AsyncFilter</a></dt>
                                <dd id="AsyncCompose.get_statistics" class="function"><a href="#AsyncFilter.get_statistics">get_statistics</a></dd>
                <dd id="AsyncCompose.get_statistics_map" class="function"><a href="#AsyncFilter.get_statistics_map">get_statistics_map</a></dd>
                <dd id="AsyncCompose.get_jsonable_vars" class="function"><a href="#AsyncFilter.get_jsonable_vars">get_jsonable_vars</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="AsyncFilterAdapter">
                            <input id="AsyncFilterAdapter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">AsyncFilterAdapter</span><wbr>(<span class="base"><a href="#AsyncFilter">hojichar.AsyncFilter</a></span>):

                <label class="view-source-button" for="AsyncFilterAdapter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AsyncFilterAdapter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AsyncFilterAdapter-19"><a href="#AsyncFilterAdapter-19"><span class="linenos">19</span></a><span class="k">class</span><span class="w"> </span><span class="nc">AsyncFilterAdapter</span><span class="p">(</span><span class="n">AsyncFilter</span><span class="p">):</span>
</span><span id="AsyncFilterAdapter-20"><a href="#AsyncFilterAdapter-20"><span class="linenos">20</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AsyncFilterAdapter-21"><a href="#AsyncFilterAdapter-21"><span class="linenos">21</span></a><span class="sd">    Adapter class for executing hojichar.Filter asynchronously.</span>
</span><span id="AsyncFilterAdapter-22"><a href="#AsyncFilterAdapter-22"><span class="linenos">22</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="AsyncFilterAdapter-23"><a href="#AsyncFilterAdapter-23"><span class="linenos">23</span></a>
</span><span id="AsyncFilterAdapter-24"><a href="#AsyncFilterAdapter-24"><span class="linenos">24</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="AsyncFilterAdapter-25"><a href="#AsyncFilterAdapter-25"><span class="linenos">25</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="AsyncFilterAdapter-26"><a href="#AsyncFilterAdapter-26"><span class="linenos">26</span></a>        <span class="n">sync_filter</span><span class="p">:</span> <span class="n">Filter</span><span class="p">,</span>
</span><span id="AsyncFilterAdapter-27"><a href="#AsyncFilterAdapter-27"><span class="linenos">27</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="AsyncFilterAdapter-28"><a href="#AsyncFilterAdapter-28"><span class="linenos">28</span></a>        <span class="n">executor</span><span class="p">:</span> <span class="n">Executor</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AsyncFilterAdapter-29"><a href="#AsyncFilterAdapter-29"><span class="linenos">29</span></a>        <span class="n">use_batch</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="AsyncFilterAdapter-30"><a href="#AsyncFilterAdapter-30"><span class="linenos">30</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="AsyncFilterAdapter-31"><a href="#AsyncFilterAdapter-31"><span class="linenos">31</span></a>    <span class="p">):</span>
</span><span id="AsyncFilterAdapter-32"><a href="#AsyncFilterAdapter-32"><span class="linenos">32</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AsyncFilterAdapter-33"><a href="#AsyncFilterAdapter-33"><span class="linenos">33</span></a><span class="sd">        Adapter class for executing hojichar.Filter asynchronously.</span>
</span><span id="AsyncFilterAdapter-34"><a href="#AsyncFilterAdapter-34"><span class="linenos">34</span></a><span class="sd">        Used to incorporate Filter into AsyncCompose.</span>
</span><span id="AsyncFilterAdapter-35"><a href="#AsyncFilterAdapter-35"><span class="linenos">35</span></a>
</span><span id="AsyncFilterAdapter-36"><a href="#AsyncFilterAdapter-36"><span class="linenos">36</span></a><span class="sd">        To reduce the overhead of asynchronous context switching,</span>
</span><span id="AsyncFilterAdapter-37"><a href="#AsyncFilterAdapter-37"><span class="linenos">37</span></a><span class="sd">        use_batch is set to True by default to process in batches</span>
</span><span id="AsyncFilterAdapter-38"><a href="#AsyncFilterAdapter-38"><span class="linenos">38</span></a><span class="sd">        in apply_stream, regardless of the sync_filter&#39;s use_batch setting.</span>
</span><span id="AsyncFilterAdapter-39"><a href="#AsyncFilterAdapter-39"><span class="linenos">39</span></a>
</span><span id="AsyncFilterAdapter-40"><a href="#AsyncFilterAdapter-40"><span class="linenos">40</span></a><span class="sd">        If performing CPU-bound and heavy processing, you can specify an executor</span>
</span><span id="AsyncFilterAdapter-41"><a href="#AsyncFilterAdapter-41"><span class="linenos">41</span></a><span class="sd">        to offload the processing to the executor. However, due to Python&#39;s GIL</span>
</span><span id="AsyncFilterAdapter-42"><a href="#AsyncFilterAdapter-42"><span class="linenos">42</span></a><span class="sd">        constraints, using ThreadPoolExecutor will not parallelize CPU-bound</span>
</span><span id="AsyncFilterAdapter-43"><a href="#AsyncFilterAdapter-43"><span class="linenos">43</span></a><span class="sd">        processing, and the entire process will be locked.</span>
</span><span id="AsyncFilterAdapter-44"><a href="#AsyncFilterAdapter-44"><span class="linenos">44</span></a>
</span><span id="AsyncFilterAdapter-45"><a href="#AsyncFilterAdapter-45"><span class="linenos">45</span></a><span class="sd">        By using ProcessPoolExecutor as the executor, it may be possible to</span>
</span><span id="AsyncFilterAdapter-46"><a href="#AsyncFilterAdapter-46"><span class="linenos">46</span></a><span class="sd">        parallelize CPU-bound processing. However, for parallelizing CPU-bound</span>
</span><span id="AsyncFilterAdapter-47"><a href="#AsyncFilterAdapter-47"><span class="linenos">47</span></a><span class="sd">        processing, it is recommended to use the hojichar.Parallel class to</span>
</span><span id="AsyncFilterAdapter-48"><a href="#AsyncFilterAdapter-48"><span class="linenos">48</span></a><span class="sd">        parallelize synchronous Compose pipeline.</span>
</span><span id="AsyncFilterAdapter-49"><a href="#AsyncFilterAdapter-49"><span class="linenos">49</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AsyncFilterAdapter-50"><a href="#AsyncFilterAdapter-50"><span class="linenos">50</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">use_batch</span><span class="o">=</span><span class="n">use_batch</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="AsyncFilterAdapter-51"><a href="#AsyncFilterAdapter-51"><span class="linenos">51</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sync_filter</span> <span class="o">=</span> <span class="n">sync_filter</span>
</span><span id="AsyncFilterAdapter-52"><a href="#AsyncFilterAdapter-52"><span class="linenos">52</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_has_external_executor</span> <span class="o">=</span> <span class="n">executor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="AsyncFilterAdapter-53"><a href="#AsyncFilterAdapter-53"><span class="linenos">53</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span> <span class="o">=</span> <span class="n">executor</span> <span class="ow">or</span> <span class="n">ThreadPoolExecutor</span><span class="p">()</span>
</span><span id="AsyncFilterAdapter-54"><a href="#AsyncFilterAdapter-54"><span class="linenos">54</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">sync_filter</span><span class="o">.</span><span class="n">batch_size</span>
</span><span id="AsyncFilterAdapter-55"><a href="#AsyncFilterAdapter-55"><span class="linenos">55</span></a>
</span><span id="AsyncFilterAdapter-56"><a href="#AsyncFilterAdapter-56"><span class="linenos">56</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Document</span><span class="p">:</span>
</span><span id="AsyncFilterAdapter-57"><a href="#AsyncFilterAdapter-57"><span class="linenos">57</span></a>        <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_running_loop</span><span class="p">()</span>
</span><span id="AsyncFilterAdapter-58"><a href="#AsyncFilterAdapter-58"><span class="linenos">58</span></a>        <span class="k">return</span> <span class="k">await</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_in_executor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_executor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sync_filter</span><span class="o">.</span><span class="n">apply</span><span class="p">,</span> <span class="n">document</span><span class="p">)</span>
</span><span id="AsyncFilterAdapter-59"><a href="#AsyncFilterAdapter-59"><span class="linenos">59</span></a>
</span><span id="AsyncFilterAdapter-60"><a href="#AsyncFilterAdapter-60"><span class="linenos">60</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">apply_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Document</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Document</span><span class="p">]:</span>
</span><span id="AsyncFilterAdapter-61"><a href="#AsyncFilterAdapter-61"><span class="linenos">61</span></a>        <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_running_loop</span><span class="p">()</span>
</span><span id="AsyncFilterAdapter-62"><a href="#AsyncFilterAdapter-62"><span class="linenos">62</span></a>        <span class="k">return</span> <span class="k">await</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_in_executor</span><span class="p">(</span>
</span><span id="AsyncFilterAdapter-63"><a href="#AsyncFilterAdapter-63"><span class="linenos">63</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span><span class="p">,</span>
</span><span id="AsyncFilterAdapter-64"><a href="#AsyncFilterAdapter-64"><span class="linenos">64</span></a>            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sync_filter</span><span class="o">.</span><span class="n">apply_batch</span><span class="p">(</span><span class="n">batch</span><span class="p">),</span>
</span><span id="AsyncFilterAdapter-65"><a href="#AsyncFilterAdapter-65"><span class="linenos">65</span></a>        <span class="p">)</span>
</span><span id="AsyncFilterAdapter-66"><a href="#AsyncFilterAdapter-66"><span class="linenos">66</span></a>
</span><span id="AsyncFilterAdapter-67"><a href="#AsyncFilterAdapter-67"><span class="linenos">67</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AsyncFilterAdapter-68"><a href="#AsyncFilterAdapter-68"><span class="linenos">68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sync_filter</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</span><span id="AsyncFilterAdapter-69"><a href="#AsyncFilterAdapter-69"><span class="linenos">69</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_external_executor</span><span class="p">:</span>
</span><span id="AsyncFilterAdapter-70"><a href="#AsyncFilterAdapter-70"><span class="linenos">70</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Adapter class for executing <a href="#Filter">hojichar.Filter</a> asynchronously.</p>
</div>


                            <div id="AsyncFilterAdapter.__init__" class="classattr">
                                        <input id="AsyncFilterAdapter.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">AsyncFilterAdapter</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">sync_filter</span><span class="p">:</span> <span class="n"><a href="#Filter">hojichar.Filter</a></span>,</span><span class="param">	<span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">executor</span><span class="p">:</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">_base</span><span class="o">.</span><span class="n">Executor</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">use_batch</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span></span>)</span>

                <label class="view-source-button" for="AsyncFilterAdapter.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AsyncFilterAdapter.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AsyncFilterAdapter.__init__-24"><a href="#AsyncFilterAdapter.__init__-24"><span class="linenos">24</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="AsyncFilterAdapter.__init__-25"><a href="#AsyncFilterAdapter.__init__-25"><span class="linenos">25</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="AsyncFilterAdapter.__init__-26"><a href="#AsyncFilterAdapter.__init__-26"><span class="linenos">26</span></a>        <span class="n">sync_filter</span><span class="p">:</span> <span class="n">Filter</span><span class="p">,</span>
</span><span id="AsyncFilterAdapter.__init__-27"><a href="#AsyncFilterAdapter.__init__-27"><span class="linenos">27</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="AsyncFilterAdapter.__init__-28"><a href="#AsyncFilterAdapter.__init__-28"><span class="linenos">28</span></a>        <span class="n">executor</span><span class="p">:</span> <span class="n">Executor</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AsyncFilterAdapter.__init__-29"><a href="#AsyncFilterAdapter.__init__-29"><span class="linenos">29</span></a>        <span class="n">use_batch</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="AsyncFilterAdapter.__init__-30"><a href="#AsyncFilterAdapter.__init__-30"><span class="linenos">30</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="AsyncFilterAdapter.__init__-31"><a href="#AsyncFilterAdapter.__init__-31"><span class="linenos">31</span></a>    <span class="p">):</span>
</span><span id="AsyncFilterAdapter.__init__-32"><a href="#AsyncFilterAdapter.__init__-32"><span class="linenos">32</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AsyncFilterAdapter.__init__-33"><a href="#AsyncFilterAdapter.__init__-33"><span class="linenos">33</span></a><span class="sd">        Adapter class for executing hojichar.Filter asynchronously.</span>
</span><span id="AsyncFilterAdapter.__init__-34"><a href="#AsyncFilterAdapter.__init__-34"><span class="linenos">34</span></a><span class="sd">        Used to incorporate Filter into AsyncCompose.</span>
</span><span id="AsyncFilterAdapter.__init__-35"><a href="#AsyncFilterAdapter.__init__-35"><span class="linenos">35</span></a>
</span><span id="AsyncFilterAdapter.__init__-36"><a href="#AsyncFilterAdapter.__init__-36"><span class="linenos">36</span></a><span class="sd">        To reduce the overhead of asynchronous context switching,</span>
</span><span id="AsyncFilterAdapter.__init__-37"><a href="#AsyncFilterAdapter.__init__-37"><span class="linenos">37</span></a><span class="sd">        use_batch is set to True by default to process in batches</span>
</span><span id="AsyncFilterAdapter.__init__-38"><a href="#AsyncFilterAdapter.__init__-38"><span class="linenos">38</span></a><span class="sd">        in apply_stream, regardless of the sync_filter&#39;s use_batch setting.</span>
</span><span id="AsyncFilterAdapter.__init__-39"><a href="#AsyncFilterAdapter.__init__-39"><span class="linenos">39</span></a>
</span><span id="AsyncFilterAdapter.__init__-40"><a href="#AsyncFilterAdapter.__init__-40"><span class="linenos">40</span></a><span class="sd">        If performing CPU-bound and heavy processing, you can specify an executor</span>
</span><span id="AsyncFilterAdapter.__init__-41"><a href="#AsyncFilterAdapter.__init__-41"><span class="linenos">41</span></a><span class="sd">        to offload the processing to the executor. However, due to Python&#39;s GIL</span>
</span><span id="AsyncFilterAdapter.__init__-42"><a href="#AsyncFilterAdapter.__init__-42"><span class="linenos">42</span></a><span class="sd">        constraints, using ThreadPoolExecutor will not parallelize CPU-bound</span>
</span><span id="AsyncFilterAdapter.__init__-43"><a href="#AsyncFilterAdapter.__init__-43"><span class="linenos">43</span></a><span class="sd">        processing, and the entire process will be locked.</span>
</span><span id="AsyncFilterAdapter.__init__-44"><a href="#AsyncFilterAdapter.__init__-44"><span class="linenos">44</span></a>
</span><span id="AsyncFilterAdapter.__init__-45"><a href="#AsyncFilterAdapter.__init__-45"><span class="linenos">45</span></a><span class="sd">        By using ProcessPoolExecutor as the executor, it may be possible to</span>
</span><span id="AsyncFilterAdapter.__init__-46"><a href="#AsyncFilterAdapter.__init__-46"><span class="linenos">46</span></a><span class="sd">        parallelize CPU-bound processing. However, for parallelizing CPU-bound</span>
</span><span id="AsyncFilterAdapter.__init__-47"><a href="#AsyncFilterAdapter.__init__-47"><span class="linenos">47</span></a><span class="sd">        processing, it is recommended to use the hojichar.Parallel class to</span>
</span><span id="AsyncFilterAdapter.__init__-48"><a href="#AsyncFilterAdapter.__init__-48"><span class="linenos">48</span></a><span class="sd">        parallelize synchronous Compose pipeline.</span>
</span><span id="AsyncFilterAdapter.__init__-49"><a href="#AsyncFilterAdapter.__init__-49"><span class="linenos">49</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AsyncFilterAdapter.__init__-50"><a href="#AsyncFilterAdapter.__init__-50"><span class="linenos">50</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">use_batch</span><span class="o">=</span><span class="n">use_batch</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="AsyncFilterAdapter.__init__-51"><a href="#AsyncFilterAdapter.__init__-51"><span class="linenos">51</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sync_filter</span> <span class="o">=</span> <span class="n">sync_filter</span>
</span><span id="AsyncFilterAdapter.__init__-52"><a href="#AsyncFilterAdapter.__init__-52"><span class="linenos">52</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_has_external_executor</span> <span class="o">=</span> <span class="n">executor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="AsyncFilterAdapter.__init__-53"><a href="#AsyncFilterAdapter.__init__-53"><span class="linenos">53</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span> <span class="o">=</span> <span class="n">executor</span> <span class="ow">or</span> <span class="n">ThreadPoolExecutor</span><span class="p">()</span>
</span><span id="AsyncFilterAdapter.__init__-54"><a href="#AsyncFilterAdapter.__init__-54"><span class="linenos">54</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">sync_filter</span><span class="o">.</span><span class="n">batch_size</span>
</span></pre></div>


            <div class="docstring"><p>Adapter class for executing <a href="#Filter">hojichar.Filter</a> asynchronously.
Used to incorporate Filter into AsyncCompose.</p>

<p>To reduce the overhead of asynchronous context switching,
use_batch is set to True by default to process in batches
in apply_stream, regardless of the sync_filter's use_batch setting.</p>

<p>If performing CPU-bound and heavy processing, you can specify an executor
to offload the processing to the executor. However, due to Python's GIL
constraints, using ThreadPoolExecutor will not parallelize CPU-bound
processing, and the entire process will be locked.</p>

<p>By using ProcessPoolExecutor as the executor, it may be possible to
parallelize CPU-bound processing. However, for parallelizing CPU-bound
processing, it is recommended to use the <a href="#Parallel">hojichar.Parallel</a> class to
parallelize synchronous Compose pipeline.</p>
</div>


                            </div>
                            <div id="AsyncFilterAdapter.apply" class="classattr">
                                        <input id="AsyncFilterAdapter.apply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">apply</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">document</span><span class="p">:</span> <span class="n"><a href="#Document">hojichar.Document</a></span></span><span class="return-annotation">) -> <span class="n"><a href="#Document">hojichar.Document</a></span>:</span></span>

                <label class="view-source-button" for="AsyncFilterAdapter.apply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AsyncFilterAdapter.apply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AsyncFilterAdapter.apply-56"><a href="#AsyncFilterAdapter.apply-56"><span class="linenos">56</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Document</span><span class="p">:</span>
</span><span id="AsyncFilterAdapter.apply-57"><a href="#AsyncFilterAdapter.apply-57"><span class="linenos">57</span></a>        <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_running_loop</span><span class="p">()</span>
</span><span id="AsyncFilterAdapter.apply-58"><a href="#AsyncFilterAdapter.apply-58"><span class="linenos">58</span></a>        <span class="k">return</span> <span class="k">await</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_in_executor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_executor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sync_filter</span><span class="o">.</span><span class="n">apply</span><span class="p">,</span> <span class="n">document</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Definition of async filter behavior.</p>

<p>In this method, the filter will modify <code>document.text</code> or
<code>document.extras</code> and set <code>document.is_rejected = True</code> to discard the document.</p>

<h2 id="parameters">Parameters</h2>

<p>document : Document
    Input document</p>

<h2 id="returns">Returns</h2>

<p>Document
    Processed Document</p>
</div>


                            </div>
                            <div id="AsyncFilterAdapter.apply_batch" class="classattr">
                                        <input id="AsyncFilterAdapter.apply_batch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">apply_batch</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">batch</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n"><a href="#Document">hojichar.Document</a></span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="#Document">hojichar.Document</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="AsyncFilterAdapter.apply_batch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AsyncFilterAdapter.apply_batch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AsyncFilterAdapter.apply_batch-60"><a href="#AsyncFilterAdapter.apply_batch-60"><span class="linenos">60</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">apply_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Document</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Document</span><span class="p">]:</span>
</span><span id="AsyncFilterAdapter.apply_batch-61"><a href="#AsyncFilterAdapter.apply_batch-61"><span class="linenos">61</span></a>        <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_running_loop</span><span class="p">()</span>
</span><span id="AsyncFilterAdapter.apply_batch-62"><a href="#AsyncFilterAdapter.apply_batch-62"><span class="linenos">62</span></a>        <span class="k">return</span> <span class="k">await</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_in_executor</span><span class="p">(</span>
</span><span id="AsyncFilterAdapter.apply_batch-63"><a href="#AsyncFilterAdapter.apply_batch-63"><span class="linenos">63</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span><span class="p">,</span>
</span><span id="AsyncFilterAdapter.apply_batch-64"><a href="#AsyncFilterAdapter.apply_batch-64"><span class="linenos">64</span></a>            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sync_filter</span><span class="o">.</span><span class="n">apply_batch</span><span class="p">(</span><span class="n">batch</span><span class="p">),</span>
</span><span id="AsyncFilterAdapter.apply_batch-65"><a href="#AsyncFilterAdapter.apply_batch-65"><span class="linenos">65</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Apply the filter to a Sequence of documents.
By default, the processing implemented in <code><a href="#AsyncFilterAdapter.apply">apply</a></code> is executed asynchronously and concurrently.
If the filter processing can be optimized for batch processing, override this method.</p>
</div>


                            </div>
                            <div id="AsyncFilterAdapter.shutdown" class="classattr">
                                        <input id="AsyncFilterAdapter.shutdown-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">shutdown</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="AsyncFilterAdapter.shutdown-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AsyncFilterAdapter.shutdown"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AsyncFilterAdapter.shutdown-67"><a href="#AsyncFilterAdapter.shutdown-67"><span class="linenos">67</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AsyncFilterAdapter.shutdown-68"><a href="#AsyncFilterAdapter.shutdown-68"><span class="linenos">68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sync_filter</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</span><span id="AsyncFilterAdapter.shutdown-69"><a href="#AsyncFilterAdapter.shutdown-69"><span class="linenos">69</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_external_executor</span><span class="p">:</span>
</span><span id="AsyncFilterAdapter.shutdown-70"><a href="#AsyncFilterAdapter.shutdown-70"><span class="linenos">70</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>You can override this method to release resources or perform cleanup tasks.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#AsyncFilter">AsyncFilter</a></dt>
                                <dd id="AsyncFilterAdapter.apply_stream" class="function"><a href="#AsyncFilter.apply_stream">apply_stream</a></dd>
                <dd id="AsyncFilterAdapter.get_statistics" class="function"><a href="#AsyncFilter.get_statistics">get_statistics</a></dd>
                <dd id="AsyncFilterAdapter.get_statistics_map" class="function"><a href="#AsyncFilter.get_statistics_map">get_statistics_map</a></dd>
                <dd id="AsyncFilterAdapter.get_jsonable_vars" class="function"><a href="#AsyncFilter.get_jsonable_vars">get_jsonable_vars</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="AsyncFilter">
                            <input id="AsyncFilter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">AsyncFilter</span><wbr>(<span class="base">abc.ABC</span>):

                <label class="view-source-button" for="AsyncFilter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AsyncFilter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AsyncFilter-34"><a href="#AsyncFilter-34"><span class="linenos"> 34</span></a><span class="k">class</span><span class="w"> </span><span class="nc">AsyncFilter</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
</span><span id="AsyncFilter-35"><a href="#AsyncFilter-35"><span class="linenos"> 35</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="AsyncFilter-36"><a href="#AsyncFilter-36"><span class="linenos"> 36</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="AsyncFilter-37"><a href="#AsyncFilter-37"><span class="linenos"> 37</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="AsyncFilter-38"><a href="#AsyncFilter-38"><span class="linenos"> 38</span></a>        <span class="n">p</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="AsyncFilter-39"><a href="#AsyncFilter-39"><span class="linenos"> 39</span></a>        <span class="n">skip_rejected</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="AsyncFilter-40"><a href="#AsyncFilter-40"><span class="linenos"> 40</span></a>        <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">Generator</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AsyncFilter-41"><a href="#AsyncFilter-41"><span class="linenos"> 41</span></a>        <span class="n">use_batch</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="AsyncFilter-42"><a href="#AsyncFilter-42"><span class="linenos"> 42</span></a>        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
</span><span id="AsyncFilter-43"><a href="#AsyncFilter-43"><span class="linenos"> 43</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="AsyncFilter-44"><a href="#AsyncFilter-44"><span class="linenos"> 44</span></a>    <span class="p">):</span>
</span><span id="AsyncFilter-45"><a href="#AsyncFilter-45"><span class="linenos"> 45</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AsyncFilter-46"><a href="#AsyncFilter-46"><span class="linenos"> 46</span></a><span class="sd">        Base class for asynchronous filters.</span>
</span><span id="AsyncFilter-47"><a href="#AsyncFilter-47"><span class="linenos"> 47</span></a>
</span><span id="AsyncFilter-48"><a href="#AsyncFilter-48"><span class="linenos"> 48</span></a><span class="sd">        Parameters</span>
</span><span id="AsyncFilter-49"><a href="#AsyncFilter-49"><span class="linenos"> 49</span></a><span class="sd">        ----------</span>
</span><span id="AsyncFilter-50"><a href="#AsyncFilter-50"><span class="linenos"> 50</span></a><span class="sd">        p : float</span>
</span><span id="AsyncFilter-51"><a href="#AsyncFilter-51"><span class="linenos"> 51</span></a><span class="sd">            The probability of applying the filter.</span>
</span><span id="AsyncFilter-52"><a href="#AsyncFilter-52"><span class="linenos"> 52</span></a><span class="sd">            If `p` is 1, the filter will always be applied.</span>
</span><span id="AsyncFilter-53"><a href="#AsyncFilter-53"><span class="linenos"> 53</span></a><span class="sd">        skip_rejected : bool</span>
</span><span id="AsyncFilter-54"><a href="#AsyncFilter-54"><span class="linenos"> 54</span></a><span class="sd">            If `True`, the filter will skip documents that are already rejected.</span>
</span><span id="AsyncFilter-55"><a href="#AsyncFilter-55"><span class="linenos"> 55</span></a><span class="sd">            If you want to apply the filter to all documents (e.g., postprocess), set this to `False`.</span>
</span><span id="AsyncFilter-56"><a href="#AsyncFilter-56"><span class="linenos"> 56</span></a><span class="sd">        random_state : Optional[Union[int, np.random.Generator]]</span>
</span><span id="AsyncFilter-57"><a href="#AsyncFilter-57"><span class="linenos"> 57</span></a><span class="sd">            Seed for the random number generator.</span>
</span><span id="AsyncFilter-58"><a href="#AsyncFilter-58"><span class="linenos"> 58</span></a><span class="sd">            If `None` is specified, the random number generator managed by the Compose class will be used.</span>
</span><span id="AsyncFilter-59"><a href="#AsyncFilter-59"><span class="linenos"> 59</span></a><span class="sd">        use_batch : bool</span>
</span><span id="AsyncFilter-60"><a href="#AsyncFilter-60"><span class="linenos"> 60</span></a><span class="sd">            If `True`, the filter will process documents in batches in the `apply_stream` method.</span>
</span><span id="AsyncFilter-61"><a href="#AsyncFilter-61"><span class="linenos"> 61</span></a><span class="sd">        batch_size : int</span>
</span><span id="AsyncFilter-62"><a href="#AsyncFilter-62"><span class="linenos"> 62</span></a><span class="sd">            The size of the batch to process documents in the `apply_stream` method.</span>
</span><span id="AsyncFilter-63"><a href="#AsyncFilter-63"><span class="linenos"> 63</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AsyncFilter-64"><a href="#AsyncFilter-64"><span class="linenos"> 64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="AsyncFilter-65"><a href="#AsyncFilter-65"><span class="linenos"> 65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__module__</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AsyncFilter-66"><a href="#AsyncFilter-66"><span class="linenos"> 66</span></a>        <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">p</span> <span class="o">&lt;=</span> <span class="mi">1</span>
</span><span id="AsyncFilter-67"><a href="#AsyncFilter-67"><span class="linenos"> 67</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
</span><span id="AsyncFilter-68"><a href="#AsyncFilter-68"><span class="linenos"> 68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__init_rng</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span>
</span><span id="AsyncFilter-69"><a href="#AsyncFilter-69"><span class="linenos"> 69</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">skip_rejected</span> <span class="o">=</span> <span class="n">skip_rejected</span>
</span><span id="AsyncFilter-70"><a href="#AsyncFilter-70"><span class="linenos"> 70</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">use_batch</span> <span class="o">=</span> <span class="n">use_batch</span>
</span><span id="AsyncFilter-71"><a href="#AsyncFilter-71"><span class="linenos"> 71</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">batch_size</span>
</span><span id="AsyncFilter-72"><a href="#AsyncFilter-72"><span class="linenos"> 72</span></a>
</span><span id="AsyncFilter-73"><a href="#AsyncFilter-73"><span class="linenos"> 73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_statistics</span> <span class="o">=</span> <span class="n">Statistics</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="AsyncFilter-74"><a href="#AsyncFilter-74"><span class="linenos"> 74</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stats_lock</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
</span><span id="AsyncFilter-75"><a href="#AsyncFilter-75"><span class="linenos"> 75</span></a>
</span><span id="AsyncFilter-76"><a href="#AsyncFilter-76"><span class="linenos"> 76</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="AsyncFilter-77"><a href="#AsyncFilter-77"><span class="linenos"> 77</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Document</span><span class="p">:</span>
</span><span id="AsyncFilter-78"><a href="#AsyncFilter-78"><span class="linenos"> 78</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AsyncFilter-79"><a href="#AsyncFilter-79"><span class="linenos"> 79</span></a><span class="sd">        Definition of async filter behavior.</span>
</span><span id="AsyncFilter-80"><a href="#AsyncFilter-80"><span class="linenos"> 80</span></a>
</span><span id="AsyncFilter-81"><a href="#AsyncFilter-81"><span class="linenos"> 81</span></a><span class="sd">        In this method, the filter will modify `document.text` or</span>
</span><span id="AsyncFilter-82"><a href="#AsyncFilter-82"><span class="linenos"> 82</span></a><span class="sd">        `document.extras` and set `document.is_rejected = True` to discard the document.</span>
</span><span id="AsyncFilter-83"><a href="#AsyncFilter-83"><span class="linenos"> 83</span></a>
</span><span id="AsyncFilter-84"><a href="#AsyncFilter-84"><span class="linenos"> 84</span></a><span class="sd">        Parameters</span>
</span><span id="AsyncFilter-85"><a href="#AsyncFilter-85"><span class="linenos"> 85</span></a><span class="sd">        ----------</span>
</span><span id="AsyncFilter-86"><a href="#AsyncFilter-86"><span class="linenos"> 86</span></a><span class="sd">        document : Document</span>
</span><span id="AsyncFilter-87"><a href="#AsyncFilter-87"><span class="linenos"> 87</span></a><span class="sd">            Input document</span>
</span><span id="AsyncFilter-88"><a href="#AsyncFilter-88"><span class="linenos"> 88</span></a>
</span><span id="AsyncFilter-89"><a href="#AsyncFilter-89"><span class="linenos"> 89</span></a><span class="sd">        Returns</span>
</span><span id="AsyncFilter-90"><a href="#AsyncFilter-90"><span class="linenos"> 90</span></a><span class="sd">        -------</span>
</span><span id="AsyncFilter-91"><a href="#AsyncFilter-91"><span class="linenos"> 91</span></a><span class="sd">        Document</span>
</span><span id="AsyncFilter-92"><a href="#AsyncFilter-92"><span class="linenos"> 92</span></a><span class="sd">            Processed Document</span>
</span><span id="AsyncFilter-93"><a href="#AsyncFilter-93"><span class="linenos"> 93</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AsyncFilter-94"><a href="#AsyncFilter-94"><span class="linenos"> 94</span></a>        <span class="k">pass</span>
</span><span id="AsyncFilter-95"><a href="#AsyncFilter-95"><span class="linenos"> 95</span></a>
</span><span id="AsyncFilter-96"><a href="#AsyncFilter-96"><span class="linenos"> 96</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_skip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="AsyncFilter-97"><a href="#AsyncFilter-97"><span class="linenos"> 97</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AsyncFilter-98"><a href="#AsyncFilter-98"><span class="linenos"> 98</span></a><span class="sd">        Check if the document should be skipped by this filter.</span>
</span><span id="AsyncFilter-99"><a href="#AsyncFilter-99"><span class="linenos"> 99</span></a><span class="sd">        If `skip_rejected` is set to `True`, this method will return `True`</span>
</span><span id="AsyncFilter-100"><a href="#AsyncFilter-100"><span class="linenos">100</span></a><span class="sd">        if the document is already rejected.</span>
</span><span id="AsyncFilter-101"><a href="#AsyncFilter-101"><span class="linenos">101</span></a><span class="sd">        If `p` is less than 1, this method will return `True` with a probability of `1 - p`.</span>
</span><span id="AsyncFilter-102"><a href="#AsyncFilter-102"><span class="linenos">102</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AsyncFilter-103"><a href="#AsyncFilter-103"><span class="linenos">103</span></a>        <span class="n">skip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_rejected</span> <span class="ow">and</span> <span class="n">document</span><span class="o">.</span><span class="n">is_rejected</span>
</span><span id="AsyncFilter-104"><a href="#AsyncFilter-104"><span class="linenos">104</span></a>        <span class="k">if</span> <span class="n">skip</span><span class="p">:</span>
</span><span id="AsyncFilter-105"><a href="#AsyncFilter-105"><span class="linenos">105</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="AsyncFilter-106"><a href="#AsyncFilter-106"><span class="linenos">106</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="AsyncFilter-107"><a href="#AsyncFilter-107"><span class="linenos">107</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">:</span>
</span><span id="AsyncFilter-108"><a href="#AsyncFilter-108"><span class="linenos">108</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="AsyncFilter-109"><a href="#AsyncFilter-109"><span class="linenos">109</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="AsyncFilter-110"><a href="#AsyncFilter-110"><span class="linenos">110</span></a>
</span><span id="AsyncFilter-111"><a href="#AsyncFilter-111"><span class="linenos">111</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Document</span><span class="p">:</span>
</span><span id="AsyncFilter-112"><a href="#AsyncFilter-112"><span class="linenos">112</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="n">get_doc_info</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="AsyncFilter-113"><a href="#AsyncFilter-113"><span class="linenos">113</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_skip</span><span class="p">(</span><span class="n">document</span><span class="p">):</span>
</span><span id="AsyncFilter-114"><a href="#AsyncFilter-114"><span class="linenos">114</span></a>            <span class="n">document</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="AsyncFilter-115"><a href="#AsyncFilter-115"><span class="linenos">115</span></a>        <span class="n">new_stats</span> <span class="o">=</span> <span class="n">get_doc_info</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="AsyncFilter-116"><a href="#AsyncFilter-116"><span class="linenos">116</span></a>        <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stats_lock</span><span class="p">:</span>
</span><span id="AsyncFilter-117"><a href="#AsyncFilter-117"><span class="linenos">117</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_statistics</span><span class="o">.</span><span class="n">update_by_diff</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="n">new_stats</span><span class="p">)</span>
</span><span id="AsyncFilter-118"><a href="#AsyncFilter-118"><span class="linenos">118</span></a>
</span><span id="AsyncFilter-119"><a href="#AsyncFilter-119"><span class="linenos">119</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;is_rejected&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">new_stats</span><span class="p">[</span><span class="s2">&quot;is_rejected&quot;</span><span class="p">]:</span>
</span><span id="AsyncFilter-120"><a href="#AsyncFilter-120"><span class="linenos">120</span></a>            <span class="n">document</span><span class="o">.</span><span class="n">reject_reason</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_jsonable_vars</span><span class="p">()</span>
</span><span id="AsyncFilter-121"><a href="#AsyncFilter-121"><span class="linenos">121</span></a>        <span class="k">return</span> <span class="n">document</span>
</span><span id="AsyncFilter-122"><a href="#AsyncFilter-122"><span class="linenos">122</span></a>
</span><span id="AsyncFilter-123"><a href="#AsyncFilter-123"><span class="linenos">123</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">apply_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Document</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Document</span><span class="p">]:</span>
</span><span id="AsyncFilter-124"><a href="#AsyncFilter-124"><span class="linenos">124</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AsyncFilter-125"><a href="#AsyncFilter-125"><span class="linenos">125</span></a><span class="sd">        Apply the filter to a Sequence of documents.</span>
</span><span id="AsyncFilter-126"><a href="#AsyncFilter-126"><span class="linenos">126</span></a><span class="sd">        By default, the processing implemented in `apply` is executed asynchronously and concurrently.</span>
</span><span id="AsyncFilter-127"><a href="#AsyncFilter-127"><span class="linenos">127</span></a><span class="sd">        If the filter processing can be optimized for batch processing, override this method.</span>
</span><span id="AsyncFilter-128"><a href="#AsyncFilter-128"><span class="linenos">128</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AsyncFilter-129"><a href="#AsyncFilter-129"><span class="linenos">129</span></a>        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">]</span>
</span><span id="AsyncFilter-130"><a href="#AsyncFilter-130"><span class="linenos">130</span></a>        <span class="k">return</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>
</span><span id="AsyncFilter-131"><a href="#AsyncFilter-131"><span class="linenos">131</span></a>
</span><span id="AsyncFilter-132"><a href="#AsyncFilter-132"><span class="linenos">132</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_apply_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Document</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Document</span><span class="p">]:</span>
</span><span id="AsyncFilter-133"><a href="#AsyncFilter-133"><span class="linenos">133</span></a>        <span class="n">skip</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="AsyncFilter-134"><a href="#AsyncFilter-134"><span class="linenos">134</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="AsyncFilter-135"><a href="#AsyncFilter-135"><span class="linenos">135</span></a>            <span class="n">skip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>
</span><span id="AsyncFilter-136"><a href="#AsyncFilter-136"><span class="linenos">136</span></a>
</span><span id="AsyncFilter-137"><a href="#AsyncFilter-137"><span class="linenos">137</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_doc_info</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">]</span>
</span><span id="AsyncFilter-138"><a href="#AsyncFilter-138"><span class="linenos">138</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">skip</span><span class="p">:</span>
</span><span id="AsyncFilter-139"><a href="#AsyncFilter-139"><span class="linenos">139</span></a>            <span class="n">batch</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_batch</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
</span><span id="AsyncFilter-140"><a href="#AsyncFilter-140"><span class="linenos">140</span></a>        <span class="n">batch</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finalize_batch</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">stats</span><span class="p">)</span>
</span><span id="AsyncFilter-141"><a href="#AsyncFilter-141"><span class="linenos">141</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
</span><span id="AsyncFilter-142"><a href="#AsyncFilter-142"><span class="linenos">142</span></a>
</span><span id="AsyncFilter-143"><a href="#AsyncFilter-143"><span class="linenos">143</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">apply_stream</span><span class="p">(</span>
</span><span id="AsyncFilter-144"><a href="#AsyncFilter-144"><span class="linenos">144</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="AsyncFilter-145"><a href="#AsyncFilter-145"><span class="linenos">145</span></a>        <span class="n">stream</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Document</span><span class="p">]</span> <span class="o">|</span> <span class="n">AsyncIterable</span><span class="p">[</span><span class="n">Document</span><span class="p">],</span>
</span><span id="AsyncFilter-146"><a href="#AsyncFilter-146"><span class="linenos">146</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncGenerator</span><span class="p">[</span><span class="n">Document</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
</span><span id="AsyncFilter-147"><a href="#AsyncFilter-147"><span class="linenos">147</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AsyncFilter-148"><a href="#AsyncFilter-148"><span class="linenos">148</span></a><span class="sd">        Apply the filter to a stream of documents (Iterable or AsyncIterable).</span>
</span><span id="AsyncFilter-149"><a href="#AsyncFilter-149"><span class="linenos">149</span></a><span class="sd">        If use_batch is set to `True` at initialization, the filter will process documents in batches.</span>
</span><span id="AsyncFilter-150"><a href="#AsyncFilter-150"><span class="linenos">150</span></a><span class="sd">        If the stream is not asynchronous, use handle_stream_as_async to convert it to an asynchronous stream.</span>
</span><span id="AsyncFilter-151"><a href="#AsyncFilter-151"><span class="linenos">151</span></a>
</span><span id="AsyncFilter-152"><a href="#AsyncFilter-152"><span class="linenos">152</span></a><span class="sd">        Even if an exception occurs during processing, the process will continue, and the following actions will be taken:</span>
</span><span id="AsyncFilter-153"><a href="#AsyncFilter-153"><span class="linenos">153</span></a><span class="sd">        - Set the `is_rejected` flag of the document to `True`</span>
</span><span id="AsyncFilter-154"><a href="#AsyncFilter-154"><span class="linenos">154</span></a><span class="sd">        - Set the error details in `reject_reason`</span>
</span><span id="AsyncFilter-155"><a href="#AsyncFilter-155"><span class="linenos">155</span></a><span class="sd">        - Increment the `errors` count in the statistics retrievable via `get_statistics`</span>
</span><span id="AsyncFilter-156"><a href="#AsyncFilter-156"><span class="linenos">156</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AsyncFilter-157"><a href="#AsyncFilter-157"><span class="linenos">157</span></a>        <span class="n">async_stream</span><span class="p">:</span> <span class="n">AsyncIterable</span><span class="p">[</span><span class="n">Document</span><span class="p">]</span> <span class="o">=</span> <span class="n">handle_stream_as_async</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
</span><span id="AsyncFilter-158"><a href="#AsyncFilter-158"><span class="linenos">158</span></a>
</span><span id="AsyncFilter-159"><a href="#AsyncFilter-159"><span class="linenos">159</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_batch</span><span class="p">:</span>
</span><span id="AsyncFilter-160"><a href="#AsyncFilter-160"><span class="linenos">160</span></a>            <span class="k">async</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">async_stream</span><span class="p">:</span>
</span><span id="AsyncFilter-161"><a href="#AsyncFilter-161"><span class="linenos">161</span></a>                <span class="k">yield</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_try_process</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply</span><span class="p">)</span>
</span><span id="AsyncFilter-162"><a href="#AsyncFilter-162"><span class="linenos">162</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="AsyncFilter-163"><a href="#AsyncFilter-163"><span class="linenos">163</span></a>            <span class="n">batch</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Document</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AsyncFilter-164"><a href="#AsyncFilter-164"><span class="linenos">164</span></a>            <span class="k">async</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">async_stream</span><span class="p">:</span>
</span><span id="AsyncFilter-165"><a href="#AsyncFilter-165"><span class="linenos">165</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_skip</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
</span><span id="AsyncFilter-166"><a href="#AsyncFilter-166"><span class="linenos">166</span></a>                    <span class="k">yield</span> <span class="n">doc</span>
</span><span id="AsyncFilter-167"><a href="#AsyncFilter-167"><span class="linenos">167</span></a>                    <span class="k">continue</span>
</span><span id="AsyncFilter-168"><a href="#AsyncFilter-168"><span class="linenos">168</span></a>
</span><span id="AsyncFilter-169"><a href="#AsyncFilter-169"><span class="linenos">169</span></a>                <span class="n">batch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
</span><span id="AsyncFilter-170"><a href="#AsyncFilter-170"><span class="linenos">170</span></a>                <span class="c1"># Batch size reached, apply batch</span>
</span><span id="AsyncFilter-171"><a href="#AsyncFilter-171"><span class="linenos">171</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">:</span>
</span><span id="AsyncFilter-172"><a href="#AsyncFilter-172"><span class="linenos">172</span></a>                    <span class="n">stats</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_doc_info</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">]</span>
</span><span id="AsyncFilter-173"><a href="#AsyncFilter-173"><span class="linenos">173</span></a>                    <span class="n">batch</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_try_process</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_batch</span><span class="p">)</span>
</span><span id="AsyncFilter-174"><a href="#AsyncFilter-174"><span class="linenos">174</span></a>                    <span class="n">batch</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finalize_batch</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">stats</span><span class="p">)</span>
</span><span id="AsyncFilter-175"><a href="#AsyncFilter-175"><span class="linenos">175</span></a>                    <span class="k">for</span> <span class="n">out</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">:</span>
</span><span id="AsyncFilter-176"><a href="#AsyncFilter-176"><span class="linenos">176</span></a>                        <span class="k">yield</span> <span class="n">out</span>
</span><span id="AsyncFilter-177"><a href="#AsyncFilter-177"><span class="linenos">177</span></a>                    <span class="n">batch</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="AsyncFilter-178"><a href="#AsyncFilter-178"><span class="linenos">178</span></a>
</span><span id="AsyncFilter-179"><a href="#AsyncFilter-179"><span class="linenos">179</span></a>            <span class="c1"># Flush remaining documents in the batch</span>
</span><span id="AsyncFilter-180"><a href="#AsyncFilter-180"><span class="linenos">180</span></a>            <span class="k">if</span> <span class="n">batch</span><span class="p">:</span>
</span><span id="AsyncFilter-181"><a href="#AsyncFilter-181"><span class="linenos">181</span></a>                <span class="n">stats</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_doc_info</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">]</span>
</span><span id="AsyncFilter-182"><a href="#AsyncFilter-182"><span class="linenos">182</span></a>                <span class="n">batch</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_try_process</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_batch</span><span class="p">)</span>
</span><span id="AsyncFilter-183"><a href="#AsyncFilter-183"><span class="linenos">183</span></a>                <span class="n">batch</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finalize_batch</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">stats</span><span class="p">)</span>
</span><span id="AsyncFilter-184"><a href="#AsyncFilter-184"><span class="linenos">184</span></a>                <span class="k">for</span> <span class="n">out</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">:</span>
</span><span id="AsyncFilter-185"><a href="#AsyncFilter-185"><span class="linenos">185</span></a>                    <span class="k">yield</span> <span class="n">out</span>
</span><span id="AsyncFilter-186"><a href="#AsyncFilter-186"><span class="linenos">186</span></a>
</span><span id="AsyncFilter-187"><a href="#AsyncFilter-187"><span class="linenos">187</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_try_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">T</span><span class="p">],</span> <span class="n">Awaitable</span><span class="p">[</span><span class="n">T</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
</span><span id="AsyncFilter-188"><a href="#AsyncFilter-188"><span class="linenos">188</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AsyncFilter-189"><a href="#AsyncFilter-189"><span class="linenos">189</span></a>            <span class="k">return</span> <span class="k">await</span> <span class="n">func</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</span><span id="AsyncFilter-190"><a href="#AsyncFilter-190"><span class="linenos">190</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AsyncFilter-191"><a href="#AsyncFilter-191"><span class="linenos">191</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">Document</span><span class="p">):</span>
</span><span id="AsyncFilter-192"><a href="#AsyncFilter-192"><span class="linenos">192</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="si">!r}</span><span class="s2"> occurs while processing </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="n">target</span><span class="si">!r}</span><span class="s2">&quot;</span>
</span><span id="AsyncFilter-193"><a href="#AsyncFilter-193"><span class="linenos">193</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="AsyncFilter-194"><a href="#AsyncFilter-194"><span class="linenos">194</span></a>                <span class="n">target</span><span class="o">.</span><span class="n">is_rejected</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="AsyncFilter-195"><a href="#AsyncFilter-195"><span class="linenos">195</span></a>                <span class="n">target</span><span class="o">.</span><span class="n">reject_reason</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="p">}</span>
</span><span id="AsyncFilter-196"><a href="#AsyncFilter-196"><span class="linenos">196</span></a>                <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stats_lock</span><span class="p">:</span>
</span><span id="AsyncFilter-197"><a href="#AsyncFilter-197"><span class="linenos">197</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_statistics</span><span class="o">.</span><span class="n">errors</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="AsyncFilter-198"><a href="#AsyncFilter-198"><span class="linenos">198</span></a>                <span class="k">return</span> <span class="n">target</span>  <span class="c1"># type: ignore[return-value]</span>
</span><span id="AsyncFilter-199"><a href="#AsyncFilter-199"><span class="linenos">199</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="AsyncFilter-200"><a href="#AsyncFilter-200"><span class="linenos">200</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="si">!r}</span><span class="s2"> occurs while batch processing </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AsyncFilter-201"><a href="#AsyncFilter-201"><span class="linenos">201</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="AsyncFilter-202"><a href="#AsyncFilter-202"><span class="linenos">202</span></a>                <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">target</span><span class="p">:</span>
</span><span id="AsyncFilter-203"><a href="#AsyncFilter-203"><span class="linenos">203</span></a>                    <span class="n">doc</span><span class="o">.</span><span class="n">is_rejected</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="AsyncFilter-204"><a href="#AsyncFilter-204"><span class="linenos">204</span></a>                    <span class="n">doc</span><span class="o">.</span><span class="n">reject_reason</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="p">}</span>
</span><span id="AsyncFilter-205"><a href="#AsyncFilter-205"><span class="linenos">205</span></a>                <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stats_lock</span><span class="p">:</span>
</span><span id="AsyncFilter-206"><a href="#AsyncFilter-206"><span class="linenos">206</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_statistics</span><span class="o">.</span><span class="n">errors</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</span><span id="AsyncFilter-207"><a href="#AsyncFilter-207"><span class="linenos">207</span></a>                <span class="k">return</span> <span class="n">target</span>  <span class="c1"># type: ignore[return-value]</span>
</span><span id="AsyncFilter-208"><a href="#AsyncFilter-208"><span class="linenos">208</span></a>            <span class="k">raise</span> <span class="n">e</span>
</span><span id="AsyncFilter-209"><a href="#AsyncFilter-209"><span class="linenos">209</span></a>
</span><span id="AsyncFilter-210"><a href="#AsyncFilter-210"><span class="linenos">210</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AsyncFilter-211"><a href="#AsyncFilter-211"><span class="linenos">211</span></a>        <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">)</span>
</span><span id="AsyncFilter-212"><a href="#AsyncFilter-212"><span class="linenos">212</span></a>        <span class="k">return</span> <span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply</span><span class="p">(</span><span class="n">document</span><span class="p">))</span><span class="o">.</span><span class="n">text</span>
</span><span id="AsyncFilter-213"><a href="#AsyncFilter-213"><span class="linenos">213</span></a>
</span><span id="AsyncFilter-214"><a href="#AsyncFilter-214"><span class="linenos">214</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Statistics</span><span class="p">:</span>
</span><span id="AsyncFilter-215"><a href="#AsyncFilter-215"><span class="linenos">215</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AsyncFilter-216"><a href="#AsyncFilter-216"><span class="linenos">216</span></a><span class="sd">        Get the statistics of this filter.</span>
</span><span id="AsyncFilter-217"><a href="#AsyncFilter-217"><span class="linenos">217</span></a><span class="sd">        Returns:</span>
</span><span id="AsyncFilter-218"><a href="#AsyncFilter-218"><span class="linenos">218</span></a><span class="sd">            Statistics: The statistics of this filter.</span>
</span><span id="AsyncFilter-219"><a href="#AsyncFilter-219"><span class="linenos">219</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AsyncFilter-220"><a href="#AsyncFilter-220"><span class="linenos">220</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_statistics</span>
</span><span id="AsyncFilter-221"><a href="#AsyncFilter-221"><span class="linenos">221</span></a>
</span><span id="AsyncFilter-222"><a href="#AsyncFilter-222"><span class="linenos">222</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_statistics_map</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Statistics</span><span class="p">]:</span>
</span><span id="AsyncFilter-223"><a href="#AsyncFilter-223"><span class="linenos">223</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AsyncFilter-224"><a href="#AsyncFilter-224"><span class="linenos">224</span></a><span class="sd">        Get the statistics of this filter as a dictionary.</span>
</span><span id="AsyncFilter-225"><a href="#AsyncFilter-225"><span class="linenos">225</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AsyncFilter-226"><a href="#AsyncFilter-226"><span class="linenos">226</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_statistics</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="AsyncFilter-227"><a href="#AsyncFilter-227"><span class="linenos">227</span></a>
</span><span id="AsyncFilter-228"><a href="#AsyncFilter-228"><span class="linenos">228</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AsyncFilter-229"><a href="#AsyncFilter-229"><span class="linenos">229</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AsyncFilter-230"><a href="#AsyncFilter-230"><span class="linenos">230</span></a><span class="sd">        You can override this method to release resources or perform cleanup tasks.</span>
</span><span id="AsyncFilter-231"><a href="#AsyncFilter-231"><span class="linenos">231</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AsyncFilter-232"><a href="#AsyncFilter-232"><span class="linenos">232</span></a>        <span class="k">pass</span>
</span><span id="AsyncFilter-233"><a href="#AsyncFilter-233"><span class="linenos">233</span></a>
</span><span id="AsyncFilter-234"><a href="#AsyncFilter-234"><span class="linenos">234</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="fm">__aenter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;AsyncFilter&quot;</span><span class="p">:</span>
</span><span id="AsyncFilter-235"><a href="#AsyncFilter-235"><span class="linenos">235</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="AsyncFilter-236"><a href="#AsyncFilter-236"><span class="linenos">236</span></a>
</span><span id="AsyncFilter-237"><a href="#AsyncFilter-237"><span class="linenos">237</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="fm">__aexit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">traceback</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AsyncFilter-238"><a href="#AsyncFilter-238"><span class="linenos">238</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</span><span id="AsyncFilter-239"><a href="#AsyncFilter-239"><span class="linenos">239</span></a>
</span><span id="AsyncFilter-240"><a href="#AsyncFilter-240"><span class="linenos">240</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_jsonable_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exclude_keys</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="AsyncFilter-241"><a href="#AsyncFilter-241"><span class="linenos">241</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AsyncFilter-242"><a href="#AsyncFilter-242"><span class="linenos">242</span></a><span class="sd">        Get the member variable of this filter.</span>
</span><span id="AsyncFilter-243"><a href="#AsyncFilter-243"><span class="linenos">243</span></a><span class="sd">        Eligible variables are primitive types; [bool, int, float, str, None],</span>
</span><span id="AsyncFilter-244"><a href="#AsyncFilter-244"><span class="linenos">244</span></a><span class="sd">        and the name of the variable not starts with the underscore; `_`.</span>
</span><span id="AsyncFilter-245"><a href="#AsyncFilter-245"><span class="linenos">245</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AsyncFilter-246"><a href="#AsyncFilter-246"><span class="linenos">246</span></a>        <span class="k">if</span> <span class="n">exclude_keys</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AsyncFilter-247"><a href="#AsyncFilter-247"><span class="linenos">247</span></a>            <span class="n">exclude_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="AsyncFilter-248"><a href="#AsyncFilter-248"><span class="linenos">248</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="AsyncFilter-249"><a href="#AsyncFilter-249"><span class="linenos">249</span></a>            <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
</span><span id="AsyncFilter-250"><a href="#AsyncFilter-250"><span class="linenos">250</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="AsyncFilter-251"><a href="#AsyncFilter-251"><span class="linenos">251</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">_is_jsonable</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude_keys</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)))</span>
</span><span id="AsyncFilter-252"><a href="#AsyncFilter-252"><span class="linenos">252</span></a>        <span class="p">}</span>
</span><span id="AsyncFilter-253"><a href="#AsyncFilter-253"><span class="linenos">253</span></a>
</span><span id="AsyncFilter-254"><a href="#AsyncFilter-254"><span class="linenos">254</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_finalize_batch</span><span class="p">(</span>
</span><span id="AsyncFilter-255"><a href="#AsyncFilter-255"><span class="linenos">255</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="AsyncFilter-256"><a href="#AsyncFilter-256"><span class="linenos">256</span></a>        <span class="n">batch</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Document</span><span class="p">],</span>
</span><span id="AsyncFilter-257"><a href="#AsyncFilter-257"><span class="linenos">257</span></a>        <span class="n">old_stats</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
</span><span id="AsyncFilter-258"><a href="#AsyncFilter-258"><span class="linenos">258</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Document</span><span class="p">]:</span>
</span><span id="AsyncFilter-259"><a href="#AsyncFilter-259"><span class="linenos">259</span></a>        <span class="n">new_stats</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_doc_info</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">]</span>
</span><span id="AsyncFilter-260"><a href="#AsyncFilter-260"><span class="linenos">260</span></a>        <span class="k">for</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">old_stats</span><span class="p">,</span> <span class="n">new_stats</span><span class="p">,</span> <span class="n">batch</span><span class="p">):</span>
</span><span id="AsyncFilter-261"><a href="#AsyncFilter-261"><span class="linenos">261</span></a>            <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stats_lock</span><span class="p">:</span>
</span><span id="AsyncFilter-262"><a href="#AsyncFilter-262"><span class="linenos">262</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_statistics</span><span class="o">.</span><span class="n">update_by_diff</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
</span><span id="AsyncFilter-263"><a href="#AsyncFilter-263"><span class="linenos">263</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">old</span><span class="p">[</span><span class="s2">&quot;is_rejected&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">new</span><span class="p">[</span><span class="s2">&quot;is_rejected&quot;</span><span class="p">]:</span>
</span><span id="AsyncFilter-264"><a href="#AsyncFilter-264"><span class="linenos">264</span></a>                <span class="n">doc</span><span class="o">.</span><span class="n">reject_reason</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_jsonable_vars</span><span class="p">()</span>
</span><span id="AsyncFilter-265"><a href="#AsyncFilter-265"><span class="linenos">265</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
</span><span id="AsyncFilter-266"><a href="#AsyncFilter-266"><span class="linenos">266</span></a>
</span><span id="AsyncFilter-267"><a href="#AsyncFilter-267"><span class="linenos">267</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">__init_rng</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">Generator</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AsyncFilter-268"><a href="#AsyncFilter-268"><span class="linenos">268</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_owns_rng</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="AsyncFilter-269"><a href="#AsyncFilter-269"><span class="linenos">269</span></a>        <span class="k">if</span> <span class="n">random_state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AsyncFilter-270"><a href="#AsyncFilter-270"><span class="linenos">270</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">()</span>
</span><span id="AsyncFilter-271"><a href="#AsyncFilter-271"><span class="linenos">271</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_owns_rng</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="AsyncFilter-272"><a href="#AsyncFilter-272"><span class="linenos">272</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">random_state</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="AsyncFilter-273"><a href="#AsyncFilter-273"><span class="linenos">273</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span>
</span><span id="AsyncFilter-274"><a href="#AsyncFilter-274"><span class="linenos">274</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">random_state</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">Generator</span><span class="p">):</span>
</span><span id="AsyncFilter-275"><a href="#AsyncFilter-275"><span class="linenos">275</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span> <span class="o">=</span> <span class="n">random_state</span>
</span><span id="AsyncFilter-276"><a href="#AsyncFilter-276"><span class="linenos">276</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="AsyncFilter-277"><a href="#AsyncFilter-277"><span class="linenos">277</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="AsyncFilter-278"><a href="#AsyncFilter-278"><span class="linenos">278</span></a>                <span class="sa">f</span><span class="s2">&quot;random_state must be int or np.random.Generator, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AsyncFilter-279"><a href="#AsyncFilter-279"><span class="linenos">279</span></a>            <span class="p">)</span>
</span><span id="AsyncFilter-280"><a href="#AsyncFilter-280"><span class="linenos">280</span></a>
</span><span id="AsyncFilter-281"><a href="#AsyncFilter-281"><span class="linenos">281</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_set_rng_if_not_initialized</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rng</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">Generator</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AsyncFilter-282"><a href="#AsyncFilter-282"><span class="linenos">282</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AsyncFilter-283"><a href="#AsyncFilter-283"><span class="linenos">283</span></a><span class="sd">        Set the random number generator for this filter if it is not already initialized.</span>
</span><span id="AsyncFilter-284"><a href="#AsyncFilter-284"><span class="linenos">284</span></a><span class="sd">        This method is called by Compose class.</span>
</span><span id="AsyncFilter-285"><a href="#AsyncFilter-285"><span class="linenos">285</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AsyncFilter-286"><a href="#AsyncFilter-286"><span class="linenos">286</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owns_rng</span><span class="p">:</span>
</span><span id="AsyncFilter-287"><a href="#AsyncFilter-287"><span class="linenos">287</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span> <span class="o">=</span> <span class="n">rng</span>
</span></pre></div>


            <div class="docstring"><p>Helper class that provides a standard way to create an ABC using
inheritance.</p>
</div>


                            <div id="AsyncFilter.__init__" class="classattr">
                                        <input id="AsyncFilter.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">AsyncFilter</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">p</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>,</span><span class="param">	<span class="n">skip_rejected</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">_generator</span><span class="o">.</span><span class="n">Generator</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">use_batch</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span></span>)</span>

                <label class="view-source-button" for="AsyncFilter.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AsyncFilter.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AsyncFilter.__init__-35"><a href="#AsyncFilter.__init__-35"><span class="linenos">35</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="AsyncFilter.__init__-36"><a href="#AsyncFilter.__init__-36"><span class="linenos">36</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="AsyncFilter.__init__-37"><a href="#AsyncFilter.__init__-37"><span class="linenos">37</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="AsyncFilter.__init__-38"><a href="#AsyncFilter.__init__-38"><span class="linenos">38</span></a>        <span class="n">p</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="AsyncFilter.__init__-39"><a href="#AsyncFilter.__init__-39"><span class="linenos">39</span></a>        <span class="n">skip_rejected</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="AsyncFilter.__init__-40"><a href="#AsyncFilter.__init__-40"><span class="linenos">40</span></a>        <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">Generator</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AsyncFilter.__init__-41"><a href="#AsyncFilter.__init__-41"><span class="linenos">41</span></a>        <span class="n">use_batch</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="AsyncFilter.__init__-42"><a href="#AsyncFilter.__init__-42"><span class="linenos">42</span></a>        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
</span><span id="AsyncFilter.__init__-43"><a href="#AsyncFilter.__init__-43"><span class="linenos">43</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="AsyncFilter.__init__-44"><a href="#AsyncFilter.__init__-44"><span class="linenos">44</span></a>    <span class="p">):</span>
</span><span id="AsyncFilter.__init__-45"><a href="#AsyncFilter.__init__-45"><span class="linenos">45</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AsyncFilter.__init__-46"><a href="#AsyncFilter.__init__-46"><span class="linenos">46</span></a><span class="sd">        Base class for asynchronous filters.</span>
</span><span id="AsyncFilter.__init__-47"><a href="#AsyncFilter.__init__-47"><span class="linenos">47</span></a>
</span><span id="AsyncFilter.__init__-48"><a href="#AsyncFilter.__init__-48"><span class="linenos">48</span></a><span class="sd">        Parameters</span>
</span><span id="AsyncFilter.__init__-49"><a href="#AsyncFilter.__init__-49"><span class="linenos">49</span></a><span class="sd">        ----------</span>
</span><span id="AsyncFilter.__init__-50"><a href="#AsyncFilter.__init__-50"><span class="linenos">50</span></a><span class="sd">        p : float</span>
</span><span id="AsyncFilter.__init__-51"><a href="#AsyncFilter.__init__-51"><span class="linenos">51</span></a><span class="sd">            The probability of applying the filter.</span>
</span><span id="AsyncFilter.__init__-52"><a href="#AsyncFilter.__init__-52"><span class="linenos">52</span></a><span class="sd">            If `p` is 1, the filter will always be applied.</span>
</span><span id="AsyncFilter.__init__-53"><a href="#AsyncFilter.__init__-53"><span class="linenos">53</span></a><span class="sd">        skip_rejected : bool</span>
</span><span id="AsyncFilter.__init__-54"><a href="#AsyncFilter.__init__-54"><span class="linenos">54</span></a><span class="sd">            If `True`, the filter will skip documents that are already rejected.</span>
</span><span id="AsyncFilter.__init__-55"><a href="#AsyncFilter.__init__-55"><span class="linenos">55</span></a><span class="sd">            If you want to apply the filter to all documents (e.g., postprocess), set this to `False`.</span>
</span><span id="AsyncFilter.__init__-56"><a href="#AsyncFilter.__init__-56"><span class="linenos">56</span></a><span class="sd">        random_state : Optional[Union[int, np.random.Generator]]</span>
</span><span id="AsyncFilter.__init__-57"><a href="#AsyncFilter.__init__-57"><span class="linenos">57</span></a><span class="sd">            Seed for the random number generator.</span>
</span><span id="AsyncFilter.__init__-58"><a href="#AsyncFilter.__init__-58"><span class="linenos">58</span></a><span class="sd">            If `None` is specified, the random number generator managed by the Compose class will be used.</span>
</span><span id="AsyncFilter.__init__-59"><a href="#AsyncFilter.__init__-59"><span class="linenos">59</span></a><span class="sd">        use_batch : bool</span>
</span><span id="AsyncFilter.__init__-60"><a href="#AsyncFilter.__init__-60"><span class="linenos">60</span></a><span class="sd">            If `True`, the filter will process documents in batches in the `apply_stream` method.</span>
</span><span id="AsyncFilter.__init__-61"><a href="#AsyncFilter.__init__-61"><span class="linenos">61</span></a><span class="sd">        batch_size : int</span>
</span><span id="AsyncFilter.__init__-62"><a href="#AsyncFilter.__init__-62"><span class="linenos">62</span></a><span class="sd">            The size of the batch to process documents in the `apply_stream` method.</span>
</span><span id="AsyncFilter.__init__-63"><a href="#AsyncFilter.__init__-63"><span class="linenos">63</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AsyncFilter.__init__-64"><a href="#AsyncFilter.__init__-64"><span class="linenos">64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="AsyncFilter.__init__-65"><a href="#AsyncFilter.__init__-65"><span class="linenos">65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__module__</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AsyncFilter.__init__-66"><a href="#AsyncFilter.__init__-66"><span class="linenos">66</span></a>        <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">p</span> <span class="o">&lt;=</span> <span class="mi">1</span>
</span><span id="AsyncFilter.__init__-67"><a href="#AsyncFilter.__init__-67"><span class="linenos">67</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
</span><span id="AsyncFilter.__init__-68"><a href="#AsyncFilter.__init__-68"><span class="linenos">68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__init_rng</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span>
</span><span id="AsyncFilter.__init__-69"><a href="#AsyncFilter.__init__-69"><span class="linenos">69</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">skip_rejected</span> <span class="o">=</span> <span class="n">skip_rejected</span>
</span><span id="AsyncFilter.__init__-70"><a href="#AsyncFilter.__init__-70"><span class="linenos">70</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">use_batch</span> <span class="o">=</span> <span class="n">use_batch</span>
</span><span id="AsyncFilter.__init__-71"><a href="#AsyncFilter.__init__-71"><span class="linenos">71</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">batch_size</span>
</span><span id="AsyncFilter.__init__-72"><a href="#AsyncFilter.__init__-72"><span class="linenos">72</span></a>
</span><span id="AsyncFilter.__init__-73"><a href="#AsyncFilter.__init__-73"><span class="linenos">73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_statistics</span> <span class="o">=</span> <span class="n">Statistics</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="AsyncFilter.__init__-74"><a href="#AsyncFilter.__init__-74"><span class="linenos">74</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stats_lock</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Base class for asynchronous filters.</p>

<h2 id="parameters">Parameters</h2>

<p>p : float
    The probability of applying the filter.
    If <code>p</code> is 1, the filter will always be applied.
skip_rejected : bool
    If <code>True</code>, the filter will skip documents that are already rejected.
    If you want to apply the filter to all documents (e.g., postprocess), set this to <code>False</code>.
random_state : Optional[Union[int, np.random.Generator]]
    Seed for the random number generator.
    If <code>None</code> is specified, the random number generator managed by the Compose class will be used.
use_batch : bool
    If <code>True</code>, the filter will process documents in batches in the <code><a href="#AsyncFilter.apply_stream">apply_stream</a></code> method.
batch_size : int
    The size of the batch to process documents in the <code><a href="#AsyncFilter.apply_stream">apply_stream</a></code> method.</p>
</div>


                            </div>
                            <div id="AsyncFilter.apply" class="classattr">
                                        <input id="AsyncFilter.apply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abstractmethod</div>

        <span class="def">async def</span>
        <span class="name">apply</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">document</span><span class="p">:</span> <span class="n"><a href="#Document">hojichar.Document</a></span></span><span class="return-annotation">) -> <span class="n"><a href="#Document">hojichar.Document</a></span>:</span></span>

                <label class="view-source-button" for="AsyncFilter.apply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AsyncFilter.apply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AsyncFilter.apply-76"><a href="#AsyncFilter.apply-76"><span class="linenos">76</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="AsyncFilter.apply-77"><a href="#AsyncFilter.apply-77"><span class="linenos">77</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Document</span><span class="p">:</span>
</span><span id="AsyncFilter.apply-78"><a href="#AsyncFilter.apply-78"><span class="linenos">78</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AsyncFilter.apply-79"><a href="#AsyncFilter.apply-79"><span class="linenos">79</span></a><span class="sd">        Definition of async filter behavior.</span>
</span><span id="AsyncFilter.apply-80"><a href="#AsyncFilter.apply-80"><span class="linenos">80</span></a>
</span><span id="AsyncFilter.apply-81"><a href="#AsyncFilter.apply-81"><span class="linenos">81</span></a><span class="sd">        In this method, the filter will modify `document.text` or</span>
</span><span id="AsyncFilter.apply-82"><a href="#AsyncFilter.apply-82"><span class="linenos">82</span></a><span class="sd">        `document.extras` and set `document.is_rejected = True` to discard the document.</span>
</span><span id="AsyncFilter.apply-83"><a href="#AsyncFilter.apply-83"><span class="linenos">83</span></a>
</span><span id="AsyncFilter.apply-84"><a href="#AsyncFilter.apply-84"><span class="linenos">84</span></a><span class="sd">        Parameters</span>
</span><span id="AsyncFilter.apply-85"><a href="#AsyncFilter.apply-85"><span class="linenos">85</span></a><span class="sd">        ----------</span>
</span><span id="AsyncFilter.apply-86"><a href="#AsyncFilter.apply-86"><span class="linenos">86</span></a><span class="sd">        document : Document</span>
</span><span id="AsyncFilter.apply-87"><a href="#AsyncFilter.apply-87"><span class="linenos">87</span></a><span class="sd">            Input document</span>
</span><span id="AsyncFilter.apply-88"><a href="#AsyncFilter.apply-88"><span class="linenos">88</span></a>
</span><span id="AsyncFilter.apply-89"><a href="#AsyncFilter.apply-89"><span class="linenos">89</span></a><span class="sd">        Returns</span>
</span><span id="AsyncFilter.apply-90"><a href="#AsyncFilter.apply-90"><span class="linenos">90</span></a><span class="sd">        -------</span>
</span><span id="AsyncFilter.apply-91"><a href="#AsyncFilter.apply-91"><span class="linenos">91</span></a><span class="sd">        Document</span>
</span><span id="AsyncFilter.apply-92"><a href="#AsyncFilter.apply-92"><span class="linenos">92</span></a><span class="sd">            Processed Document</span>
</span><span id="AsyncFilter.apply-93"><a href="#AsyncFilter.apply-93"><span class="linenos">93</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AsyncFilter.apply-94"><a href="#AsyncFilter.apply-94"><span class="linenos">94</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Definition of async filter behavior.</p>

<p>In this method, the filter will modify <code>document.text</code> or
<code>document.extras</code> and set <code>document.is_rejected = True</code> to discard the document.</p>

<h2 id="parameters">Parameters</h2>

<p>document : Document
    Input document</p>

<h2 id="returns">Returns</h2>

<p>Document
    Processed Document</p>
</div>


                            </div>
                            <div id="AsyncFilter.apply_batch" class="classattr">
                                        <input id="AsyncFilter.apply_batch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">apply_batch</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">batch</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n"><a href="#Document">hojichar.Document</a></span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="#Document">hojichar.Document</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="AsyncFilter.apply_batch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AsyncFilter.apply_batch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AsyncFilter.apply_batch-123"><a href="#AsyncFilter.apply_batch-123"><span class="linenos">123</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">apply_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Document</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Document</span><span class="p">]:</span>
</span><span id="AsyncFilter.apply_batch-124"><a href="#AsyncFilter.apply_batch-124"><span class="linenos">124</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AsyncFilter.apply_batch-125"><a href="#AsyncFilter.apply_batch-125"><span class="linenos">125</span></a><span class="sd">        Apply the filter to a Sequence of documents.</span>
</span><span id="AsyncFilter.apply_batch-126"><a href="#AsyncFilter.apply_batch-126"><span class="linenos">126</span></a><span class="sd">        By default, the processing implemented in `apply` is executed asynchronously and concurrently.</span>
</span><span id="AsyncFilter.apply_batch-127"><a href="#AsyncFilter.apply_batch-127"><span class="linenos">127</span></a><span class="sd">        If the filter processing can be optimized for batch processing, override this method.</span>
</span><span id="AsyncFilter.apply_batch-128"><a href="#AsyncFilter.apply_batch-128"><span class="linenos">128</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AsyncFilter.apply_batch-129"><a href="#AsyncFilter.apply_batch-129"><span class="linenos">129</span></a>        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">]</span>
</span><span id="AsyncFilter.apply_batch-130"><a href="#AsyncFilter.apply_batch-130"><span class="linenos">130</span></a>        <span class="k">return</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Apply the filter to a Sequence of documents.
By default, the processing implemented in <code><a href="#AsyncFilter.apply">apply</a></code> is executed asynchronously and concurrently.
If the filter processing can be optimized for batch processing, override this method.</p>
</div>


                            </div>
                            <div id="AsyncFilter.apply_stream" class="classattr">
                                        <input id="AsyncFilter.apply_stream-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">apply_stream</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">stream</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="n"><a href="#Document">hojichar.Document</a></span><span class="p">],</span> <span class="n">AsyncIterable</span><span class="p">[</span><span class="n"><a href="#Document">hojichar.Document</a></span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n">AsyncGenerator</span><span class="p">[</span><span class="n"><a href="#Document">hojichar.Document</a></span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="AsyncFilter.apply_stream-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AsyncFilter.apply_stream"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AsyncFilter.apply_stream-143"><a href="#AsyncFilter.apply_stream-143"><span class="linenos">143</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">apply_stream</span><span class="p">(</span>
</span><span id="AsyncFilter.apply_stream-144"><a href="#AsyncFilter.apply_stream-144"><span class="linenos">144</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="AsyncFilter.apply_stream-145"><a href="#AsyncFilter.apply_stream-145"><span class="linenos">145</span></a>        <span class="n">stream</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Document</span><span class="p">]</span> <span class="o">|</span> <span class="n">AsyncIterable</span><span class="p">[</span><span class="n">Document</span><span class="p">],</span>
</span><span id="AsyncFilter.apply_stream-146"><a href="#AsyncFilter.apply_stream-146"><span class="linenos">146</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncGenerator</span><span class="p">[</span><span class="n">Document</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
</span><span id="AsyncFilter.apply_stream-147"><a href="#AsyncFilter.apply_stream-147"><span class="linenos">147</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AsyncFilter.apply_stream-148"><a href="#AsyncFilter.apply_stream-148"><span class="linenos">148</span></a><span class="sd">        Apply the filter to a stream of documents (Iterable or AsyncIterable).</span>
</span><span id="AsyncFilter.apply_stream-149"><a href="#AsyncFilter.apply_stream-149"><span class="linenos">149</span></a><span class="sd">        If use_batch is set to `True` at initialization, the filter will process documents in batches.</span>
</span><span id="AsyncFilter.apply_stream-150"><a href="#AsyncFilter.apply_stream-150"><span class="linenos">150</span></a><span class="sd">        If the stream is not asynchronous, use handle_stream_as_async to convert it to an asynchronous stream.</span>
</span><span id="AsyncFilter.apply_stream-151"><a href="#AsyncFilter.apply_stream-151"><span class="linenos">151</span></a>
</span><span id="AsyncFilter.apply_stream-152"><a href="#AsyncFilter.apply_stream-152"><span class="linenos">152</span></a><span class="sd">        Even if an exception occurs during processing, the process will continue, and the following actions will be taken:</span>
</span><span id="AsyncFilter.apply_stream-153"><a href="#AsyncFilter.apply_stream-153"><span class="linenos">153</span></a><span class="sd">        - Set the `is_rejected` flag of the document to `True`</span>
</span><span id="AsyncFilter.apply_stream-154"><a href="#AsyncFilter.apply_stream-154"><span class="linenos">154</span></a><span class="sd">        - Set the error details in `reject_reason`</span>
</span><span id="AsyncFilter.apply_stream-155"><a href="#AsyncFilter.apply_stream-155"><span class="linenos">155</span></a><span class="sd">        - Increment the `errors` count in the statistics retrievable via `get_statistics`</span>
</span><span id="AsyncFilter.apply_stream-156"><a href="#AsyncFilter.apply_stream-156"><span class="linenos">156</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AsyncFilter.apply_stream-157"><a href="#AsyncFilter.apply_stream-157"><span class="linenos">157</span></a>        <span class="n">async_stream</span><span class="p">:</span> <span class="n">AsyncIterable</span><span class="p">[</span><span class="n">Document</span><span class="p">]</span> <span class="o">=</span> <span class="n">handle_stream_as_async</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
</span><span id="AsyncFilter.apply_stream-158"><a href="#AsyncFilter.apply_stream-158"><span class="linenos">158</span></a>
</span><span id="AsyncFilter.apply_stream-159"><a href="#AsyncFilter.apply_stream-159"><span class="linenos">159</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_batch</span><span class="p">:</span>
</span><span id="AsyncFilter.apply_stream-160"><a href="#AsyncFilter.apply_stream-160"><span class="linenos">160</span></a>            <span class="k">async</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">async_stream</span><span class="p">:</span>
</span><span id="AsyncFilter.apply_stream-161"><a href="#AsyncFilter.apply_stream-161"><span class="linenos">161</span></a>                <span class="k">yield</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_try_process</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply</span><span class="p">)</span>
</span><span id="AsyncFilter.apply_stream-162"><a href="#AsyncFilter.apply_stream-162"><span class="linenos">162</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="AsyncFilter.apply_stream-163"><a href="#AsyncFilter.apply_stream-163"><span class="linenos">163</span></a>            <span class="n">batch</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Document</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AsyncFilter.apply_stream-164"><a href="#AsyncFilter.apply_stream-164"><span class="linenos">164</span></a>            <span class="k">async</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">async_stream</span><span class="p">:</span>
</span><span id="AsyncFilter.apply_stream-165"><a href="#AsyncFilter.apply_stream-165"><span class="linenos">165</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_skip</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
</span><span id="AsyncFilter.apply_stream-166"><a href="#AsyncFilter.apply_stream-166"><span class="linenos">166</span></a>                    <span class="k">yield</span> <span class="n">doc</span>
</span><span id="AsyncFilter.apply_stream-167"><a href="#AsyncFilter.apply_stream-167"><span class="linenos">167</span></a>                    <span class="k">continue</span>
</span><span id="AsyncFilter.apply_stream-168"><a href="#AsyncFilter.apply_stream-168"><span class="linenos">168</span></a>
</span><span id="AsyncFilter.apply_stream-169"><a href="#AsyncFilter.apply_stream-169"><span class="linenos">169</span></a>                <span class="n">batch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
</span><span id="AsyncFilter.apply_stream-170"><a href="#AsyncFilter.apply_stream-170"><span class="linenos">170</span></a>                <span class="c1"># Batch size reached, apply batch</span>
</span><span id="AsyncFilter.apply_stream-171"><a href="#AsyncFilter.apply_stream-171"><span class="linenos">171</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">:</span>
</span><span id="AsyncFilter.apply_stream-172"><a href="#AsyncFilter.apply_stream-172"><span class="linenos">172</span></a>                    <span class="n">stats</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_doc_info</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">]</span>
</span><span id="AsyncFilter.apply_stream-173"><a href="#AsyncFilter.apply_stream-173"><span class="linenos">173</span></a>                    <span class="n">batch</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_try_process</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_batch</span><span class="p">)</span>
</span><span id="AsyncFilter.apply_stream-174"><a href="#AsyncFilter.apply_stream-174"><span class="linenos">174</span></a>                    <span class="n">batch</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finalize_batch</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">stats</span><span class="p">)</span>
</span><span id="AsyncFilter.apply_stream-175"><a href="#AsyncFilter.apply_stream-175"><span class="linenos">175</span></a>                    <span class="k">for</span> <span class="n">out</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">:</span>
</span><span id="AsyncFilter.apply_stream-176"><a href="#AsyncFilter.apply_stream-176"><span class="linenos">176</span></a>                        <span class="k">yield</span> <span class="n">out</span>
</span><span id="AsyncFilter.apply_stream-177"><a href="#AsyncFilter.apply_stream-177"><span class="linenos">177</span></a>                    <span class="n">batch</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="AsyncFilter.apply_stream-178"><a href="#AsyncFilter.apply_stream-178"><span class="linenos">178</span></a>
</span><span id="AsyncFilter.apply_stream-179"><a href="#AsyncFilter.apply_stream-179"><span class="linenos">179</span></a>            <span class="c1"># Flush remaining documents in the batch</span>
</span><span id="AsyncFilter.apply_stream-180"><a href="#AsyncFilter.apply_stream-180"><span class="linenos">180</span></a>            <span class="k">if</span> <span class="n">batch</span><span class="p">:</span>
</span><span id="AsyncFilter.apply_stream-181"><a href="#AsyncFilter.apply_stream-181"><span class="linenos">181</span></a>                <span class="n">stats</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_doc_info</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">]</span>
</span><span id="AsyncFilter.apply_stream-182"><a href="#AsyncFilter.apply_stream-182"><span class="linenos">182</span></a>                <span class="n">batch</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_try_process</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_batch</span><span class="p">)</span>
</span><span id="AsyncFilter.apply_stream-183"><a href="#AsyncFilter.apply_stream-183"><span class="linenos">183</span></a>                <span class="n">batch</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finalize_batch</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">stats</span><span class="p">)</span>
</span><span id="AsyncFilter.apply_stream-184"><a href="#AsyncFilter.apply_stream-184"><span class="linenos">184</span></a>                <span class="k">for</span> <span class="n">out</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">:</span>
</span><span id="AsyncFilter.apply_stream-185"><a href="#AsyncFilter.apply_stream-185"><span class="linenos">185</span></a>                    <span class="k">yield</span> <span class="n">out</span>
</span></pre></div>


            <div class="docstring"><p>Apply the filter to a stream of documents (Iterable or AsyncIterable).
If use_batch is set to <code>True</code> at initialization, the filter will process documents in batches.
If the stream is not asynchronous, use handle_stream_as_async to convert it to an asynchronous stream.</p>

<p>Even if an exception occurs during processing, the process will continue, and the following actions will be taken:</p>

<ul>
<li>Set the <code>is_rejected</code> flag of the document to <code>True</code></li>
<li>Set the error details in <code>reject_reason</code></li>
<li>Increment the <code>errors</code> count in the statistics retrievable via <code><a href="#AsyncFilter.get_statistics">get_statistics</a></code></li>
</ul>
</div>


                            </div>
                            <div id="AsyncFilter.get_statistics" class="classattr">
                                        <input id="AsyncFilter.get_statistics-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_statistics</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="hojichar/core/models.html#Statistics">hojichar.core.models.Statistics</a></span>:</span></span>

                <label class="view-source-button" for="AsyncFilter.get_statistics-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AsyncFilter.get_statistics"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AsyncFilter.get_statistics-214"><a href="#AsyncFilter.get_statistics-214"><span class="linenos">214</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Statistics</span><span class="p">:</span>
</span><span id="AsyncFilter.get_statistics-215"><a href="#AsyncFilter.get_statistics-215"><span class="linenos">215</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AsyncFilter.get_statistics-216"><a href="#AsyncFilter.get_statistics-216"><span class="linenos">216</span></a><span class="sd">        Get the statistics of this filter.</span>
</span><span id="AsyncFilter.get_statistics-217"><a href="#AsyncFilter.get_statistics-217"><span class="linenos">217</span></a><span class="sd">        Returns:</span>
</span><span id="AsyncFilter.get_statistics-218"><a href="#AsyncFilter.get_statistics-218"><span class="linenos">218</span></a><span class="sd">            Statistics: The statistics of this filter.</span>
</span><span id="AsyncFilter.get_statistics-219"><a href="#AsyncFilter.get_statistics-219"><span class="linenos">219</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AsyncFilter.get_statistics-220"><a href="#AsyncFilter.get_statistics-220"><span class="linenos">220</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_statistics</span>
</span></pre></div>


            <div class="docstring"><p>Get the statistics of this filter.
Returns:
    Statistics: The statistics of this filter.</p>
</div>


                            </div>
                            <div id="AsyncFilter.get_statistics_map" class="classattr">
                                        <input id="AsyncFilter.get_statistics_map-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_statistics_map</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><a href="hojichar/core/models.html#Statistics">hojichar.core.models.Statistics</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="AsyncFilter.get_statistics_map-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AsyncFilter.get_statistics_map"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AsyncFilter.get_statistics_map-222"><a href="#AsyncFilter.get_statistics_map-222"><span class="linenos">222</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_statistics_map</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Statistics</span><span class="p">]:</span>
</span><span id="AsyncFilter.get_statistics_map-223"><a href="#AsyncFilter.get_statistics_map-223"><span class="linenos">223</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AsyncFilter.get_statistics_map-224"><a href="#AsyncFilter.get_statistics_map-224"><span class="linenos">224</span></a><span class="sd">        Get the statistics of this filter as a dictionary.</span>
</span><span id="AsyncFilter.get_statistics_map-225"><a href="#AsyncFilter.get_statistics_map-225"><span class="linenos">225</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AsyncFilter.get_statistics_map-226"><a href="#AsyncFilter.get_statistics_map-226"><span class="linenos">226</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_statistics</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Get the statistics of this filter as a dictionary.</p>
</div>


                            </div>
                            <div id="AsyncFilter.shutdown" class="classattr">
                                        <input id="AsyncFilter.shutdown-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">shutdown</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="AsyncFilter.shutdown-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AsyncFilter.shutdown"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AsyncFilter.shutdown-228"><a href="#AsyncFilter.shutdown-228"><span class="linenos">228</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AsyncFilter.shutdown-229"><a href="#AsyncFilter.shutdown-229"><span class="linenos">229</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AsyncFilter.shutdown-230"><a href="#AsyncFilter.shutdown-230"><span class="linenos">230</span></a><span class="sd">        You can override this method to release resources or perform cleanup tasks.</span>
</span><span id="AsyncFilter.shutdown-231"><a href="#AsyncFilter.shutdown-231"><span class="linenos">231</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AsyncFilter.shutdown-232"><a href="#AsyncFilter.shutdown-232"><span class="linenos">232</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>You can override this method to release resources or perform cleanup tasks.</p>
</div>


                            </div>
                            <div id="AsyncFilter.get_jsonable_vars" class="classattr">
                                        <input id="AsyncFilter.get_jsonable_vars-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_jsonable_vars</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">exclude_keys</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="AsyncFilter.get_jsonable_vars-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AsyncFilter.get_jsonable_vars"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AsyncFilter.get_jsonable_vars-240"><a href="#AsyncFilter.get_jsonable_vars-240"><span class="linenos">240</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_jsonable_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exclude_keys</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="AsyncFilter.get_jsonable_vars-241"><a href="#AsyncFilter.get_jsonable_vars-241"><span class="linenos">241</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AsyncFilter.get_jsonable_vars-242"><a href="#AsyncFilter.get_jsonable_vars-242"><span class="linenos">242</span></a><span class="sd">        Get the member variable of this filter.</span>
</span><span id="AsyncFilter.get_jsonable_vars-243"><a href="#AsyncFilter.get_jsonable_vars-243"><span class="linenos">243</span></a><span class="sd">        Eligible variables are primitive types; [bool, int, float, str, None],</span>
</span><span id="AsyncFilter.get_jsonable_vars-244"><a href="#AsyncFilter.get_jsonable_vars-244"><span class="linenos">244</span></a><span class="sd">        and the name of the variable not starts with the underscore; `_`.</span>
</span><span id="AsyncFilter.get_jsonable_vars-245"><a href="#AsyncFilter.get_jsonable_vars-245"><span class="linenos">245</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AsyncFilter.get_jsonable_vars-246"><a href="#AsyncFilter.get_jsonable_vars-246"><span class="linenos">246</span></a>        <span class="k">if</span> <span class="n">exclude_keys</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AsyncFilter.get_jsonable_vars-247"><a href="#AsyncFilter.get_jsonable_vars-247"><span class="linenos">247</span></a>            <span class="n">exclude_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="AsyncFilter.get_jsonable_vars-248"><a href="#AsyncFilter.get_jsonable_vars-248"><span class="linenos">248</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="AsyncFilter.get_jsonable_vars-249"><a href="#AsyncFilter.get_jsonable_vars-249"><span class="linenos">249</span></a>            <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
</span><span id="AsyncFilter.get_jsonable_vars-250"><a href="#AsyncFilter.get_jsonable_vars-250"><span class="linenos">250</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="AsyncFilter.get_jsonable_vars-251"><a href="#AsyncFilter.get_jsonable_vars-251"><span class="linenos">251</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">_is_jsonable</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude_keys</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)))</span>
</span><span id="AsyncFilter.get_jsonable_vars-252"><a href="#AsyncFilter.get_jsonable_vars-252"><span class="linenos">252</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Get the member variable of this filter.
Eligible variables are primitive types; [bool, int, float, str, None],
and the name of the variable not starts with the underscore; <code>_</code>.</p>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value">${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>